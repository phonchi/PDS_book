<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.306">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="phonchi">
<meta name="dcterms.date" content="2023-03-20">

<title>Practical and Innovative Analytics in Data Science - 6&nbsp; Feature selection and extraction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./06_XAI.html" rel="next">
<link href="./04_Clean_feature_engineering.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05_Feature_selection_extraction.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Feature selection and extraction</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Practical and Innovative Analytics in Data Science</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Preface</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_end_to_end_machine_learning_project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">End-to-end Machine Learning project</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_Dataset.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Framing the problem and constructing the dataset</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_Relational_Database_and_data_wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Relational Database and data wrangling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_Clean_feature_engineering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data cleaning and feature engineering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_Feature_selection_extraction.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Feature selection and extraction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_XAI.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Explainable AI</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_Deploy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Deploy and monitoring</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup"><span class="header-section-number">6.1</span> Setup</a></li>
  <li><a href="#feature-selection" id="toc-feature-selection" class="nav-link" data-scroll-target="#feature-selection"><span class="header-section-number">6.2</span> Feature selection</a>
  <ul class="collapse">
  <li><a href="#removing-low-variance-features" id="toc-removing-low-variance-features" class="nav-link" data-scroll-target="#removing-low-variance-features"><span class="header-section-number">6.2.1</span> Removing low variance features</a></li>
  <li><a href="#univariate-feature-selection" id="toc-univariate-feature-selection" class="nav-link" data-scroll-target="#univariate-feature-selection"><span class="header-section-number">6.2.2</span> Univariate feature selection</a></li>
  <li><a href="#sequential-feature-selection" id="toc-sequential-feature-selection" class="nav-link" data-scroll-target="#sequential-feature-selection"><span class="header-section-number">6.2.3</span> Sequential feature selection</a></li>
  <li><a href="#feature-selection-from-model" id="toc-feature-selection-from-model" class="nav-link" data-scroll-target="#feature-selection-from-model"><span class="header-section-number">6.2.4</span> Feature selection from model</a></li>
  <li><a href="#a-concret-example" id="toc-a-concret-example" class="nav-link" data-scroll-target="#a-concret-example"><span class="header-section-number">6.2.5</span> A Concret example</a></li>
  </ul></li>
  <li><a href="#dimensional-reduction" id="toc-dimensional-reduction" class="nav-link" data-scroll-target="#dimensional-reduction"><span class="header-section-number">6.3</span> Dimensional reduction</a></li>
  <li><a href="#manifold-learning" id="toc-manifold-learning" class="nav-link" data-scroll-target="#manifold-learning"><span class="header-section-number">6.4</span> Manifold learning</a></li>
  <li><a href="#clustering" id="toc-clustering" class="nav-link" data-scroll-target="#clustering"><span class="header-section-number">6.5</span> Clustering</a>
  <ul class="collapse">
  <li><a href="#cluster-labels-as-a-feature" id="toc-cluster-labels-as-a-feature" class="nav-link" data-scroll-target="#cluster-labels-as-a-feature"><span class="header-section-number">6.5.1</span> Cluster Labels as a feature</a></li>
  <li><a href="#cluster-distance-as-a-feature" id="toc-cluster-distance-as-a-feature" class="nav-link" data-scroll-target="#cluster-distance-as-a-feature"><span class="header-section-number">6.5.2</span> Cluster distance as a feature</a></li>
  </ul></li>
  <li><a href="#guideline-to-determine-the-optimal-number-of-features-or-threshold" id="toc-guideline-to-determine-the-optimal-number-of-features-or-threshold" class="nav-link" data-scroll-target="#guideline-to-determine-the-optimal-number-of-features-or-threshold"><span class="header-section-number">6.6</span> Guideline to determine the optimal number of features or threshold?</a>
  <ul class="collapse">
  <li><a href="#using-clustering-for-semi-supervised-learning" id="toc-using-clustering-for-semi-supervised-learning" class="nav-link" data-scroll-target="#using-clustering-for-semi-supervised-learning"><span class="header-section-number">6.6.1</span> Using Clustering for Semi-Supervised Learning</a></li>
  <li><a href="#feature-agglomeration" id="toc-feature-agglomeration" class="nav-link" data-scroll-target="#feature-agglomeration"><span class="header-section-number">6.6.2</span> Feature agglomeration</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">6.7</span> References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Feature selection and extraction</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>phonchi </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 20, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>


<table align="left">
<tbody><tr><td>
<a href="https://colab.research.google.com/github/phonchi/nsysu-math608/blob/master/static_files/presentations/05_Feature_selection_extraction.ipynb" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a>
</td>
<td>
<a target="_blank" href="https://kaggle.com/kernels/welcome?src=https://github.com/phonchi/nsysu-math608/blob/master/static_files/presentations/05_Feature_selection_extraction.ipynb"><img src="https://kaggle.com/static/images/open-in-kaggle.svg"></a>
</td>

</tr></tbody></table>
<p><br></p>
<section id="setup" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="setup"><span class="header-section-number">6.1</span> Setup</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="op">!</span>pip install Boruta <span class="op">-</span>qq</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="op">!</span>pip install opentsne <span class="op">-</span>qq</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="op">!</span>pip install umap<span class="op">-</span>learn <span class="op">-</span>qq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:2,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679900367556,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Scientific computing</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb2-8"><a href="#cb2-8"></a></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co"># Preprocessing and datasets</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="im">from</span> sklearn.datasets <span class="im">import</span> load_iris</span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="im">from</span> sklearn.datasets <span class="im">import</span> load_digits</span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="im">from</span> sklearn.datasets <span class="im">import</span> fetch_california_housing</span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="im">from</span> sklearn.datasets <span class="im">import</span> make_classification</span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline, Pipeline</span>
<span id="cb2-16"><a href="#cb2-16"></a></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="co"># Modeling</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_validate</span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> RepeatedKFold</span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb2-23"><a href="#cb2-23"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb2-24"><a href="#cb2-24"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb2-25"><a href="#cb2-25"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> RidgeCV</span>
<span id="cb2-26"><a href="#cb2-26"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> Lasso</span>
<span id="cb2-27"><a href="#cb2-27"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb2-28"><a href="#cb2-28"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> LinearSVC</span>
<span id="cb2-29"><a href="#cb2-29"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="cb2-30"><a href="#cb2-30"></a></span>
<span id="cb2-31"><a href="#cb2-31"></a><span class="co"># Feature selection</span></span>
<span id="cb2-32"><a href="#cb2-32"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> VarianceThreshold</span>
<span id="cb2-33"><a href="#cb2-33"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> SelectKBest</span>
<span id="cb2-34"><a href="#cb2-34"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> chi2</span>
<span id="cb2-35"><a href="#cb2-35"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> f_classif</span>
<span id="cb2-36"><a href="#cb2-36"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> mutual_info_regression</span>
<span id="cb2-37"><a href="#cb2-37"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> SequentialFeatureSelector</span>
<span id="cb2-38"><a href="#cb2-38"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> SelectFromModel</span>
<span id="cb2-39"><a href="#cb2-39"></a><span class="im">from</span> sklearn.inspection <span class="im">import</span> permutation_importance</span>
<span id="cb2-40"><a href="#cb2-40"></a></span>
<span id="cb2-41"><a href="#cb2-41"></a><span class="im">from</span> boruta <span class="im">import</span> BorutaPy</span>
<span id="cb2-42"><a href="#cb2-42"></a></span>
<span id="cb2-43"><a href="#cb2-43"></a><span class="co"># Feature extraction</span></span>
<span id="cb2-44"><a href="#cb2-44"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb2-45"><a href="#cb2-45"></a><span class="im">from</span> openTSNE <span class="im">import</span> TSNE <span class="im">as</span> oTSNE</span>
<span id="cb2-46"><a href="#cb2-46"></a><span class="im">import</span> umap</span>
<span id="cb2-47"><a href="#cb2-47"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span>
<span id="cb2-48"><a href="#cb2-48"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> FeatureAgglomeration</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="feature-selection" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="feature-selection"><span class="header-section-number">6.2</span> Feature selection</h2>
<p>The classes in the <code>sklearn.feature_selection</code> module can be used for feature selection/extraction methods on datasets, either to improve estimators’ accuracy scores or to boost their performance on very high-dimensional datasets.</p>
<section id="removing-low-variance-features" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="removing-low-variance-features"><span class="header-section-number">6.2.1</span> Removing low variance features</h3>
<p>Suppose that we have a dataset with boolean features, and we want to remove all features that are either one or zero (on or off) in more than 80% of the samples. Boolean features are Bernoulli random variables, and the variance of such variables is <code>0.8 * (1 - 0.8)</code></p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:295,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679900372348,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="ed0d020c-ed76-4419-c729-24c9fc921437" data-execution_count="3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a>X <span class="op">=</span> pd.DataFrame([[<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>], [<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>]])</span>
<span id="cb3-2"><a href="#cb3-2"></a>X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="3">

  <div id="df-ea4d79e4-8383-4967-8e46-c81015bd855e">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-ea4d79e4-8383-4967-8e46-c81015bd855e')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-ea4d79e4-8383-4967-8e46-c81015bd855e button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-ea4d79e4-8383-4967-8e46-c81015bd855e');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:296,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679900403683,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="02882012-30d3-4236-9683-a497608b5fc6" data-execution_count="4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a>sel <span class="op">=</span> VarianceThreshold(threshold<span class="op">=</span>(<span class="fl">.8</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> <span class="fl">.8</span>))).set_output(transform<span class="op">=</span><span class="st">"pandas"</span>)</span>
<span id="cb4-2"><a href="#cb4-2"></a>sel.fit_transform(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="4">

  <div id="df-92a9a58b-003e-405b-bfb1-0c4f6f460cc5">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">x1</th>
<th data-quarto-table-cell-role="th">x2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-92a9a58b-003e-405b-bfb1-0c4f6f460cc5')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-92a9a58b-003e-405b-bfb1-0c4f6f460cc5 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-92a9a58b-003e-405b-bfb1-0c4f6f460cc5');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<p>As expected, <code>VarianceThreshold()</code> has removed the first column, which has a probability of containing a zero.</p>
</section>
<section id="univariate-feature-selection" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="univariate-feature-selection"><span class="header-section-number">6.2.2</span> Univariate feature selection</h3>
<p><code>Scikit-learn</code> exposes feature selection routines as objects that implement the <code>transform()</code> method. For instance, we can perform a <span class="math inline">\(\chi^2\)</span> test to the samples to retrieve only the two best features as follows:</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:293,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679900443470,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="e60667f3-6a13-4dee-94b1-e704d347ec7f" data-execution_count="5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a>X, y <span class="op">=</span> load_iris(return_X_y<span class="op">=</span><span class="va">True</span>, as_frame<span class="op">=</span><span class="va">True</span>) <span class="co"># Load the iris data set</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="5">

  <div id="df-e2f24c93-24ca-4050-b732-0d121d12f10b">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sepal length (cm)</th>
<th data-quarto-table-cell-role="th">sepal width (cm)</th>
<th data-quarto-table-cell-role="th">petal length (cm)</th>
<th data-quarto-table-cell-role="th">petal width (cm)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>5.1</td>
<td>3.5</td>
<td>1.4</td>
<td>0.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>4.9</td>
<td>3.0</td>
<td>1.4</td>
<td>0.2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>4.7</td>
<td>3.2</td>
<td>1.3</td>
<td>0.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4.6</td>
<td>3.1</td>
<td>1.5</td>
<td>0.2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5.0</td>
<td>3.6</td>
<td>1.4</td>
<td>0.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">145</td>
<td>6.7</td>
<td>3.0</td>
<td>5.2</td>
<td>2.3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">146</td>
<td>6.3</td>
<td>2.5</td>
<td>5.0</td>
<td>1.9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">147</td>
<td>6.5</td>
<td>3.0</td>
<td>5.2</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">148</td>
<td>6.2</td>
<td>3.4</td>
<td>5.4</td>
<td>2.3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">149</td>
<td>5.9</td>
<td>3.0</td>
<td>5.1</td>
<td>1.8</td>
</tr>
</tbody>
</table>


<p>150 rows × 4 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-e2f24c93-24ca-4050-b732-0d121d12f10b')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-e2f24c93-24ca-4050-b732-0d121d12f10b button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-e2f24c93-24ca-4050-b732-0d121d12f10b');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:295,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679900523847,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="802aca26-3eb9-4a7b-9a46-084e99198fdd" data-execution_count="6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a>selecter <span class="op">=</span> SelectKBest(chi2, k<span class="op">=</span><span class="dv">2</span>).set_output(transform<span class="op">=</span><span class="st">"pandas"</span>)</span>
<span id="cb6-2"><a href="#cb6-2"></a>X_new <span class="op">=</span> selecter.fit_transform(X, y)</span>
<span id="cb6-3"><a href="#cb6-3"></a>X_new</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="6">

  <div id="df-33085bca-7330-4d3d-9ff8-b3c7c45ce302">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">petal length (cm)</th>
<th data-quarto-table-cell-role="th">petal width (cm)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.4</td>
<td>0.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.4</td>
<td>0.2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1.3</td>
<td>0.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1.5</td>
<td>0.2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1.4</td>
<td>0.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">145</td>
<td>5.2</td>
<td>2.3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">146</td>
<td>5.0</td>
<td>1.9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">147</td>
<td>5.2</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">148</td>
<td>5.4</td>
<td>2.3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">149</td>
<td>5.1</td>
<td>1.8</td>
</tr>
</tbody>
</table>


<p>150 rows × 2 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-33085bca-7330-4d3d-9ff8-b3c7c45ce302')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-33085bca-7330-4d3d-9ff8-b3c7c45ce302 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-33085bca-7330-4d3d-9ff8-b3c7c45ce302');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:623,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679900541697,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="ea51d0b4-6228-4350-8e3c-763383d0bee7" data-execution_count="7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a>plt.scatter(X_new.iloc[:,<span class="dv">0</span>], X_new.iloc[:,<span class="dv">1</span>], c<span class="op">=</span>y)</span>
<span id="cb7-2"><a href="#cb7-2"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-8-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>These objects take as input a scoring function that returns univariate scores/p-values (or only scores for <code>SelectKBest()</code> and <code>SelectPercentile()</code>):</p>
<ul>
<li>For regression: <code>r_regression</code>, <code>f_regression</code>, <code>mutual_info_regression</code></li>
<li>For classification: <code>chi2</code>, <code>f_classif</code>, <code>mutual_info_classif</code></li>
</ul>
<p>The methods based on F-test estimate the degree of linear dependency between two random variables. For example, we create a dataset with two informative features among a hundred. To simplify our example, we do not include either redundant or repeated features. In addition, We will explicitly not shuffle the dataset to ensure that the informative features will correspond to the three two columns of X.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:281,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679900621206,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Generate synthetic dataset</span></span>
<span id="cb8-2"><a href="#cb8-2"></a></span>
<span id="cb8-3"><a href="#cb8-3"></a>data, target <span class="op">=</span> make_classification(</span>
<span id="cb8-4"><a href="#cb8-4"></a>    n_samples<span class="op">=</span><span class="dv">5000</span>,</span>
<span id="cb8-5"><a href="#cb8-5"></a>    n_features<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb8-6"><a href="#cb8-6"></a>    n_informative<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb8-7"><a href="#cb8-7"></a>    n_redundant<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb8-8"><a href="#cb8-8"></a>    n_repeated<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb8-9"><a href="#cb8-9"></a>    random_state<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb8-10"><a href="#cb8-10"></a>    shuffle <span class="op">=</span> <span class="va">False</span>  <span class="co"># So that we know the informative freatures are X[:, n_informative + n_redundant + n_repeated:].</span></span>
<span id="cb8-11"><a href="#cb8-11"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We will create two machine learning pipelines.</p>
<ol type="1">
<li><p>The former will be a random forest that will use all available features.</p></li>
<li><p>The latter will also be a random forest, but we will add a feature selection step to train this classifier.</p></li>
</ol>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:262,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679900646905,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Let’s create the model without any feature selection</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>model_without_selection <span class="op">=</span> RandomForestClassifier(n_jobs<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:467,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679900683535,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="10">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Then, let’s create a pipeline where the first stage will make the feature selection processing.</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>model_with_selection <span class="op">=</span> make_pipeline(</span>
<span id="cb10-3"><a href="#cb10-3"></a>    SelectKBest(score_func<span class="op">=</span>f_classif, k<span class="op">=</span><span class="dv">2</span>), <span class="co"># Feature slection</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>    RandomForestClassifier(n_jobs<span class="op">=</span><span class="dv">2</span>),       <span class="co"># Model</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We will measure the average time spent to train each pipeline and make it predict. Besides, we will compute the testing score of the model. We will collect these results via cross-validation.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:20799,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679900708530,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="11">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Let’s start with the random forest without feature selection. We will store the results into a dataframe.</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>cv_results_without_selection <span class="op">=</span> cross_validate(model_without_selection, data, target)</span>
<span id="cb11-3"><a href="#cb11-3"></a>cv_results_without_selection <span class="op">=</span> pd.DataFrame(cv_results_without_selection)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:3859,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679900712387,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="12">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Now, we will repeat the process for the pipeline incorporating the feature selection.</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>cv_results_with_selection <span class="op">=</span> cross_validate(model_with_selection, data, target, return_estimator<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-3"><a href="#cb12-3"></a>cv_results_with_selection <span class="op">=</span> pd.DataFrame(cv_results_with_selection)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To analyze the results, we will merge the results from the two pipeline in a single pandas dataframe.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:12,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679900712387,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="13">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a>cv_results <span class="op">=</span> pd.concat(</span>
<span id="cb13-2"><a href="#cb13-2"></a>    [cv_results_without_selection, cv_results_with_selection],</span>
<span id="cb13-3"><a href="#cb13-3"></a>    axis<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb13-4"><a href="#cb13-4"></a>    keys<span class="op">=</span>[<span class="st">"Without feature selection"</span>, <span class="st">"With feature selection"</span>],</span>
<span id="cb13-5"><a href="#cb13-5"></a>)</span>
<span id="cb13-6"><a href="#cb13-6"></a></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="co"># swap the level of the multi-index of the columns</span></span>
<span id="cb13-8"><a href="#cb13-8"></a>cv_results <span class="op">=</span> cv_results.swaplevel(axis<span class="op">=</span><span class="st">"columns"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s first analyze the train and score time for each pipeline.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:711,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679900717024,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="d4895090-fb94-45a7-f1b4-dea3d7b45630" data-execution_count="14">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a>color <span class="op">=</span> {<span class="st">"whiskers"</span>: <span class="st">"black"</span>, <span class="st">"medians"</span>: <span class="st">"black"</span>, <span class="st">"caps"</span>: <span class="st">"black"</span>}</span>
<span id="cb14-2"><a href="#cb14-2"></a>cv_results[<span class="st">"fit_time"</span>].plot.box(color<span class="op">=</span>color, vert<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb14-3"><a href="#cb14-3"></a>plt.xlabel(<span class="st">"Elapsed time (s)"</span>)</span>
<span id="cb14-4"><a href="#cb14-4"></a>_ <span class="op">=</span> plt.title(<span class="st">"Time to fit the model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-15-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:379,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679900733705,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="ab0caa51-9545-48a8-9f3d-5a87c36d5ea7" data-execution_count="15">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a>cv_results[<span class="st">"score_time"</span>].plot.box(color<span class="op">=</span>color, vert<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb15-2"><a href="#cb15-2"></a>plt.xlabel(<span class="st">"Elapsed time (s)"</span>)</span>
<span id="cb15-3"><a href="#cb15-3"></a>_ <span class="op">=</span> plt.title(<span class="st">"Time to make prediction"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-16-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>We can draw the same conclusions for both training and scoring elapsed time: selecting the most informative features speed-up our pipeline. Of course, such speed-up is beneficial only if the generalization performance in terms of metrics remain the same. Let’s check the testing score.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:293,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679900744173,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="a5d938e4-35d7-4701-b29a-0f8b18e6d811" data-execution_count="16">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a>cv_results[<span class="st">"test_score"</span>].plot.box(color<span class="op">=</span>color, vert<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb16-2"><a href="#cb16-2"></a>plt.xlabel(<span class="st">"Accuracy score"</span>)</span>
<span id="cb16-3"><a href="#cb16-3"></a>_ <span class="op">=</span> plt.title(<span class="st">"Test score via cross-validation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>We can observe that the model’s generalization performance selecting a subset of features decreases compared with the model using all available features. Since we generated the dataset, we can infer that the decrease is because of the selection. <strong>The feature selection algorithm did not choose the two informative features.</strong></p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:294,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679900765710,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="c86eb50b-6cfc-4617-a59a-80b13e6fd0ac" data-execution_count="17">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="cf">for</span> idx, pipeline <span class="kw">in</span> <span class="bu">enumerate</span>(cv_results_with_selection[<span class="st">"estimator"</span>]):</span>
<span id="cb17-2"><a href="#cb17-2"></a>    <span class="bu">print</span>(</span>
<span id="cb17-3"><a href="#cb17-3"></a>        <span class="ss">f"Fold #</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss"> - features selected are: "</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>        <span class="ss">f"</span><span class="sc">{</span>np<span class="sc">.</span>argsort(pipeline[<span class="dv">0</span>].scores_)[<span class="op">-</span><span class="dv">2</span>:]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb17-5"><a href="#cb17-5"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Fold #0 - features selected are: [30  1]
Fold #1 - features selected are: [10  1]
Fold #2 - features selected are: [10  1]
Fold #3 - features selected are: [30  1]
Fold #4 - features selected are: [61  1]</code></pre>
</div>
</div>
<p>We see that the feature 1 is always selected while the other feature varies depending on the cross-validation fold.</p>
<p>If we would like to keep our score with similar generalization performance, <strong>we could choose another metric to perform the test or select more features.</strong> For instance, we could select the number of features based on a specific percentile of the highest scores.</p>
<section id="mutual-information" class="level4" data-number="6.2.2.1">
<h4 data-number="6.2.2.1" class="anchored" data-anchor-id="mutual-information"><span class="header-section-number">6.2.2.1</span> Mutual information</h4>
<p>The <a href="https://www.kaggle.com/toramky/automobile-dataset"><em>Automobile</em></a> dataset consists of 193 cars from the 1985 model year. The goal for this dataset is to predict a car’s <code>price</code> (the target) from 23 of the car’s features, such as <code>make</code>, <code>body_style</code>, and <code>horsepower</code>. In this example, we’ll rank the features with mutual information and investigate the results by data visualization. (The original dataset requires data cleaning, you could refer to https://skill-lync.com/student-projects/project-1-1299 for more details)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># Uncpmment below if you are using Kaggle</span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="co">#!pip install gdown</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:2242,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679900826493,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="20b6912b-5b02-4e96-d284-2026d7a04833" data-execution_count="18">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a><span class="op">!</span>gdown <span class="op">--</span>fuzzy https:<span class="op">//</span>drive.google.com<span class="op">/</span><span class="bu">file</span><span class="op">/</span>d<span class="op">/</span><span class="dv">1</span><span class="er">FoCRK2LQBo1hlPWK2fDDcOjjy</span><span class="op">-</span>DnPiJw<span class="op">/</span>view?usp<span class="op">=</span>sharing</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Downloading...
From: https://drive.google.com/uc?id=1FoCRK2LQBo1hlPWK2fDDcOjjy-DnPiJw
To: /content/autos.csv
  0% 0.00/21.6k [00:00&lt;?, ?B/s]100% 21.6k/21.6k [00:00&lt;00:00, 31.6MB/s]</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:297,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679900847099,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="9b8b81e0-417d-449a-ef90-a46e4584c2d2" data-execution_count="19">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"autos.csv"</span>) <span class="co"># Clean version</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="19">

  <div id="df-cdd0d286-051d-4215-960d-b5744580e6ce">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">symboling</th>
<th data-quarto-table-cell-role="th">make</th>
<th data-quarto-table-cell-role="th">fuel_type</th>
<th data-quarto-table-cell-role="th">aspiration</th>
<th data-quarto-table-cell-role="th">num_of_doors</th>
<th data-quarto-table-cell-role="th">body_style</th>
<th data-quarto-table-cell-role="th">drive_wheels</th>
<th data-quarto-table-cell-role="th">engine_location</th>
<th data-quarto-table-cell-role="th">wheel_base</th>
<th data-quarto-table-cell-role="th">length</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">engine_size</th>
<th data-quarto-table-cell-role="th">fuel_system</th>
<th data-quarto-table-cell-role="th">bore</th>
<th data-quarto-table-cell-role="th">stroke</th>
<th data-quarto-table-cell-role="th">compression_ratio</th>
<th data-quarto-table-cell-role="th">horsepower</th>
<th data-quarto-table-cell-role="th">peak_rpm</th>
<th data-quarto-table-cell-role="th">city_mpg</th>
<th data-quarto-table-cell-role="th">highway_mpg</th>
<th data-quarto-table-cell-role="th">price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>3</td>
<td>alfa-romero</td>
<td>gas</td>
<td>std</td>
<td>2</td>
<td>convertible</td>
<td>rwd</td>
<td>front</td>
<td>88.6</td>
<td>168.8</td>
<td>...</td>
<td>130</td>
<td>mpfi</td>
<td>3.47</td>
<td>2.68</td>
<td>9</td>
<td>111</td>
<td>5000</td>
<td>21</td>
<td>27</td>
<td>13495</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3</td>
<td>alfa-romero</td>
<td>gas</td>
<td>std</td>
<td>2</td>
<td>convertible</td>
<td>rwd</td>
<td>front</td>
<td>88.6</td>
<td>168.8</td>
<td>...</td>
<td>130</td>
<td>mpfi</td>
<td>3.47</td>
<td>2.68</td>
<td>9</td>
<td>111</td>
<td>5000</td>
<td>21</td>
<td>27</td>
<td>16500</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>alfa-romero</td>
<td>gas</td>
<td>std</td>
<td>2</td>
<td>hatchback</td>
<td>rwd</td>
<td>front</td>
<td>94.5</td>
<td>171.2</td>
<td>...</td>
<td>152</td>
<td>mpfi</td>
<td>2.68</td>
<td>3.47</td>
<td>9</td>
<td>154</td>
<td>5000</td>
<td>19</td>
<td>26</td>
<td>16500</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2</td>
<td>audi</td>
<td>gas</td>
<td>std</td>
<td>4</td>
<td>sedan</td>
<td>fwd</td>
<td>front</td>
<td>99.8</td>
<td>176.6</td>
<td>...</td>
<td>109</td>
<td>mpfi</td>
<td>3.19</td>
<td>3.40</td>
<td>10</td>
<td>102</td>
<td>5500</td>
<td>24</td>
<td>30</td>
<td>13950</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2</td>
<td>audi</td>
<td>gas</td>
<td>std</td>
<td>4</td>
<td>sedan</td>
<td>4wd</td>
<td>front</td>
<td>99.4</td>
<td>176.6</td>
<td>...</td>
<td>136</td>
<td>mpfi</td>
<td>3.19</td>
<td>3.40</td>
<td>8</td>
<td>115</td>
<td>5500</td>
<td>18</td>
<td>22</td>
<td>17450</td>
</tr>
</tbody>
</table>


<p>5 rows × 25 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-cdd0d286-051d-4215-960d-b5744580e6ce')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-cdd0d286-051d-4215-960d-b5744580e6ce button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-cdd0d286-051d-4215-960d-b5744580e6ce');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<p>The <code>scikit-learn</code> algorithm for MI treats discrete features differently from continuous features. Consequently, you need to tell it which are which. As a rule of thumb, anything that have a <code>float</code> dtype is <em>not</em> discrete. Categoricals (<code>object</code> or <code>categorial</code> dtype) can be treated as discrete by giving them a label encoding</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:264,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679900893246,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="21">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a>X <span class="op">=</span> df.copy()</span>
<span id="cb23-2"><a href="#cb23-2"></a>y <span class="op">=</span> X.pop(<span class="st">"price"</span>)</span>
<span id="cb23-3"><a href="#cb23-3"></a></span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="co"># Label encoding for categoricals</span></span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="cf">for</span> colname <span class="kw">in</span> X.select_dtypes(<span class="st">"object"</span>):</span>
<span id="cb23-6"><a href="#cb23-6"></a><span class="co"># A way to perfrom label encoding see https://pandas.pydata.org/docs/reference/api/pandas.factorize.html</span></span>
<span id="cb23-7"><a href="#cb23-7"></a>    X[colname], _ <span class="op">=</span> X[colname].factorize() </span>
<span id="cb23-8"><a href="#cb23-8"></a></span>
<span id="cb23-9"><a href="#cb23-9"></a><span class="co"># All discrete features should now have integer dtypes (double-check this before using MI!)</span></span>
<span id="cb23-10"><a href="#cb23-10"></a>discrete_features <span class="op">=</span> X.dtypes <span class="op">==</span> <span class="bu">int</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><code>Scikit-learn</code> has two mutual information metrics in its <code>feature_selection</code> module: one for real-valued targets (<code>mutual_info_regression()</code>) and one for categorical targets (<code>mutual_info_classif()</code>). Our target, <code>price</code>, is real-valued. The next cell computes the MI scores for our features and wraps them up in a nice dataframe.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:2256,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679900916935,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="d9774c30-76d3-4eae-bf1b-f547a644c9eb" data-execution_count="22">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a><span class="kw">def</span> make_mi_scores(X, y, discrete_features):</span>
<span id="cb24-2"><a href="#cb24-2"></a>    mi_scores <span class="op">=</span> mutual_info_regression(X, y, discrete_features<span class="op">=</span>discrete_features)</span>
<span id="cb24-3"><a href="#cb24-3"></a>    mi_scores <span class="op">=</span> pd.Series(mi_scores, name<span class="op">=</span><span class="st">"MI Scores"</span>, index<span class="op">=</span>X.columns)</span>
<span id="cb24-4"><a href="#cb24-4"></a>    mi_scores <span class="op">=</span> mi_scores.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb24-5"><a href="#cb24-5"></a>    <span class="cf">return</span> mi_scores</span>
<span id="cb24-6"><a href="#cb24-6"></a></span>
<span id="cb24-7"><a href="#cb24-7"></a>mi_scores <span class="op">=</span> make_mi_scores(X, y, discrete_features)</span>
<span id="cb24-8"><a href="#cb24-8"></a>mi_scores[::<span class="dv">3</span>]  <span class="co"># show a few features with their MI scores</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>curb_weight          1.436041
highway_mpg          0.948495
length               0.615407
bore                 0.497058
stroke               0.385846
num_of_cylinders     0.331445
compression_ratio    0.132048
fuel_type            0.047279
Name: MI Scores, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1379,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679900935073,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="36b43819-c82a-4116-eabc-1b0b01462858" data-execution_count="23">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw">def</span> plot_mi_scores(scores):</span>
<span id="cb26-2"><a href="#cb26-2"></a>    scores <span class="op">=</span> scores.sort_values(ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-3"><a href="#cb26-3"></a>    width <span class="op">=</span> np.arange(<span class="bu">len</span>(scores))</span>
<span id="cb26-4"><a href="#cb26-4"></a>    ticks <span class="op">=</span> <span class="bu">list</span>(scores.index)</span>
<span id="cb26-5"><a href="#cb26-5"></a>    plt.barh(width, scores)</span>
<span id="cb26-6"><a href="#cb26-6"></a>    plt.yticks(width, ticks)</span>
<span id="cb26-7"><a href="#cb26-7"></a>    plt.title(<span class="st">"Mutual Information Scores"</span>)</span>
<span id="cb26-8"><a href="#cb26-8"></a></span>
<span id="cb26-9"><a href="#cb26-9"></a>plt.figure(dpi<span class="op">=</span><span class="dv">100</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb26-10"><a href="#cb26-10"></a>plot_mi_scores(mi_scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-24-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1491,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679900956798,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="49430573-601c-4a03-ae25-1d544720cc5e" data-execution_count="24">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># As we might expect, the high-scoring `curb_weight` feature exhibits a strong relationship with `price`, the target.</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>sns.relplot(x<span class="op">=</span><span class="st">"curb_weight"</span>, y<span class="op">=</span><span class="st">"price"</span>, data<span class="op">=</span>df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-25-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The <code>fuel_type</code> feature has a fairly low MI score, but as we can see from the figure below, it clearly separates two <code>price</code> populations with different trends within the <code>horsepower</code> feature. <strong>This indicates that <code>fuel_type</code> contributes an interaction effect and might not be unimportant after all.</strong> Before deciding a feature is unimportant from its MI score, it’s good to investigate any possible interaction effects – domain knowledge can offer a lot of guidance here.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1065,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679900990282,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="981f4a27-3297-4853-eecb-a54254936144" data-execution_count="25">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a>sns.lmplot(x<span class="op">=</span><span class="st">"horsepower"</span>, y<span class="op">=</span><span class="st">"price"</span>, hue<span class="op">=</span><span class="st">"fuel_type"</span>, data<span class="op">=</span>df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="sequential-feature-selection" class="level3" data-number="6.2.3">
<h3 data-number="6.2.3" class="anchored" data-anchor-id="sequential-feature-selection"><span class="header-section-number">6.2.3</span> Sequential feature selection</h3>
<p>Sequential Feature Selection is available in the <code>SequentialFeatureSelector</code> transformer. SFS can be either forward or backward:</p>
<ul>
<li><p>Forward-SFS is a greedy procedure that iteratively finds the best new feature to add to the set of selected features. Concretely, we initially start with zero feature and find the one feature that maximizes a cross-validated score when an estimator is trained on this single feature. Once that first feature is selected, we repeat the procedure by adding a new feature to the set of selected features. The procedure stops when the desired number of selected features is reached, as determined by the <code>n_features_to_select</code> parameter.</p></li>
<li><p>Backward-SFS follows the same idea but works in the opposite direction: instead of starting with no feature and greedily adding features, we start with all the features and greedily remove features from the set. The direction parameter controls whether forward or backward SFS is used.</p></li>
</ul>
<blockquote class="blockquote">
<p>In general, forward and backward selection do not yield equivalent results. Also, one may be much faster than the other depending on the requested number of selected features: if we have 10 features and ask for 7 selected features, forward selection would need to perform 7 iterations while backward selection would only need to perform 3.</p>
</blockquote>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:266,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901058671,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="26">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a>X, y <span class="op">=</span> load_iris(return_X_y<span class="op">=</span><span class="va">True</span>, as_frame<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-2"><a href="#cb29-2"></a>knn <span class="op">=</span> KNeighborsClassifier(n_neighbors<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:444,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901080140,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="8719c024-1dae-4bb1-fe5c-4fa45bf5c34b" data-execution_count="27">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1"></a>sfs <span class="op">=</span> SequentialFeatureSelector(knn, n_features_to_select<span class="op">=</span><span class="dv">2</span>, direction<span class="op">=</span><span class="st">'forward'</span>).set_output(transform<span class="op">=</span><span class="st">"pandas"</span>)</span>
<span id="cb30-2"><a href="#cb30-2"></a>sfs.fit(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="27">
<style>#sk-container-id-1 {color: black;background-color: white;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>SequentialFeatureSelector(estimator=KNeighborsClassifier(n_neighbors=3),
                          n_features_to_select=2)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox"><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">SequentialFeatureSelector</label><div class="sk-toggleable__content"><pre>SequentialFeatureSelector(estimator=KNeighborsClassifier(n_neighbors=3),
                          n_features_to_select=2)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox"><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: KNeighborsClassifier</label><div class="sk-toggleable__content"><pre>KNeighborsClassifier(n_neighbors=3)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox"><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">KNeighborsClassifier</label><div class="sk-toggleable__content"><pre>KNeighborsClassifier(n_neighbors=3)</pre></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:272,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901094481,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="20b10eb3-6056-41c2-c3e6-98e29236bdd1" data-execution_count="28">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a> df <span class="op">=</span> sfs.transform(X)</span>
<span id="cb31-2"><a href="#cb31-2"></a> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="28">

  <div id="df-903ae9c3-c470-4fb4-a9c2-72f0fda6ae21">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sepal length (cm)</th>
<th data-quarto-table-cell-role="th">petal width (cm)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>5.1</td>
<td>0.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>4.9</td>
<td>0.2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>4.7</td>
<td>0.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4.6</td>
<td>0.2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5.0</td>
<td>0.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">145</td>
<td>6.7</td>
<td>2.3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">146</td>
<td>6.3</td>
<td>1.9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">147</td>
<td>6.5</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">148</td>
<td>6.2</td>
<td>2.3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">149</td>
<td>5.9</td>
<td>1.8</td>
</tr>
</tbody>
</table>


<p>150 rows × 2 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-903ae9c3-c470-4fb4-a9c2-72f0fda6ae21')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-903ae9c3-c470-4fb4-a9c2-72f0fda6ae21 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-903ae9c3-c470-4fb4-a9c2-72f0fda6ae21');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:467,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901105323,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="7fa8e34b-4ee8-495b-dae2-e89aecfe24c9" data-execution_count="29">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1"></a>plt.scatter(df.iloc[:,<span class="dv">0</span>], df.iloc[:,<span class="dv">1</span>],c<span class="op">=</span>y)</span>
<span id="cb32-2"><a href="#cb32-2"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-30-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="feature-selection-from-model" class="level3" data-number="6.2.4">
<h3 data-number="6.2.4" class="anchored" data-anchor-id="feature-selection-from-model"><span class="header-section-number">6.2.4</span> Feature selection from model</h3>
<p><code>SelectFromModel</code> is a meta-transformer that can be used alongside any estimator that assigns importance to each feature through a specific attribute (such as <code>coef_</code>, <code>feature_importances_</code>) or via an <code>importance_getter</code> callable after fitting. The features are considered unimportant and removed if the corresponding importance of the feature values are below the provided threshold parameter.</p>
<p>Apart from specifying the threshold numerically, there are built-in heuristics for finding a threshold using a string argument. **Available heuristics are “mean”, “median” and float multiples of these like “0.1*mean”. In combination with the threshold criteria, one can use the <code>max_features</code> parameter to set a limit on the number of features to select.**</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:352,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901126308,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="30">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a>X, y <span class="op">=</span> load_iris(return_X_y<span class="op">=</span><span class="va">True</span>, as_frame<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:271,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901153187,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="31">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1"></a>lsvc <span class="op">=</span> LinearSVC(C<span class="op">=</span><span class="fl">0.01</span>, penalty<span class="op">=</span><span class="st">"l1"</span>, dual<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb34-2"><a href="#cb34-2"></a>model <span class="op">=</span> SelectFromModel(lsvc).set_output(transform<span class="op">=</span><span class="st">"pandas"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:281,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901178747,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="06658c5a-5653-4822-9417-ce2a1aefc4bf" data-execution_count="32">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a>X_new <span class="op">=</span> model.fit_transform(X,y) <span class="co"># We use threshold instead or max_features here</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>X_new</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.9/dist-packages/sklearn/svm/_base.py:1244: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="32">

  <div id="df-d1dabaed-5546-4280-908a-7a36c6179798">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sepal length (cm)</th>
<th data-quarto-table-cell-role="th">sepal width (cm)</th>
<th data-quarto-table-cell-role="th">petal length (cm)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>5.1</td>
<td>3.5</td>
<td>1.4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>4.9</td>
<td>3.0</td>
<td>1.4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>4.7</td>
<td>3.2</td>
<td>1.3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4.6</td>
<td>3.1</td>
<td>1.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5.0</td>
<td>3.6</td>
<td>1.4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">145</td>
<td>6.7</td>
<td>3.0</td>
<td>5.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">146</td>
<td>6.3</td>
<td>2.5</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">147</td>
<td>6.5</td>
<td>3.0</td>
<td>5.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">148</td>
<td>6.2</td>
<td>3.4</td>
<td>5.4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">149</td>
<td>5.9</td>
<td>3.0</td>
<td>5.1</td>
</tr>
</tbody>
</table>


<p>150 rows × 3 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-d1dabaed-5546-4280-908a-7a36c6179798')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-d1dabaed-5546-4280-908a-7a36c6179798 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-d1dabaed-5546-4280-908a-7a36c6179798');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
</section>
<section id="a-concret-example" class="level3" data-number="6.2.5">
<h3 data-number="6.2.5" class="anchored" data-anchor-id="a-concret-example"><span class="header-section-number">6.2.5</span> A Concret example</h3>
<p>The following dataset is our old friend which is a record of neighborhoods in California district, predicting the median house value (target) given some information about the neighborhoods, as the average number of rooms, the latitude, the longitude or the median income of people in the neighborhoods (block).</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:2800,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901218717,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="33">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1"></a>X, y <span class="op">=</span> fetch_california_housing(as_frame<span class="op">=</span><span class="va">True</span>, return_X_y<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:439,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901221304,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="1a4130b2-4ebe-4450-ee14-3ef2fc88e42d" data-execution_count="34">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1"></a><span class="co"># To speed up the computation, we take the first 10,000 samples</span></span>
<span id="cb38-2"><a href="#cb38-2"></a>X <span class="op">=</span> X[:<span class="dv">10000</span>]</span>
<span id="cb38-3"><a href="#cb38-3"></a>y <span class="op">=</span> y[:<span class="dv">10000</span>]</span>
<span id="cb38-4"><a href="#cb38-4"></a>X.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="34">

  <div id="df-780958ce-b767-4229-9669-3718ebb30ab3">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MedInc</th>
<th data-quarto-table-cell-role="th">HouseAge</th>
<th data-quarto-table-cell-role="th">AveRooms</th>
<th data-quarto-table-cell-role="th">AveBedrms</th>
<th data-quarto-table-cell-role="th">Population</th>
<th data-quarto-table-cell-role="th">AveOccup</th>
<th data-quarto-table-cell-role="th">Latitude</th>
<th data-quarto-table-cell-role="th">Longitude</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>8.3252</td>
<td>41.0</td>
<td>6.984127</td>
<td>1.023810</td>
<td>322.0</td>
<td>2.555556</td>
<td>37.88</td>
<td>-122.23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>8.3014</td>
<td>21.0</td>
<td>6.238137</td>
<td>0.971880</td>
<td>2401.0</td>
<td>2.109842</td>
<td>37.86</td>
<td>-122.22</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7.2574</td>
<td>52.0</td>
<td>8.288136</td>
<td>1.073446</td>
<td>496.0</td>
<td>2.802260</td>
<td>37.85</td>
<td>-122.24</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>5.6431</td>
<td>52.0</td>
<td>5.817352</td>
<td>1.073059</td>
<td>558.0</td>
<td>2.547945</td>
<td>37.85</td>
<td>-122.25</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>3.8462</td>
<td>52.0</td>
<td>6.281853</td>
<td>1.081081</td>
<td>565.0</td>
<td>2.181467</td>
<td>37.85</td>
<td>-122.25</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-780958ce-b767-4229-9669-3718ebb30ab3')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-780958ce-b767-4229-9669-3718ebb30ab3 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-780958ce-b767-4229-9669-3718ebb30ab3');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<p>The feature reads as follow:</p>
<ul>
<li><code>MedInc</code>: median income in block</li>
<li><code>HouseAge</code>: median house age in block</li>
<li><code>AveRooms</code>: average number of rooms</li>
<li><code>AveBedrms</code>: average number of bedrooms</li>
<li><code>Population</code>: block population</li>
<li><code>AveOccup</code>: average house occupancy</li>
<li><code>Latitude</code>: house block latitude</li>
<li><code>Longitude</code>: house block longitude</li>
<li><code>MedHouseVal</code>: Median house value in 100k$ (target)</li>
</ul>
<p>To assert the quality of our inspection technique, <strong>let’s add some random feature that won’t help the prediction (un-informative feature)</strong></p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:3,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901244414,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="0a64f124-0022-4611-b069-2e15c3c4d7d3" data-execution_count="35">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># Adding random features</span></span>
<span id="cb39-2"><a href="#cb39-2"></a>rng <span class="op">=</span> np.random.RandomState(<span class="dv">0</span>)</span>
<span id="cb39-3"><a href="#cb39-3"></a>bin_var <span class="op">=</span> pd.Series(rng.randint(<span class="dv">0</span>, <span class="dv">2</span>, X.shape[<span class="dv">0</span>]), name<span class="op">=</span><span class="st">'rnd_bin'</span>)</span>
<span id="cb39-4"><a href="#cb39-4"></a>num_var <span class="op">=</span> pd.Series(np.arange(X.shape[<span class="dv">0</span>]), name<span class="op">=</span><span class="st">'rnd_num'</span>)</span>
<span id="cb39-5"><a href="#cb39-5"></a>X_with_rnd_feat <span class="op">=</span> pd.concat((X, bin_var, num_var), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb39-6"><a href="#cb39-6"></a>X_with_rnd_feat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="35">

  <div id="df-67a9558c-63c6-4b2c-ae30-c3056f37fe65">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MedInc</th>
<th data-quarto-table-cell-role="th">HouseAge</th>
<th data-quarto-table-cell-role="th">AveRooms</th>
<th data-quarto-table-cell-role="th">AveBedrms</th>
<th data-quarto-table-cell-role="th">Population</th>
<th data-quarto-table-cell-role="th">AveOccup</th>
<th data-quarto-table-cell-role="th">Latitude</th>
<th data-quarto-table-cell-role="th">Longitude</th>
<th data-quarto-table-cell-role="th">rnd_bin</th>
<th data-quarto-table-cell-role="th">rnd_num</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>8.3252</td>
<td>41.0</td>
<td>6.984127</td>
<td>1.023810</td>
<td>322.0</td>
<td>2.555556</td>
<td>37.88</td>
<td>-122.23</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>8.3014</td>
<td>21.0</td>
<td>6.238137</td>
<td>0.971880</td>
<td>2401.0</td>
<td>2.109842</td>
<td>37.86</td>
<td>-122.22</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7.2574</td>
<td>52.0</td>
<td>8.288136</td>
<td>1.073446</td>
<td>496.0</td>
<td>2.802260</td>
<td>37.85</td>
<td>-122.24</td>
<td>1</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>5.6431</td>
<td>52.0</td>
<td>5.817352</td>
<td>1.073059</td>
<td>558.0</td>
<td>2.547945</td>
<td>37.85</td>
<td>-122.25</td>
<td>0</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>3.8462</td>
<td>52.0</td>
<td>6.281853</td>
<td>1.081081</td>
<td>565.0</td>
<td>2.181467</td>
<td>37.85</td>
<td>-122.25</td>
<td>1</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9995</td>
<td>4.0775</td>
<td>10.0</td>
<td>6.140900</td>
<td>1.025440</td>
<td>1275.0</td>
<td>2.495108</td>
<td>39.14</td>
<td>-121.03</td>
<td>0</td>
<td>9995</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9996</td>
<td>4.0848</td>
<td>8.0</td>
<td>6.350394</td>
<td>1.091864</td>
<td>1977.0</td>
<td>2.594488</td>
<td>39.13</td>
<td>-121.07</td>
<td>1</td>
<td>9996</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9997</td>
<td>3.6333</td>
<td>7.0</td>
<td>7.243455</td>
<td>1.107330</td>
<td>1143.0</td>
<td>2.992147</td>
<td>39.11</td>
<td>-121.05</td>
<td>0</td>
<td>9997</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9998</td>
<td>3.4630</td>
<td>8.0</td>
<td>6.363636</td>
<td>1.166297</td>
<td>1307.0</td>
<td>2.898004</td>
<td>39.08</td>
<td>-121.04</td>
<td>1</td>
<td>9998</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9999</td>
<td>3.0781</td>
<td>7.0</td>
<td>5.487500</td>
<td>1.050000</td>
<td>246.0</td>
<td>3.075000</td>
<td>39.09</td>
<td>-121.00</td>
<td>0</td>
<td>9999</td>
</tr>
</tbody>
</table>


<p>10000 rows × 10 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-67a9558c-63c6-4b2c-ae30-c3056f37fe65')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-67a9558c-63c6-4b2c-ae30-c3056f37fe65 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-67a9558c-63c6-4b2c-ae30-c3056f37fe65');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:517,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901261038,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="36">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X_with_rnd_feat, y, random_state<span class="op">=</span><span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In linear models, the target value is modeled as a linear combination of the features.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:292,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901268319,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="c0dc37dc-4991-4f42-8df3-240230b82581" data-execution_count="37">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1"></a>model <span class="op">=</span> RidgeCV()</span>
<span id="cb41-2"><a href="#cb41-2"></a></span>
<span id="cb41-3"><a href="#cb41-3"></a>model.fit(X_train, y_train)</span>
<span id="cb41-4"><a href="#cb41-4"></a></span>
<span id="cb41-5"><a href="#cb41-5"></a><span class="bu">print</span>(<span class="ss">f'model score on training data: </span><span class="sc">{</span>model<span class="sc">.</span>score(X_train, y_train)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb41-6"><a href="#cb41-6"></a><span class="bu">print</span>(<span class="ss">f'model score on testing data: </span><span class="sc">{</span>model<span class="sc">.</span>score(X_test, y_test)<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>model score on training data: 0.6049524592207427
model score on testing data: 0.5863921053581754</code></pre>
</div>
</div>
<p>Our linear model obtains a score of .60, so it explains a significant part of the target. Its coefficient should be somehow relevant. Let’s look at the coefficient learnt</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:322,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901280920,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="b24e3aac-9ebd-49d2-a9e9-4bc048b540a3" data-execution_count="38">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1"></a>coefs <span class="op">=</span> pd.DataFrame(</span>
<span id="cb43-2"><a href="#cb43-2"></a>   model.coef_,</span>
<span id="cb43-3"><a href="#cb43-3"></a>   columns<span class="op">=</span>[<span class="st">'Coefficients'</span>], index<span class="op">=</span>X_train.columns</span>
<span id="cb43-4"><a href="#cb43-4"></a>)</span>
<span id="cb43-5"><a href="#cb43-5"></a></span>
<span id="cb43-6"><a href="#cb43-6"></a>coefs.plot(kind<span class="op">=</span><span class="st">'barh'</span>, figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">7</span>))</span>
<span id="cb43-7"><a href="#cb43-7"></a>plt.title(<span class="st">'Ridge model'</span>)</span>
<span id="cb43-8"><a href="#cb43-8"></a>plt.axvline(x<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'.5'</span>)</span>
<span id="cb43-9"><a href="#cb43-9"></a>plt.subplots_adjust(left<span class="op">=</span><span class="fl">.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-39-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The <code>AveBedrms</code> have the higher coefficient. However, we can’t compare the magnitude of these coefficients directly, since they are not scaled. Indeed, <code>Population</code> is an integer which can be thousands, while <code>AveBedrms</code> is around 4 and <code>Latitude</code> is in degree.</p>
<p>So the <code>Population</code> coefficient is expressed in <code>“100k$/habitant”</code> while the <code>AveBedrms</code> is expressed in <code>“100k$/nb of bedrooms”</code> and the Latitude coefficient in <code>“100k$/degree”</code>. We see that changing population by one does not change the outcome, while as we go south (latitude increase) the price becomes cheaper. Also, adding a bedroom (keeping all other feature constant) shall rise the price of the house by <code>80k$</code>.</p>
<p>So looking at the coefficient plot to gauge feature importance can be misleading as some of them vary on a small scale, while others vary a lot more, several decades. <strong>So before any interpretation, we need to scale each column (removing the mean and scaling the variance to 1).</strong></p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:765,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901334295,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="000e5d6d-4da9-4ce9-c2d9-ec8084d6e4a7" data-execution_count="39">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1"></a>model <span class="op">=</span> make_pipeline(StandardScaler(), RidgeCV())</span>
<span id="cb44-2"><a href="#cb44-2"></a></span>
<span id="cb44-3"><a href="#cb44-3"></a>model.fit(X_train, y_train)</span>
<span id="cb44-4"><a href="#cb44-4"></a></span>
<span id="cb44-5"><a href="#cb44-5"></a><span class="bu">print</span>(<span class="ss">f'model score on training data: </span><span class="sc">{</span>model<span class="sc">.</span>score(X_train, y_train)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb44-6"><a href="#cb44-6"></a><span class="bu">print</span>(<span class="ss">f'model score on testing data: </span><span class="sc">{</span>model<span class="sc">.</span>score(X_test, y_test)<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>model score on training data: 0.6049222473801685
model score on testing data: 0.586090835494786</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:312,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901338683,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="a4a30132-e638-4fe0-9915-aa19bd63cfa1" data-execution_count="40">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1"></a>coefs <span class="op">=</span> pd.DataFrame(</span>
<span id="cb46-2"><a href="#cb46-2"></a>   model[<span class="dv">1</span>].coef_,</span>
<span id="cb46-3"><a href="#cb46-3"></a>   columns<span class="op">=</span>[<span class="st">'Coefficients'</span>], index<span class="op">=</span>X_train.columns</span>
<span id="cb46-4"><a href="#cb46-4"></a>)</span>
<span id="cb46-5"><a href="#cb46-5"></a></span>
<span id="cb46-6"><a href="#cb46-6"></a>coefs.plot(kind<span class="op">=</span><span class="st">'barh'</span>, figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">7</span>))</span>
<span id="cb46-7"><a href="#cb46-7"></a>plt.title(<span class="st">'Ridge model'</span>)</span>
<span id="cb46-8"><a href="#cb46-8"></a>plt.axvline(x<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'.5'</span>)</span>
<span id="cb46-9"><a href="#cb46-9"></a>plt.subplots_adjust(left<span class="op">=</span><span class="fl">.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-41-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Now that the coefficients have been scaled, we can safely compare them. The <code>MedInc</code> feature, with <code>longitude</code> and <code>latitude</code> are the three variables that most influence the model.</p>
<p>The plot above tells us about dependencies between a specific feature and the target when all other features remain constant, i.e., conditional dependencies. An increase of the <code>HouseAge</code> will induce an increase of the price when all other features remain constant. On the contrary, an increase of the <code>AveRooms</code> will induce an decrease of the price when all other features remain constant.</p>
<p>We can check the coefficient variability through cross-validation: it is a form of data perturbation.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:4040,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901370789,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="d63d8ff6-8403-4e0c-bc9a-d369d3d00685" data-execution_count="41">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1"></a>cv_model <span class="op">=</span> cross_validate(</span>
<span id="cb47-2"><a href="#cb47-2"></a>   model, X_with_rnd_feat, y, cv<span class="op">=</span>RepeatedKFold(n_splits<span class="op">=</span><span class="dv">5</span>, n_repeats<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb47-3"><a href="#cb47-3"></a>   return_estimator<span class="op">=</span><span class="va">True</span>, n_jobs<span class="op">=</span><span class="dv">2</span></span>
<span id="cb47-4"><a href="#cb47-4"></a>)</span>
<span id="cb47-5"><a href="#cb47-5"></a>coefs <span class="op">=</span> pd.DataFrame(</span>
<span id="cb47-6"><a href="#cb47-6"></a>   [model[<span class="dv">1</span>].coef_</span>
<span id="cb47-7"><a href="#cb47-7"></a>    <span class="cf">for</span> model <span class="kw">in</span> cv_model[<span class="st">'estimator'</span>]],</span>
<span id="cb47-8"><a href="#cb47-8"></a>   columns<span class="op">=</span>X_with_rnd_feat.columns</span>
<span id="cb47-9"><a href="#cb47-9"></a>)</span>
<span id="cb47-10"><a href="#cb47-10"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">7</span>))</span>
<span id="cb47-11"><a href="#cb47-11"></a>sns.boxplot(data<span class="op">=</span>coefs, orient<span class="op">=</span><span class="st">'h'</span>, color<span class="op">=</span><span class="st">'cyan'</span>, saturation<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb47-12"><a href="#cb47-12"></a>plt.axvline(x<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'.5'</span>)</span>
<span id="cb47-13"><a href="#cb47-13"></a>plt.xlabel(<span class="st">'Coefficient importance'</span>)</span>
<span id="cb47-14"><a href="#cb47-14"></a>plt.title(<span class="st">'Coefficient importance and its variability'</span>)</span>
<span id="cb47-15"><a href="#cb47-15"></a>plt.subplots_adjust(left<span class="op">=</span><span class="fl">.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-42-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Now if we want to select the four features which are the most important according to the coefficients. The <code>SelectFromModel()</code> is meant just for that. <code>SelectFromModel()</code> accepts a <code>threshold</code> parameter and will select the features whose importance (defined by the coefficients) are above this threshold.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:306,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901411615,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="81bf6eef-fb95-4030-fbb8-7a48c048e564" data-execution_count="42">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1"></a>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="42">
<style>#sk-container-id-2 {color: black;background-color: white;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('standardscaler', StandardScaler()), ('ridgecv', RidgeCV())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox"><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('standardscaler', StandardScaler()), ('ridgecv', RidgeCV())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox"><label for="sk-estimator-id-5" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox"><label for="sk-estimator-id-6" class="sk-toggleable__label sk-toggleable__label-arrow">RidgeCV</label><div class="sk-toggleable__content"><pre>RidgeCV()</pre></div></div></div></div></div></div></div>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901411911,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="43">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1"></a>importance <span class="op">=</span> np.<span class="bu">abs</span>(model[<span class="dv">1</span>].coef_)</span>
<span id="cb49-2"><a href="#cb49-2"></a>threshold <span class="op">=</span> np.sort(importance)[<span class="op">-</span><span class="dv">5</span>] <span class="op">+</span> <span class="fl">0.01</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:274,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901456613,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="135be6d0-2f0f-48f3-e934-48cb58410c10" data-execution_count="44">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1"></a>sfm <span class="op">=</span> SelectFromModel(model[<span class="dv">1</span>], threshold<span class="op">=</span>threshold).fit(X, y)</span>
<span id="cb50-2"><a href="#cb50-2"></a><span class="bu">print</span>(<span class="ss">f"Features selected by SelectFromModel: </span><span class="sc">{</span>sfm<span class="sc">.</span>get_feature_names_out()<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Features selected by SelectFromModel: ['MedInc' 'AveBedrms' 'Latitude' 'Longitude']</code></pre>
</div>
</div>
<section id="linear-models-with-sparse-coefficients-lasso" class="level4" data-number="6.2.5.1">
<h4 data-number="6.2.5.1" class="anchored" data-anchor-id="linear-models-with-sparse-coefficients-lasso"><span class="header-section-number">6.2.5.1</span> Linear models with sparse coefficients (Lasso)</h4>
<p>In it important to keep in mind that the associations extracted depend on the model. To illustrate this point we consider a Lasso model, that performs feature selection with a L1 penalty. Let us fit a Lasso model with a strong regularization parameters <code>alpha</code></p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:282,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901473622,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="8d389fbe-8dd7-435f-b9fc-8a9da1067dce" data-execution_count="45">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1"></a>model <span class="op">=</span> make_pipeline(StandardScaler(), Lasso(alpha<span class="op">=</span><span class="fl">.015</span>))</span>
<span id="cb52-2"><a href="#cb52-2"></a></span>
<span id="cb52-3"><a href="#cb52-3"></a>model.fit(X_train, y_train)</span>
<span id="cb52-4"><a href="#cb52-4"></a></span>
<span id="cb52-5"><a href="#cb52-5"></a><span class="bu">print</span>(<span class="ss">f'model score on training data: </span><span class="sc">{</span>model<span class="sc">.</span>score(X_train, y_train)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb52-6"><a href="#cb52-6"></a><span class="bu">print</span>(<span class="ss">f'model score on testing data: </span><span class="sc">{</span>model<span class="sc">.</span>score(X_test, y_test)<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>model score on training data: 0.5933235371761756
model score on testing data: 0.5673786563118284</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1269,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901479711,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="a40f6d2b-9730-4fa3-cbc7-ea5cdbe62657" data-execution_count="46">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1"></a>coefs <span class="op">=</span> pd.DataFrame(</span>
<span id="cb54-2"><a href="#cb54-2"></a>   model[<span class="dv">1</span>].coef_,</span>
<span id="cb54-3"><a href="#cb54-3"></a>   columns<span class="op">=</span>[<span class="st">'Coefficients'</span>], index<span class="op">=</span>X_train.columns</span>
<span id="cb54-4"><a href="#cb54-4"></a>)</span>
<span id="cb54-5"><a href="#cb54-5"></a></span>
<span id="cb54-6"><a href="#cb54-6"></a>coefs.plot(kind<span class="op">=</span><span class="st">'barh'</span>, figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">7</span>))</span>
<span id="cb54-7"><a href="#cb54-7"></a>plt.title(<span class="st">'Lasso model, strong regularization'</span>)</span>
<span id="cb54-8"><a href="#cb54-8"></a>plt.axvline(x<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'.5'</span>)</span>
<span id="cb54-9"><a href="#cb54-9"></a>plt.subplots_adjust(left<span class="op">=</span><span class="fl">.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-47-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Here the model score is a bit lower, because of the strong regularization. However, it has zeroed out 3 coefficients, selecting a small number of variables to make its prediction.</p>
</section>
<section id="randomforest-with-feature-importance" class="level4" data-number="6.2.5.2">
<h4 data-number="6.2.5.2" class="anchored" data-anchor-id="randomforest-with-feature-importance"><span class="header-section-number">6.2.5.2</span> Randomforest with feature importance</h4>
<p>On some algorithms, there are some feature importance methods, inherently built within the model. It is the case in RandomForest models. Let’s investigate the built-in <code>feature_importances_</code> attribute.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:8276,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901529209,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="bbccb1b4-3d67-4f86-d5a3-b6104325fa8b" data-execution_count="47">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1"></a>model <span class="op">=</span> RandomForestRegressor()</span>
<span id="cb55-2"><a href="#cb55-2"></a></span>
<span id="cb55-3"><a href="#cb55-3"></a>model.fit(X_train, y_train)</span>
<span id="cb55-4"><a href="#cb55-4"></a></span>
<span id="cb55-5"><a href="#cb55-5"></a><span class="bu">print</span>(<span class="ss">f'model score on training data: </span><span class="sc">{</span>model<span class="sc">.</span>score(X_train, y_train)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb55-6"><a href="#cb55-6"></a><span class="bu">print</span>(<span class="ss">f'model score on testing data: </span><span class="sc">{</span>model<span class="sc">.</span>score(X_test, y_test)<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>model score on training data: 0.9796643318943656
model score on testing data: 0.8429137479202747</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:499,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901538164,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="1915470e-203b-42a9-975b-5c45f1b39d37" data-execution_count="48">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1"></a>importances <span class="op">=</span> model.feature_importances_</span>
<span id="cb57-2"><a href="#cb57-2"></a>indices <span class="op">=</span> np.argsort(importances)</span>
<span id="cb57-3"><a href="#cb57-3"></a></span>
<span id="cb57-4"><a href="#cb57-4"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb57-5"><a href="#cb57-5"></a>ax.barh(<span class="bu">range</span>(<span class="bu">len</span>(importances)), importances[indices])</span>
<span id="cb57-6"><a href="#cb57-6"></a>ax.set_yticks(<span class="bu">range</span>(<span class="bu">len</span>(importances)))</span>
<span id="cb57-7"><a href="#cb57-7"></a>_ <span class="op">=</span> ax.set_yticklabels(np.array(X_train.columns)[indices])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-49-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><code>MedInc</code> is still the most important feature. It also has a small bias toward high cardinality features, such as the noisy feature <code>rnd_num</code>, which are here predicted having <code>0.1</code> importance, more than <code>HouseAge</code> (which has low cardinality).</p>
</section>
<section id="feature-importance-by-permutation" class="level4" data-number="6.2.5.3">
<h4 data-number="6.2.5.3" class="anchored" data-anchor-id="feature-importance-by-permutation"><span class="header-section-number">6.2.5.3</span> Feature importance by permutation</h4>
<p>We introduce here a new technique to evaluate the feature importance of any given fitted model. It basically shuffles a feature and sees how the model changes its prediction. Thus, the change in prediction will correspond to the feature importance.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:11590,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901604491,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="c35c365f-42f5-43d3-b4cd-3a96865ddc78" data-execution_count="49">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1"></a><span class="co"># Any model could be used here</span></span>
<span id="cb58-2"><a href="#cb58-2"></a></span>
<span id="cb58-3"><a href="#cb58-3"></a>model <span class="op">=</span> RandomForestRegressor()</span>
<span id="cb58-4"><a href="#cb58-4"></a>model.fit(X_train, y_train)</span>
<span id="cb58-5"><a href="#cb58-5"></a></span>
<span id="cb58-6"><a href="#cb58-6"></a><span class="bu">print</span>(<span class="ss">f'model score on training data: </span><span class="sc">{</span>model<span class="sc">.</span>score(X_train, y_train)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb58-7"><a href="#cb58-7"></a><span class="bu">print</span>(<span class="ss">f'model score on testing data: </span><span class="sc">{</span>model<span class="sc">.</span>score(X_test, y_test)<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>model score on training data: 0.9795458070557226
model score on testing data: 0.8448700648905965</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:24836,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901639004,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="50">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1"></a>r <span class="op">=</span> permutation_importance(model, X_test, y_test, n_repeats<span class="op">=</span><span class="dv">30</span>, random_state<span class="op">=</span><span class="dv">42</span>) <span class="co"># Notice that the model are already fitted</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:437,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901639438,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="e2b4137a-301c-4817-9da9-7ee3afbd31d0" data-execution_count="51">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb61-2"><a href="#cb61-2"></a></span>
<span id="cb61-3"><a href="#cb61-3"></a>indices <span class="op">=</span> r.importances_mean.argsort()</span>
<span id="cb61-4"><a href="#cb61-4"></a>plt.barh(<span class="bu">range</span>(<span class="bu">len</span>(indices)), r.importances_mean[indices], xerr<span class="op">=</span>r.importances_std[indices])</span>
<span id="cb61-5"><a href="#cb61-5"></a></span>
<span id="cb61-6"><a href="#cb61-6"></a>ax.set_yticks(<span class="bu">range</span>(<span class="bu">len</span>(indices)))</span>
<span id="cb61-7"><a href="#cb61-7"></a>_ <span class="op">=</span> ax.set_yticklabels(np.array(X_train.columns)[indices])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-52-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>We see again that the feature <code>MedInc</code>, <code>Latitude</code> and <code>Longitude</code> are important for the model. We note that our random variable <code>rnd_num</code> is now less important than <code>Latitude</code>. Indeed, the feature importance built-in in <code>RandomForest</code> has bias for continuous data, such as <code>AveOccup</code> and <code>rnd_num</code>.</p>
</section>
<section id="feature-rejection-using-boruta" class="level4" data-number="6.2.5.4">
<h4 data-number="6.2.5.4" class="anchored" data-anchor-id="feature-rejection-using-boruta"><span class="header-section-number">6.2.5.4</span> Feature rejection using Boruta</h4>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:274,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901682761,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="52">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1"></a><span class="co"># define Boruta feature selection method</span></span>
<span id="cb62-2"><a href="#cb62-2"></a>model <span class="op">=</span> RandomForestRegressor()</span>
<span id="cb62-3"><a href="#cb62-3"></a>feat_selector <span class="op">=</span> BorutaPy(model, n_estimators<span class="op">=</span><span class="st">'auto'</span>, verbose<span class="op">=</span><span class="dv">2</span>, random_state<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:46607,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901736545,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="40259f4e-fa96-42db-9365-7d98f8040ff3" data-execution_count="53">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1"></a><span class="co"># find all relevant features </span></span>
<span id="cb63-2"><a href="#cb63-2"></a>feat_selector.fit(X_train.to_numpy(), y_train.to_numpy())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Iteration:  1 / 100
Confirmed:  0
Tentative:  10
Rejected:   0
Iteration:  2 / 100
Confirmed:  0
Tentative:  10
Rejected:   0
Iteration:  3 / 100
Confirmed:  0
Tentative:  10
Rejected:   0
Iteration:  4 / 100
Confirmed:  0
Tentative:  10
Rejected:   0
Iteration:  5 / 100
Confirmed:  0
Tentative:  10
Rejected:   0
Iteration:  6 / 100
Confirmed:  0
Tentative:  10
Rejected:   0
Iteration:  7 / 100
Confirmed:  0
Tentative:  10
Rejected:   0
Iteration:  8 / 100
Confirmed:  9
Tentative:  0
Rejected:   1


BorutaPy finished running.

Iteration:  9 / 100
Confirmed:  9
Tentative:  0
Rejected:   1</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="53">
<style>#sk-container-id-3 {color: black;background-color: white;}#sk-container-id-3 pre{padding: 0;}#sk-container-id-3 div.sk-toggleable {background-color: white;}#sk-container-id-3 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-3 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-3 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-3 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-3 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-3 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-3 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-3 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-3 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-3 div.sk-item {position: relative;z-index: 1;}#sk-container-id-3 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-3 div.sk-item::before, #sk-container-id-3 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-3 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-3 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-3 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-3 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-3 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-3 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-3 div.sk-label-container {text-align: center;}#sk-container-id-3 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-3 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>BorutaPy(estimator=RandomForestRegressor(n_estimators=44,
                                         random_state=RandomState(MT19937) at 0x7F60C3A0E640),
         n_estimators='auto',
         random_state=RandomState(MT19937) at 0x7F60C3A0E640, verbose=2)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox"><label for="sk-estimator-id-7" class="sk-toggleable__label sk-toggleable__label-arrow">BorutaPy</label><div class="sk-toggleable__content"><pre>BorutaPy(estimator=RandomForestRegressor(n_estimators=44,
                                         random_state=RandomState(MT19937) at 0x7F60C3A0E640),
         n_estimators='auto',
         random_state=RandomState(MT19937) at 0x7F60C3A0E640, verbose=2)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox"><label for="sk-estimator-id-8" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: RandomForestRegressor</label><div class="sk-toggleable__content"><pre>RandomForestRegressor(n_estimators=44,
                      random_state=RandomState(MT19937) at 0x7F60C3A0E640)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox"><label for="sk-estimator-id-9" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestRegressor</label><div class="sk-toggleable__content"><pre>RandomForestRegressor(n_estimators=44,
                      random_state=RandomState(MT19937) at 0x7F60C3A0E640)</pre></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:3,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901744385,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="a350d5b8-f952-476b-de74-df556e3e058f" data-execution_count="54">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1"></a>X_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="54">

  <div id="df-124a27d1-b6a5-48d8-8791-cb1d995cf8cf">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MedInc</th>
<th data-quarto-table-cell-role="th">HouseAge</th>
<th data-quarto-table-cell-role="th">AveRooms</th>
<th data-quarto-table-cell-role="th">AveBedrms</th>
<th data-quarto-table-cell-role="th">Population</th>
<th data-quarto-table-cell-role="th">AveOccup</th>
<th data-quarto-table-cell-role="th">Latitude</th>
<th data-quarto-table-cell-role="th">Longitude</th>
<th data-quarto-table-cell-role="th">rnd_bin</th>
<th data-quarto-table-cell-role="th">rnd_num</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">4901</td>
<td>1.3287</td>
<td>43.0</td>
<td>4.036723</td>
<td>1.090395</td>
<td>1412.0</td>
<td>3.988701</td>
<td>34.01</td>
<td>-118.25</td>
<td>0</td>
<td>4901</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4375</td>
<td>2.3421</td>
<td>48.0</td>
<td>3.425532</td>
<td>1.046809</td>
<td>633.0</td>
<td>2.693617</td>
<td>34.10</td>
<td>-118.28</td>
<td>0</td>
<td>4375</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6698</td>
<td>3.6572</td>
<td>26.0</td>
<td>4.160797</td>
<td>1.093023</td>
<td>3001.0</td>
<td>1.994020</td>
<td>34.14</td>
<td>-118.10</td>
<td>0</td>
<td>6698</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9805</td>
<td>3.2750</td>
<td>52.0</td>
<td>8.357827</td>
<td>1.543131</td>
<td>582.0</td>
<td>1.859425</td>
<td>36.55</td>
<td>-121.92</td>
<td>1</td>
<td>9805</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1101</td>
<td>3.5189</td>
<td>15.0</td>
<td>5.489011</td>
<td>1.027473</td>
<td>1786.0</td>
<td>2.453297</td>
<td>39.82</td>
<td>-121.68</td>
<td>0</td>
<td>1101</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5734</td>
<td>5.1718</td>
<td>31.0</td>
<td>5.676417</td>
<td>1.063985</td>
<td>1359.0</td>
<td>2.484461</td>
<td>34.16</td>
<td>-118.23</td>
<td>0</td>
<td>5734</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5191</td>
<td>1.5256</td>
<td>36.0</td>
<td>4.897778</td>
<td>1.097778</td>
<td>702.0</td>
<td>3.120000</td>
<td>33.93</td>
<td>-118.26</td>
<td>1</td>
<td>5191</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5390</td>
<td>2.9344</td>
<td>36.0</td>
<td>3.986717</td>
<td>1.079696</td>
<td>1756.0</td>
<td>3.332068</td>
<td>34.03</td>
<td>-118.38</td>
<td>0</td>
<td>5390</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">860</td>
<td>5.7192</td>
<td>15.0</td>
<td>6.395349</td>
<td>1.067979</td>
<td>1777.0</td>
<td>3.178891</td>
<td>37.58</td>
<td>-121.96</td>
<td>0</td>
<td>860</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7270</td>
<td>2.3900</td>
<td>25.0</td>
<td>3.928287</td>
<td>1.235060</td>
<td>1439.0</td>
<td>5.733068</td>
<td>33.98</td>
<td>-118.23</td>
<td>1</td>
<td>7270</td>
</tr>
</tbody>
</table>


<p>7500 rows × 10 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-124a27d1-b6a5-48d8-8791-cb1d995cf8cf')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-124a27d1-b6a5-48d8-8791-cb1d995cf8cf button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-124a27d1-b6a5-48d8-8791-cb1d995cf8cf');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:2,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901747273,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="5761a655-842e-4a6b-9e4f-bf2b2577992d" data-execution_count="55">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1"></a><span class="co"># check selected features </span></span>
<span id="cb66-2"><a href="#cb66-2"></a>np.array(X_train.columns)[feat_selector.support_]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>array(['MedInc', 'HouseAge', 'AveRooms', 'AveBedrms', 'Population',
       'AveOccup', 'Latitude', 'Longitude', 'rnd_num'], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:738,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901754035,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="6af37f41-2c29-4783-d699-16a840f5088a" data-execution_count="56">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1"></a><span class="co"># check ranking of features</span></span>
<span id="cb68-2"><a href="#cb68-2"></a>feat_selector.ranking_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>array([1, 1, 1, 1, 1, 1, 1, 1, 2, 1])</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:297,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901767677,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="eec65028-4995-4b19-89a5-889a816a4a5e" data-execution_count="57">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1"></a><span class="co"># call transform() on X to filter it down to selected features</span></span>
<span id="cb70-2"><a href="#cb70-2"></a>X_filtered <span class="op">=</span> feat_selector.transform(X_train.to_numpy())</span>
<span id="cb70-3"><a href="#cb70-3"></a>X_filtered.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>(7500, 9)</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="dimensional-reduction" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="dimensional-reduction"><span class="header-section-number">6.3</span> Dimensional reduction</h2>
<p>We now looked at our model-based method for feature engineering: principal component analysis (PCA). You could think of PCA as a partitioning of the variation in the data. PCA is a great tool to help you discover important relationships in the data and can also be used to create more informative features.</p>
<p>There are two ways you could use PCA for feature engineering.</p>
<ol type="1">
<li><p>The first way is to use it as a descriptive technique. Since the components tell you about the variation, <strong>you could compute the MI scores for the components and see what kind of variation is most predictive of your target.</strong> That could give you ideas for kinds of features to create – a product of <code>'Height'</code> and <code>'Diameter'</code> if <code>'Size'</code> is important, say, or a ratio of <code>'Height'</code> and <code>'Diameter'</code> if <code>Shape</code> is important. You could even try clustering on one or more of the high-scoring components. <a href="https://blog.bioturing.com/2018/06/18/how-to-read-pca-biplots-and-scree-plots/">Biplot</a> will be useful in this case.</p></li>
<li><p>The second way is to use the components themselves as features. Because the components expose the variational structure of the data directly, <strong>they can often be more informative than the original features.</strong> Here are some use-cases:</p></li>
</ol>
<ul>
<li><strong>Dimensionality reduction</strong>: When your features are highly redundant (<em>multicollinear</em>, specifically), PCA will partition out the redundancy into one or more near-zero variance components, which you can then drop since they will contain little or no information.</li>
<li><strong>Anomaly detection</strong>: Unusual variation, not apparent from the original features, will often show up in the low-variance components. These components could be highly informative in an anomaly or outlier detection task.</li>
<li><strong>Noise reduction</strong>: A collection of sensor readings will often share some common background noise. PCA can sometimes collect the (informative) signal into a smaller number of features while leaving the noise alone, thus boosting the signal-to-noise ratio.</li>
<li><strong>Decorrelation</strong>: Some ML algorithms struggle with highly-correlated features. PCA transforms correlated features into uncorrelated components, which could be easier for your algorithm to work with.</li>
</ul>
<p>PCA basically gives you direct access to the correlational structure of your data. You’ll no doubt come up with applications of your own!</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:350,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901796849,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="58">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1"></a><span class="kw">def</span> plot_variance(pca, width<span class="op">=</span><span class="dv">8</span>, dpi<span class="op">=</span><span class="dv">100</span>):</span>
<span id="cb72-2"><a href="#cb72-2"></a>    <span class="co"># Create figure</span></span>
<span id="cb72-3"><a href="#cb72-3"></a>    fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb72-4"><a href="#cb72-4"></a>    n <span class="op">=</span> pca.n_components_</span>
<span id="cb72-5"><a href="#cb72-5"></a>    grid <span class="op">=</span> np.arange(<span class="dv">1</span>, n <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb72-6"><a href="#cb72-6"></a>    <span class="co"># Explained variance</span></span>
<span id="cb72-7"><a href="#cb72-7"></a>    evr <span class="op">=</span> pca.explained_variance_ratio_</span>
<span id="cb72-8"><a href="#cb72-8"></a>    axs[<span class="dv">0</span>].bar(grid, evr)</span>
<span id="cb72-9"><a href="#cb72-9"></a>    axs[<span class="dv">0</span>].<span class="bu">set</span>(</span>
<span id="cb72-10"><a href="#cb72-10"></a>        xlabel<span class="op">=</span><span class="st">"Component"</span>, title<span class="op">=</span><span class="st">"</span><span class="sc">% E</span><span class="st">xplained Variance"</span>, ylim<span class="op">=</span>(<span class="fl">0.0</span>, <span class="fl">1.0</span>)</span>
<span id="cb72-11"><a href="#cb72-11"></a>    )</span>
<span id="cb72-12"><a href="#cb72-12"></a>    <span class="co"># Cumulative Variance</span></span>
<span id="cb72-13"><a href="#cb72-13"></a>    cv <span class="op">=</span> np.cumsum(evr)</span>
<span id="cb72-14"><a href="#cb72-14"></a>    axs[<span class="dv">1</span>].plot(np.r_[<span class="dv">0</span>, grid], np.r_[<span class="dv">0</span>, cv], <span class="st">"o-"</span>)</span>
<span id="cb72-15"><a href="#cb72-15"></a>    axs[<span class="dv">1</span>].<span class="bu">set</span>(</span>
<span id="cb72-16"><a href="#cb72-16"></a>        xlabel<span class="op">=</span><span class="st">"Component"</span>, title<span class="op">=</span><span class="st">"% Cumulative Variance"</span>, ylim<span class="op">=</span>(<span class="fl">0.0</span>, <span class="fl">1.0</span>)</span>
<span id="cb72-17"><a href="#cb72-17"></a>    )</span>
<span id="cb72-18"><a href="#cb72-18"></a>    <span class="co"># Set up figure</span></span>
<span id="cb72-19"><a href="#cb72-19"></a>    fig.<span class="bu">set</span>(figwidth<span class="op">=</span><span class="dv">8</span>, dpi<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb72-20"><a href="#cb72-20"></a>    <span class="cf">return</span> axs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:3,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901799544,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="63589743-1f19-44fd-9501-905be627050d" data-execution_count="59">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"autos.csv"</span>)</span>
<span id="cb73-2"><a href="#cb73-2"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="59">

  <div id="df-f944dfb8-7bc7-4523-a19e-f88e7d851f48">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">symboling</th>
<th data-quarto-table-cell-role="th">make</th>
<th data-quarto-table-cell-role="th">fuel_type</th>
<th data-quarto-table-cell-role="th">aspiration</th>
<th data-quarto-table-cell-role="th">num_of_doors</th>
<th data-quarto-table-cell-role="th">body_style</th>
<th data-quarto-table-cell-role="th">drive_wheels</th>
<th data-quarto-table-cell-role="th">engine_location</th>
<th data-quarto-table-cell-role="th">wheel_base</th>
<th data-quarto-table-cell-role="th">length</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">engine_size</th>
<th data-quarto-table-cell-role="th">fuel_system</th>
<th data-quarto-table-cell-role="th">bore</th>
<th data-quarto-table-cell-role="th">stroke</th>
<th data-quarto-table-cell-role="th">compression_ratio</th>
<th data-quarto-table-cell-role="th">horsepower</th>
<th data-quarto-table-cell-role="th">peak_rpm</th>
<th data-quarto-table-cell-role="th">city_mpg</th>
<th data-quarto-table-cell-role="th">highway_mpg</th>
<th data-quarto-table-cell-role="th">price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>3</td>
<td>alfa-romero</td>
<td>gas</td>
<td>std</td>
<td>2</td>
<td>convertible</td>
<td>rwd</td>
<td>front</td>
<td>88.6</td>
<td>168.8</td>
<td>...</td>
<td>130</td>
<td>mpfi</td>
<td>3.47</td>
<td>2.68</td>
<td>9</td>
<td>111</td>
<td>5000</td>
<td>21</td>
<td>27</td>
<td>13495</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3</td>
<td>alfa-romero</td>
<td>gas</td>
<td>std</td>
<td>2</td>
<td>convertible</td>
<td>rwd</td>
<td>front</td>
<td>88.6</td>
<td>168.8</td>
<td>...</td>
<td>130</td>
<td>mpfi</td>
<td>3.47</td>
<td>2.68</td>
<td>9</td>
<td>111</td>
<td>5000</td>
<td>21</td>
<td>27</td>
<td>16500</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>alfa-romero</td>
<td>gas</td>
<td>std</td>
<td>2</td>
<td>hatchback</td>
<td>rwd</td>
<td>front</td>
<td>94.5</td>
<td>171.2</td>
<td>...</td>
<td>152</td>
<td>mpfi</td>
<td>2.68</td>
<td>3.47</td>
<td>9</td>
<td>154</td>
<td>5000</td>
<td>19</td>
<td>26</td>
<td>16500</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2</td>
<td>audi</td>
<td>gas</td>
<td>std</td>
<td>4</td>
<td>sedan</td>
<td>fwd</td>
<td>front</td>
<td>99.8</td>
<td>176.6</td>
<td>...</td>
<td>109</td>
<td>mpfi</td>
<td>3.19</td>
<td>3.40</td>
<td>10</td>
<td>102</td>
<td>5500</td>
<td>24</td>
<td>30</td>
<td>13950</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2</td>
<td>audi</td>
<td>gas</td>
<td>std</td>
<td>4</td>
<td>sedan</td>
<td>4wd</td>
<td>front</td>
<td>99.4</td>
<td>176.6</td>
<td>...</td>
<td>136</td>
<td>mpfi</td>
<td>3.19</td>
<td>3.40</td>
<td>8</td>
<td>115</td>
<td>5500</td>
<td>18</td>
<td>22</td>
<td>17450</td>
</tr>
</tbody>
</table>


<p>5 rows × 25 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-f944dfb8-7bc7-4523-a19e-f88e7d851f48')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-f944dfb8-7bc7-4523-a19e-f88e7d851f48 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-f944dfb8-7bc7-4523-a19e-f88e7d851f48');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<p>We’ve selected four features that cover a range of properties. Each of these features also has a high MI score with the target, <code>price</code>. We’ll standardize the data since these features aren’t naturally on the same scale.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:267,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901810358,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="60">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1"></a>features <span class="op">=</span> [<span class="st">"highway_mpg"</span>, <span class="st">"engine_size"</span>, <span class="st">"horsepower"</span>, <span class="st">"curb_weight"</span>]</span>
<span id="cb74-2"><a href="#cb74-2"></a></span>
<span id="cb74-3"><a href="#cb74-3"></a>X <span class="op">=</span> df.copy()</span>
<span id="cb74-4"><a href="#cb74-4"></a>y <span class="op">=</span> X.pop(<span class="st">'price'</span>)</span>
<span id="cb74-5"><a href="#cb74-5"></a>X <span class="op">=</span> X.loc[:, features]</span>
<span id="cb74-6"><a href="#cb74-6"></a></span>
<span id="cb74-7"><a href="#cb74-7"></a><span class="co"># Standardize</span></span>
<span id="cb74-8"><a href="#cb74-8"></a>X_scaled <span class="op">=</span> (X <span class="op">-</span> X.mean(axis<span class="op">=</span><span class="dv">0</span>)) <span class="op">/</span> X.std(axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now we can fit scikit-learn’s <code>PCA</code> estimator and create the principal components. You can see here the first few rows of the transformed dataset.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:3,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901848947,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="ae5ed552-e6d4-43bc-86d4-7e4fb05e670e" data-execution_count="61">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1"></a><span class="co"># Create principal components</span></span>
<span id="cb75-2"><a href="#cb75-2"></a>pca <span class="op">=</span> PCA()</span>
<span id="cb75-3"><a href="#cb75-3"></a>X_pca <span class="op">=</span> pca.fit_transform(X_scaled)</span>
<span id="cb75-4"><a href="#cb75-4"></a></span>
<span id="cb75-5"><a href="#cb75-5"></a><span class="co"># Convert to dataframe</span></span>
<span id="cb75-6"><a href="#cb75-6"></a>component_names <span class="op">=</span> [<span class="ss">f"PC</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(X_pca.shape[<span class="dv">1</span>])]</span>
<span id="cb75-7"><a href="#cb75-7"></a>X_pca <span class="op">=</span> pd.DataFrame(X_pca, columns<span class="op">=</span>component_names)</span>
<span id="cb75-8"><a href="#cb75-8"></a></span>
<span id="cb75-9"><a href="#cb75-9"></a>X_pca.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="61">

  <div id="df-f84d8e50-b1a9-4a0f-b838-cca4ee8041e1">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PC1</th>
<th data-quarto-table-cell-role="th">PC2</th>
<th data-quarto-table-cell-role="th">PC3</th>
<th data-quarto-table-cell-role="th">PC4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.382486</td>
<td>-0.400222</td>
<td>0.124122</td>
<td>0.169539</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.382486</td>
<td>-0.400222</td>
<td>0.124122</td>
<td>0.169539</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1.550890</td>
<td>-0.107175</td>
<td>0.598361</td>
<td>-0.256081</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>-0.408859</td>
<td>-0.425947</td>
<td>0.243335</td>
<td>0.013920</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1.132749</td>
<td>-0.814565</td>
<td>-0.202885</td>
<td>0.224138</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>0.547265</td>
<td>-0.545141</td>
<td>0.139969</td>
<td>0.424955</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>0.869268</td>
<td>-0.472834</td>
<td>-0.294073</td>
<td>0.090174</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>0.974373</td>
<td>-0.449233</td>
<td>-0.435749</td>
<td>-0.019102</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>1.796553</td>
<td>-1.050783</td>
<td>-0.081821</td>
<td>-0.296071</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>-0.306514</td>
<td>-0.542020</td>
<td>0.138605</td>
<td>0.012612</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-f84d8e50-b1a9-4a0f-b838-cca4ee8041e1')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-f84d8e50-b1a9-4a0f-b838-cca4ee8041e1 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-f84d8e50-b1a9-4a0f-b838-cca4ee8041e1');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<p>After fitting, the <code>PCA</code> instance contains the loadings in its <code>components_</code> attribute. We’ll wrap the loadings up in a dataframe.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:288,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901863735,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="483e33c4-629c-46b3-c9ad-60480b5fb5f3" data-execution_count="62">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1"></a>loadings <span class="op">=</span> pd.DataFrame(</span>
<span id="cb76-2"><a href="#cb76-2"></a>    pca.components_.T,  <span class="co"># transpose the matrix of loadings</span></span>
<span id="cb76-3"><a href="#cb76-3"></a>    columns<span class="op">=</span>component_names,  <span class="co"># so the columns are the principal components</span></span>
<span id="cb76-4"><a href="#cb76-4"></a>    index<span class="op">=</span>X.columns,  <span class="co"># and the rows are the original features</span></span>
<span id="cb76-5"><a href="#cb76-5"></a>)</span>
<span id="cb76-6"><a href="#cb76-6"></a>loadings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="62">

  <div id="df-53bb437e-66cf-471c-8c8b-54147cb7111c">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PC1</th>
<th data-quarto-table-cell-role="th">PC2</th>
<th data-quarto-table-cell-role="th">PC3</th>
<th data-quarto-table-cell-role="th">PC4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">highway_mpg</td>
<td>-0.492347</td>
<td>0.770892</td>
<td>0.070142</td>
<td>-0.397996</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">engine_size</td>
<td>0.503859</td>
<td>0.626709</td>
<td>0.019960</td>
<td>0.594107</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">horsepower</td>
<td>0.500448</td>
<td>0.013788</td>
<td>0.731093</td>
<td>-0.463534</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">curb_weight</td>
<td>0.503262</td>
<td>0.113008</td>
<td>-0.678369</td>
<td>-0.523232</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-53bb437e-66cf-471c-8c8b-54147cb7111c')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-53bb437e-66cf-471c-8c8b-54147cb7111c button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-53bb437e-66cf-471c-8c8b-54147cb7111c');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:493,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901898196,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="3350ba28-d0ce-47bc-813b-d1db0a762f4f" data-execution_count="63">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1"></a><span class="co"># biplot </span></span>
<span id="cb77-2"><a href="#cb77-2"></a>xvector <span class="op">=</span> pca.components_[<span class="dv">0</span>] </span>
<span id="cb77-3"><a href="#cb77-3"></a>yvector <span class="op">=</span> <span class="op">-</span>pca.components_[<span class="dv">1</span>]</span>
<span id="cb77-4"><a href="#cb77-4"></a></span>
<span id="cb77-5"><a href="#cb77-5"></a>xs <span class="op">=</span> X_pca.to_numpy()[:,<span class="dv">0</span>] </span>
<span id="cb77-6"><a href="#cb77-6"></a>ys <span class="op">=</span> <span class="op">-</span>X_pca.to_numpy()[:,<span class="dv">1</span>]</span>
<span id="cb77-7"><a href="#cb77-7"></a></span>
<span id="cb77-8"><a href="#cb77-8"></a>fig, ax1 <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">9</span>))</span>
<span id="cb77-9"><a href="#cb77-9"></a></span>
<span id="cb77-10"><a href="#cb77-10"></a><span class="co"># First Plot : Principal Component Scores </span></span>
<span id="cb77-11"><a href="#cb77-11"></a>x_min, x_max <span class="op">=</span> <span class="op">-</span><span class="dv">8</span>, <span class="dv">8</span></span>
<span id="cb77-12"><a href="#cb77-12"></a>y_min, y_max <span class="op">=</span> <span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span></span>
<span id="cb77-13"><a href="#cb77-13"></a>ax1.set_xlim(x_min, x_max)</span>
<span id="cb77-14"><a href="#cb77-14"></a>ax1.set_ylim(y_min, y_max)</span>
<span id="cb77-15"><a href="#cb77-15"></a></span>
<span id="cb77-16"><a href="#cb77-16"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(xs)):</span>
<span id="cb77-17"><a href="#cb77-17"></a>    plt.plot(xs[i], ys[i], <span class="st">'bo'</span>)</span>
<span id="cb77-18"><a href="#cb77-18"></a></span>
<span id="cb77-19"><a href="#cb77-19"></a>ax1.set_xlabel(<span class="st">"1'st Principal Component Scores"</span>)</span>
<span id="cb77-20"><a href="#cb77-20"></a>ax1.set_ylabel(<span class="st">"2'nd Principal Component Scores"</span>)</span>
<span id="cb77-21"><a href="#cb77-21"></a></span>
<span id="cb77-22"><a href="#cb77-22"></a><span class="co"># Plot reference lines</span></span>
<span id="cb77-23"><a href="#cb77-23"></a>ax1.hlines(<span class="dv">0</span>,<span class="op">-</span><span class="fl">3.5</span>,<span class="fl">3.5</span>, linestyles<span class="op">=</span><span class="st">'dotted'</span>, colors<span class="op">=</span><span class="st">'grey'</span>)</span>
<span id="cb77-24"><a href="#cb77-24"></a>ax1.vlines(<span class="dv">0</span>,<span class="op">-</span><span class="fl">3.5</span>,<span class="fl">3.5</span>, linestyles<span class="op">=</span><span class="st">'dotted'</span>, colors<span class="op">=</span><span class="st">'grey'</span>)</span>
<span id="cb77-25"><a href="#cb77-25"></a></span>
<span id="cb77-26"><a href="#cb77-26"></a><span class="co"># Second Plot : Principal Component Loadings 'PCs' </span></span>
<span id="cb77-27"><a href="#cb77-27"></a>x_min, x_max <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>          </span>
<span id="cb77-28"><a href="#cb77-28"></a>y_min, y_max <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span></span>
<span id="cb77-29"><a href="#cb77-29"></a></span>
<span id="cb77-30"><a href="#cb77-30"></a>ax2 <span class="op">=</span> ax1.twinx().twiny()</span>
<span id="cb77-31"><a href="#cb77-31"></a>ax2.set_xlim(x_min, x_max)</span>
<span id="cb77-32"><a href="#cb77-32"></a>ax2.set_ylim(y_min, y_max)</span>
<span id="cb77-33"><a href="#cb77-33"></a></span>
<span id="cb77-34"><a href="#cb77-34"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(xvector)):</span>
<span id="cb77-35"><a href="#cb77-35"></a>    ax2.arrow(<span class="dv">0</span>, <span class="dv">0</span>, xvector[i],  yvector[i], color<span class="op">=</span><span class="st">'red'</span>, width<span class="op">=</span><span class="fl">0.005</span>, head_width<span class="op">=</span><span class="fl">0.02</span>)</span>
<span id="cb77-36"><a href="#cb77-36"></a>    ax2.annotate(X.columns[i], (xvector[i]<span class="op">*</span><span class="fl">1.05</span>, yvector[i]<span class="op">*</span><span class="fl">1.05</span>), color<span class="op">=</span><span class="st">'red'</span>, size<span class="op">=</span><span class="dv">14</span>)  </span>
<span id="cb77-37"><a href="#cb77-37"></a></span>
<span id="cb77-38"><a href="#cb77-38"></a>    </span>
<span id="cb77-39"><a href="#cb77-39"></a>ax2.set_xlabel(<span class="st">"1'st Principal Component (Loading)"</span>, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb77-40"><a href="#cb77-40"></a>ax2.set_ylabel(<span class="st">"2'nd Principal Component (Loading)"</span>, color<span class="op">=</span><span class="st">'red'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="63">
<pre><code>Text(0, 0.5, "2'nd Principal Component (Loading)")</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-64-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Recall that the signs and magnitudes of a component’s loadings tell us what kind of variation it’s captured. The first component (<code>PC1</code>) shows a contrast between large, powerful vehicles with poor gas milage, and smaller, more economical vehicles with good gas milage. We might call this the “Luxury/Economy” axis. The next figure shows that our four chosen features mostly vary along the Luxury/Economy axis.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:982,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901966465,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="7fb3234d-b5ff-40a5-9c48-1c5dac6bfaad" data-execution_count="64">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1"></a><span class="co"># Look at explained variance</span></span>
<span id="cb79-2"><a href="#cb79-2"></a>plot_variance(pca)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="64">
<pre><code>array([&lt;Axes: title={'center': '% Explained Variance'}, xlabel='Component'&gt;,
       &lt;Axes: title={'center': '% Cumulative Variance'}, xlabel='Component'&gt;],
      dtype=object)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-65-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Let’s also look at the MI scores of the components. Not surprisingly, <code>PC1</code> is highly informative, though the remaining components, despite their small variance, still have a significant relationship with <code>price</code>. Examining those components could be worthwhile to find relationships not captured by the main Luxury/Economy axis.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:433,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679901991768,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="95933c2b-710a-4c5b-a59d-5935c5389343" data-execution_count="65">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1"></a>mi_scores <span class="op">=</span> make_mi_scores(X_pca, y, discrete_features<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb81-2"><a href="#cb81-2"></a>mi_scores</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="65">
<pre><code>PC1    1.013739
PC2    0.379649
PC3    0.306207
PC4    0.204905
Name: MI Scores, dtype: float64</code></pre>
</div>
</div>
<p>The third component shows a contrast between <code>horsepower</code> and <code>curb_weight</code> – sports cars vs.&nbsp;wagons, it seems.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:497,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902027264,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="a7ed75e1-7490-4266-c64d-e31b96e431b3" data-execution_count="66">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1"></a><span class="co"># Show dataframe sorted by PC3</span></span>
<span id="cb83-2"><a href="#cb83-2"></a>idx <span class="op">=</span> X_pca[<span class="st">"PC3"</span>].sort_values(ascending<span class="op">=</span><span class="va">False</span>).index</span>
<span id="cb83-3"><a href="#cb83-3"></a>cols <span class="op">=</span> [<span class="st">"make"</span>, <span class="st">"body_style"</span>, <span class="st">"horsepower"</span>, <span class="st">"curb_weight"</span>]</span>
<span id="cb83-4"><a href="#cb83-4"></a>df.loc[idx, cols]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="66">

  <div id="df-6944ffc9-ca12-45b2-81f9-386504b55070">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">make</th>
<th data-quarto-table-cell-role="th">body_style</th>
<th data-quarto-table-cell-role="th">horsepower</th>
<th data-quarto-table-cell-role="th">curb_weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">118</td>
<td>porsche</td>
<td>hardtop</td>
<td>207</td>
<td>2756</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">117</td>
<td>porsche</td>
<td>hardtop</td>
<td>207</td>
<td>2756</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">119</td>
<td>porsche</td>
<td>convertible</td>
<td>207</td>
<td>2800</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>jaguar</td>
<td>sedan</td>
<td>262</td>
<td>3950</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">96</td>
<td>nissan</td>
<td>hatchback</td>
<td>200</td>
<td>3139</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">59</td>
<td>mercedes-benz</td>
<td>wagon</td>
<td>123</td>
<td>3750</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">61</td>
<td>mercedes-benz</td>
<td>sedan</td>
<td>123</td>
<td>3770</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">101</td>
<td>peugot</td>
<td>wagon</td>
<td>95</td>
<td>3430</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">105</td>
<td>peugot</td>
<td>wagon</td>
<td>95</td>
<td>3485</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">143</td>
<td>toyota</td>
<td>wagon</td>
<td>62</td>
<td>3110</td>
</tr>
</tbody>
</table>


<p>193 rows × 4 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-6944ffc9-ca12-45b2-81f9-386504b55070')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-6944ffc9-ca12-45b2-81f9-386504b55070 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-6944ffc9-ca12-45b2-81f9-386504b55070');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<p>To express this contrast, let’s create a new ratio feature:</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1415,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902100244,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="ebfb7adb-9fee-4010-e3e1-c528294b8b8c" data-execution_count="67">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1"></a>df[<span class="st">"sports_or_wagon"</span>] <span class="op">=</span> X.curb_weight <span class="op">/</span> X.horsepower</span>
<span id="cb84-2"><a href="#cb84-2"></a>sns.regplot(x<span class="op">=</span><span class="st">"sports_or_wagon"</span>, y<span class="op">=</span><span class="st">'price'</span>, data<span class="op">=</span>df, order<span class="op">=</span><span class="dv">2</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-68-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="manifold-learning" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="manifold-learning"><span class="header-section-number">6.4</span> Manifold learning</h2>
<section id="t-sne" class="level4" data-number="6.4.0.1">
<h4 data-number="6.4.0.1" class="anchored" data-anchor-id="t-sne"><span class="header-section-number">6.4.0.1</span> t-SNE</h4>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:621,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902121031,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="68">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1"></a>digits <span class="op">=</span> load_digits()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:910,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902127297,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="59ddf6f4-9065-4d4c-b0b0-05b10aae554d" data-execution_count="69">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1"></a>X <span class="op">=</span> digits.images.reshape(<span class="op">-</span><span class="dv">1</span>, digits.images.shape[<span class="dv">1</span>]<span class="op">*</span>digits.images.shape[<span class="dv">2</span>])</span>
<span id="cb86-2"><a href="#cb86-2"></a>X.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="69">
<pre><code>(1797, 64)</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1788,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902134197,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="947bf83e-d614-49a6-9f65-bb19ccf6e499" data-execution_count="70">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1"></a>fig, ax_array <span class="op">=</span> plt.subplots(<span class="dv">5</span>, <span class="dv">5</span>)</span>
<span id="cb88-2"><a href="#cb88-2"></a>axes <span class="op">=</span> ax_array.flatten()</span>
<span id="cb88-3"><a href="#cb88-3"></a><span class="cf">for</span> i, ax <span class="kw">in</span> <span class="bu">enumerate</span>(axes):</span>
<span id="cb88-4"><a href="#cb88-4"></a>    ax.imshow(digits.images[i], cmap<span class="op">=</span><span class="st">'gray_r'</span>)</span>
<span id="cb88-5"><a href="#cb88-5"></a>plt.setp(axes, xticks<span class="op">=</span>[], yticks<span class="op">=</span>[], frame_on<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb88-6"><a href="#cb88-6"></a>plt.tight_layout(h_pad<span class="op">=</span><span class="fl">0.5</span>, w_pad<span class="op">=</span><span class="fl">0.01</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-71-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:589,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902137918,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="71">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1"></a>otsne <span class="op">=</span> oTSNE(</span>
<span id="cb89-2"><a href="#cb89-2"></a>    n_components<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb89-3"><a href="#cb89-3"></a>    perplexity<span class="op">=</span><span class="dv">30</span>,</span>
<span id="cb89-4"><a href="#cb89-4"></a>    initialization<span class="op">=</span><span class="st">'pca'</span>, </span>
<span id="cb89-5"><a href="#cb89-5"></a>    n_jobs<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb89-6"><a href="#cb89-6"></a>    random_state<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb89-7"><a href="#cb89-7"></a>    negative_gradient_method<span class="op">=</span><span class="st">'auto'</span>, </span>
<span id="cb89-8"><a href="#cb89-8"></a>    verbose<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb89-9"><a href="#cb89-9"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:10943,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902151168,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="4417dc8d-620d-4d92-8d07-507e7161849e" data-execution_count="72">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1"></a>embedding <span class="op">=</span> otsne.fit(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>--------------------------------------------------------------------------------
TSNE(early_exaggeration=12, n_jobs=2, random_state=0, verbose=True)
--------------------------------------------------------------------------------
===&gt; Finding 90 nearest neighbors using Annoy approximate search using euclidean distance...
   --&gt; Time elapsed: 0.79 seconds
===&gt; Calculating affinity matrix...
   --&gt; Time elapsed: 0.08 seconds
===&gt; Calculating PCA-based initialization...
   --&gt; Time elapsed: 0.01 seconds
===&gt; Running optimization with exaggeration=12.00, lr=149.75 for 250 iterations...
Iteration   50, KL divergence 2.6162, 50 iterations in 0.5615 sec
Iteration  100, KL divergence 2.6249, 50 iterations in 0.4249 sec
Iteration  150, KL divergence 2.6110, 50 iterations in 0.5087 sec
Iteration  200, KL divergence 2.6054, 50 iterations in 0.4346 sec
Iteration  250, KL divergence 2.6028, 50 iterations in 0.4644 sec
   --&gt; Time elapsed: 2.40 seconds
===&gt; Running optimization with exaggeration=1.00, lr=1797.00 for 500 iterations...
Iteration   50, KL divergence 0.9203, 50 iterations in 0.4606 sec
Iteration  100, KL divergence 0.8272, 50 iterations in 0.4424 sec
Iteration  150, KL divergence 0.7951, 50 iterations in 0.4422 sec
Iteration  200, KL divergence 0.7783, 50 iterations in 0.4284 sec
Iteration  250, KL divergence 0.7685, 50 iterations in 0.4518 sec
Iteration  300, KL divergence 0.7625, 50 iterations in 1.4672 sec
Iteration  350, KL divergence 0.7580, 50 iterations in 1.2427 sec
Iteration  400, KL divergence 0.7539, 50 iterations in 0.4364 sec
Iteration  450, KL divergence 0.7514, 50 iterations in 0.4209 sec
Iteration  500, KL divergence 0.7492, 50 iterations in 1.7576 sec
   --&gt; Time elapsed: 7.56 seconds</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1167,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902152332,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="f8626b8b-f430-4648-bb57-c80f981c1232" data-execution_count="73">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb92-2"><a href="#cb92-2"></a>plt.scatter(embedding[:, <span class="dv">0</span>], embedding[:, <span class="dv">1</span>], c<span class="op">=</span>digits.target, cmap<span class="op">=</span><span class="st">'Spectral'</span>, s<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb92-3"><a href="#cb92-3"></a>plt.gca().set_aspect(<span class="st">'equal'</span>, <span class="st">'datalim'</span>)</span>
<span id="cb92-4"><a href="#cb92-4"></a>plt.colorbar(boundaries<span class="op">=</span>np.arange(<span class="dv">11</span>)<span class="op">-</span><span class="fl">0.5</span>).set_ticks(np.arange(<span class="dv">10</span>))</span>
<span id="cb92-5"><a href="#cb92-5"></a>plt.title(<span class="st">'tSNE of the Digits dataset'</span>, fontsize<span class="op">=</span><span class="dv">24</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="73">
<pre><code>Text(0.5, 1.0, 'tSNE of the Digits dataset')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-74-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="umap" class="level4" data-number="6.4.0.2">
<h4 data-number="6.4.0.2" class="anchored" data-anchor-id="umap"><span class="header-section-number">6.4.0.2</span> UMAP</h4>
<p>UMAP is useful for generating visualisations, but if you want to make use of UMAP more generally for machine learning tasks it is important to be be able to train a model and then later pass new data to the model and have it transform that data into the learned space. For example if we use UMAP to learn a latent space and then train a classifier on data transformed into the latent space then the classifier is only useful for prediction if we can transform data for which we want a prediction into the latent space the classifier uses.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:301,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902166193,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="74">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(digits.data, digits.target, stratify<span class="op">=</span>digits.target, random_state<span class="op">=</span><span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now to get a benchmark idea of what we are looking at let’s train a couple of different classifiers and then see how well they score on the test set. For this example let’s try a support vector classifier and a KNN classifier.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1217,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902189469,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="536d3895-801a-4016-b858-1a95eff7dd10" data-execution_count="75">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1"></a>svc <span class="op">=</span> SVC(gamma<span class="op">=</span><span class="st">'auto'</span>).fit(X_train, y_train)</span>
<span id="cb95-2"><a href="#cb95-2"></a>knn <span class="op">=</span> KNeighborsClassifier().fit(X_train, y_train)</span>
<span id="cb95-3"><a href="#cb95-3"></a>svc.score(X_test, y_test), knn.score(X_test, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="75">
<pre><code>(0.62, 0.9844444444444445)</code></pre>
</div>
</div>
<p>The goal now is to make use of UMAP as a preprocessing step that one could potentially fit into a pipeline.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:10617,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902215352,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="76">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1"></a>trans <span class="op">=</span> umap.UMAP(n_neighbors<span class="op">=</span><span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">42</span>).fit(X_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1321,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902216665,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="ea2e0853-ded7-4512-baf2-dfcf530830de" data-execution_count="77">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb98-2"><a href="#cb98-2"></a>plt.scatter(trans.embedding_[:, <span class="dv">0</span>], trans.embedding_[:, <span class="dv">1</span>], c<span class="op">=</span>y_train, cmap<span class="op">=</span><span class="st">'Spectral'</span>, s<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb98-3"><a href="#cb98-3"></a>plt.gca().set_aspect(<span class="st">'equal'</span>, <span class="st">'datalim'</span>)</span>
<span id="cb98-4"><a href="#cb98-4"></a>plt.colorbar(boundaries<span class="op">=</span>np.arange(<span class="dv">11</span>)<span class="op">-</span><span class="fl">0.5</span>).set_ticks(np.arange(<span class="dv">10</span>))</span>
<span id="cb98-5"><a href="#cb98-5"></a>plt.title(<span class="st">'Umap of the Digits dataset'</span>, fontsize<span class="op">=</span><span class="dv">24</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="77">
<pre><code>Text(0.5, 1.0, 'Umap of the Digits dataset')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-78-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>This looks very promising! Most of the classes got very cleanly separated, and that gives us some hope that it could help with classifier performance. We can now train some new models (again an SVC and a KNN classifier) on the embedded training data. This looks exactly as before but now we pass it the embedded data.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902229844,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="78">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1"></a>svc <span class="op">=</span> SVC(gamma<span class="op">=</span><span class="st">'auto'</span>).fit(trans.embedding_, y_train)</span>
<span id="cb100-2"><a href="#cb100-2"></a>knn <span class="op">=</span> KNeighborsClassifier().fit(trans.embedding_, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:9210,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902239335,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="79">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1"></a>test_embedding <span class="op">=</span> trans.transform(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The next important question is what the transform did to our test data. In principle we have a new two dimensional representation of the test-set, and ideally this should be based on the existing embedding of the training set</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:643,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902239968,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="f6bbc084-fe44-4f79-e848-0a6cf897bb6c" data-execution_count="80">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb102-2"><a href="#cb102-2"></a>plt.scatter(test_embedding[:, <span class="dv">0</span>], test_embedding[:, <span class="dv">1</span>], c<span class="op">=</span>y_test, cmap<span class="op">=</span><span class="st">'Spectral'</span>, s<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb102-3"><a href="#cb102-3"></a>plt.gca().set_aspect(<span class="st">'equal'</span>, <span class="st">'datalim'</span>)</span>
<span id="cb102-4"><a href="#cb102-4"></a>plt.colorbar(boundaries<span class="op">=</span>np.arange(<span class="dv">11</span>)<span class="op">-</span><span class="fl">0.5</span>).set_ticks(np.arange(<span class="dv">10</span>))</span>
<span id="cb102-5"><a href="#cb102-5"></a>plt.title(<span class="st">'Umap of the Digits dataset'</span>, fontsize<span class="op">=</span><span class="dv">24</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="80">
<pre><code>Text(0.5, 1.0, 'Umap of the Digits dataset')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-81-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>The results look like what we should expect; the test data has been embedded into two dimensions in exactly the locations we should expect (by class) given the embedding of the training data visualised above. This means we can now try out models that were trained on the embedded training data by handing them the newly transformed test set.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:4829,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902274169,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="77e69d32-95d8-40dc-b383-a437b491b19e" data-execution_count="81">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1"></a>trans.transform(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="81">
<pre><code>array([[ 4.73177004e+00,  2.46851373e+00],
       [ 1.91173019e+01,  3.47619963e+00],
       [ 7.86290264e+00,  1.09972172e+01],
       [-8.19267273e+00,  3.35794115e+00],
       [ 7.09956217e+00,  1.42389803e+01],
       [ 1.32900066e+01,  1.82322578e+01],
       [ 2.65943050e-01, -8.95168245e-01],
       [ 8.13252068e+00,  1.00992136e+01],
       [ 5.73924875e+00,  2.07148552e+00],
       [ 5.40985489e+00,  1.51770325e+01],
       [ 6.47868681e+00,  1.46163197e+01],
       [ 7.92969179e+00,  9.91152573e+00],
       [ 1.17540598e+01, -5.85403776e+00],
       [ 1.21744642e+01, -6.17784595e+00],
       [ 6.87150419e-01, -2.17636895e+00],
       [ 1.28335676e+01,  1.65336361e+01],
       [ 6.92930698e+00,  1.49666691e+01],
       [ 1.00950708e+01,  6.95953965e-01],
       [ 3.05954218e+00,  4.18441391e+00],
       [ 1.22419624e+01,  1.81537476e+01],
       [ 8.41183376e+00,  1.01441069e+01],
       [ 9.57836246e+00,  2.75005311e-01],
       [ 1.93220310e+01,  2.32694030e+00],
       [ 1.28659058e+01,  1.85482330e+01],
       [ 1.96019783e+01,  2.01119971e+00],
       [ 4.99640083e+00,  1.86033607e+00],
       [ 1.13867264e+01, -6.41329575e+00],
       [ 2.00881138e+01,  3.05871224e+00],
       [ 3.00027013e+00, -8.01352322e-01],
       [ 2.92265922e-01, -2.01319861e+00],
       [ 1.41106904e+00,  9.47769833e+00],
       [ 2.43231082e+00,  1.04742994e+01],
       [ 4.24076748e+00,  3.97745585e+00],
       [-6.14816606e-01, -1.45310473e+00],
       [ 1.03815241e+01,  1.65336680e+00],
       [ 1.33825254e+01,  1.69268723e+01],
       [ 7.61123228e+00,  1.40565615e+01],
       [ 5.55537558e+00,  2.05418849e+00],
       [ 6.94975233e+00,  1.43994637e+01],
       [ 8.03399944e+00,  1.41689272e+01],
       [ 1.11499023e+01,  1.69359303e+00],
       [ 1.93824215e+01,  1.83013022e+00],
       [ 4.15738869e+00,  5.18572140e+00],
       [ 3.60030508e+00,  5.01691294e+00],
       [ 8.05832386e+00,  1.41819515e+01],
       [ 3.83167720e+00,  4.41925764e+00],
       [ 1.04558792e+01,  1.46102712e-01],
       [ 1.96752357e+00,  9.15024090e+00],
       [ 1.96036167e+01,  2.88023281e+00],
       [ 4.75290745e-01, -3.02901536e-01],
       [ 1.28543739e+01, -6.69067383e+00],
       [ 7.68392706e+00,  1.35354586e+01],
       [ 5.70900965e+00,  2.04589939e+00],
       [ 1.27460394e+01, -7.56970310e+00],
       [-8.09807491e+00,  3.45251179e+00],
       [-8.20304966e+00,  3.34776187e+00],
       [ 1.01384201e+01,  6.57227516e-01],
       [ 1.05179510e+01,  1.68638420e+00],
       [ 7.96865273e+00,  1.05273275e+01],
       [ 4.90999174e+00,  1.58829975e+01],
       [ 8.63133049e+00, -4.62174177e+00],
       [ 7.42704582e+00,  1.51531487e+01],
       [ 1.93333473e+01,  1.75126565e+00],
       [ 7.81681252e+00,  1.01148701e+01],
       [ 1.88073101e+01,  2.74154377e+00],
       [ 1.29166088e+01, -6.52322578e+00],
       [ 9.41298866e+00,  1.08080494e+00],
       [ 6.16237783e+00, -9.58264709e-01],
       [ 7.35584676e-01, -1.40368450e+00],
       [ 7.49761915e+00,  9.53435230e+00],
       [ 1.26329851e+01,  1.74112072e+01],
       [ 6.09630585e+00, -2.83607483e-01],
       [ 4.56159449e+00,  4.63957405e+00],
       [ 5.21145630e+00,  1.55418911e+01],
       [ 8.52060318e+00, -5.29649198e-01],
       [ 1.76717103e+00,  9.06908798e+00],
       [ 1.12594156e+01,  1.60219014e+00],
       [ 1.06761303e+01,  5.61923206e-01],
       [ 1.52136588e+00,  9.05504322e+00],
       [ 1.22102089e+01,  1.73202934e+01],
       [ 6.19346762e+00, -2.01016366e-01],
       [ 1.95389805e+01,  2.73830152e+00],
       [ 6.07237339e+00, -7.12067902e-01],
       [ 1.18179951e+01, -7.24027014e+00],
       [ 2.35402918e+00,  9.97527313e+00],
       [ 8.05538595e-01, -1.55245471e+00],
       [-5.48529863e-01, -1.44640124e+00],
       [ 8.46719360e+00, -4.49677277e+00],
       [ 2.63080096e+00, -4.21153259e+00],
       [ 1.34470768e+01,  1.80865421e+01],
       [ 7.93155432e+00,  1.32082472e+01],
       [ 2.90374517e+00,  5.25399637e+00],
       [ 1.21058340e+01, -5.75693417e+00],
       [ 1.18059082e+01,  1.69832764e+01],
       [-2.30677761e-02, -2.63910270e+00],
       [ 7.50664759e+00,  1.45911045e+01],
       [ 2.61786890e+00, -4.19906235e+00],
       [ 6.76057696e-01, -2.03193378e+00],
       [ 1.87298660e+01,  2.62258267e+00],
       [ 7.26300764e+00,  1.50124683e+01],
       [ 1.90552788e+01,  3.07881856e+00],
       [ 6.09509850e+00, -7.56763577e-01],
       [ 6.17576075e+00, -7.26652086e-01],
       [ 7.98868608e+00,  9.83880329e+00],
       [ 1.21262283e+01, -7.42956352e+00],
       [ 9.36670208e+00,  9.97476220e-01],
       [ 1.25175686e+01,  1.71377945e+01],
       [ 6.26237488e+00,  1.43485527e+01],
       [ 5.53839064e+00,  1.20771849e+00],
       [ 1.95191860e+01,  3.09513426e+00],
       [ 1.93319950e+01,  2.04565048e+00],
       [ 7.90213203e+00,  1.01868477e+01],
       [ 4.40916538e+00,  4.91170883e+00],
       [ 1.59102690e+00,  5.91555834e+00],
       [ 1.06758175e+01,  7.85464406e-01],
       [ 8.50780201e+00, -4.53833485e+00],
       [ 3.33708262e+00,  4.26565790e+00],
       [ 1.03685141e+01,  1.33268273e+00],
       [ 5.50983715e+00,  1.92333841e+00],
       [ 9.89408302e+00,  7.60242999e-01],
       [ 1.92521572e+01,  3.28466463e+00],
       [ 1.93915577e+01,  1.80793393e+00],
       [-9.59185779e-01, -1.43418705e+00],
       [ 5.38180447e+00,  1.55832243e+01],
       [-2.10883573e-01, -1.04512537e+00],
       [ 6.69982815e+00, -7.31428787e-02],
       [ 2.64970207e+00,  1.04629345e+01],
       [ 2.70043421e+00, -4.25971699e+00],
       [ 1.29440527e+01, -6.61230564e+00],
       [ 9.27611649e-01, -9.55748022e-01],
       [ 1.18965158e+01, -6.58824778e+00],
       [ 1.23818903e+01,  1.64546566e+01],
       [ 2.48696733e+00, -4.27661419e+00],
       [ 9.49136913e-01, -8.76113117e-01],
       [ 1.91355953e+01,  2.56769919e+00],
       [ 2.03352299e+01,  3.30455041e+00],
       [ 5.40721941e+00,  1.76240933e+00],
       [ 1.20430918e+01,  1.79942932e+01],
       [ 1.66636074e+00,  8.91286182e+00],
       [ 6.12154388e+00,  1.49706059e+01],
       [ 5.76479673e+00,  2.05096912e+00],
       [ 1.26848288e+01,  1.63744678e+01],
       [ 1.91420193e+01,  3.13646555e+00],
       [ 7.81396389e+00,  1.00339603e+01],
       [ 1.26516829e+01,  1.84274235e+01],
       [ 3.53068799e-01, -9.54452991e-01],
       [ 1.02022676e+01,  1.75975370e+00],
       [ 4.81706905e+00,  2.32386041e+00],
       [ 1.26537113e+01,  1.69497089e+01],
       [ 1.23623486e+01,  1.78191795e+01],
       [ 8.54515076e-01, -1.01536226e+00],
       [ 7.05518866e+00,  1.40135460e+01],
       [ 2.21469665e+00,  5.26067495e+00],
       [ 2.56542659e+00,  5.00661182e+00],
       [ 1.80082548e+00,  9.62335300e+00],
       [ 1.07883806e+01,  1.61723030e+00],
       [ 9.88454342e+00, -2.33417273e-01],
       [ 8.17566204e+00,  9.67235184e+00],
       [ 1.88418846e+01,  2.49431753e+00],
       [ 1.28272562e+01, -6.51219225e+00],
       [ 8.06352520e+00,  1.05998135e+01],
       [ 1.97371750e+01,  3.02595925e+00],
       [ 8.25599575e+00,  1.07834330e+01],
       [ 1.17708435e+01,  1.67840595e+01],
       [ 1.96602249e+01,  2.35182858e+00],
       [-4.44723725e-01, -1.08014917e+00],
       [ 1.22830667e+01,  1.63258533e+01],
       [ 1.00864286e+01,  1.41382837e+00],
       [ 9.63279915e+00,  1.22358000e+00],
       [ 1.17074785e+01,  1.73078613e+01],
       [ 4.91881818e-01, -1.86782694e+00],
       [ 9.27524626e-01, -3.64588648e-01],
       [ 1.03519487e+01,  1.71525097e+00],
       [ 1.21878176e+01,  1.66502571e+01],
       [ 2.54178166e+00, -4.13714075e+00],
       [-7.94874549e-01, -1.32138753e+00],
       [ 8.94740105e+00, -7.02543706e-02],
       [ 1.60824668e+00,  9.57526588e+00],
       [ 7.69076777e+00,  1.38979092e+01],
       [ 1.19308853e+01, -5.87281370e+00],
       [ 1.96669064e+01,  2.94271183e+00],
       [ 4.00215197e+00,  5.47322416e+00],
       [ 1.04111280e+01,  6.09881997e-01],
       [ 7.43757534e+00,  1.38516932e+01],
       [ 4.26444292e+00,  4.87076139e+00],
       [ 2.90101218e+00,  8.00403118e+00],
       [ 7.60269547e+00,  1.41803226e+01],
       [ 1.09815300e+00, -4.20335007e+00],
       [ 3.72613168e+00,  5.09122086e+00],
       [ 2.86066222e+00,  1.06173820e+01],
       [ 2.42815518e+00, -4.00461817e+00],
       [ 2.61127090e+00,  5.14484406e+00],
       [ 1.18339100e+01,  1.67339821e+01],
       [ 1.22553959e+01, -6.08764076e+00],
       [ 4.20773602e+00,  4.65283203e+00],
       [ 8.62094879e+00, -4.78529274e-01],
       [ 1.29443531e+01, -6.50885916e+00],
       [ 5.15094805e+00,  3.08955741e+00],
       [ 1.90184188e+00, -4.20560122e+00],
       [ 7.78751183e+00,  1.03105097e+01],
       [ 4.66492891e+00,  4.62675238e+00],
       [ 7.20657921e+00,  1.00898695e+01],
       [ 1.23361588e+01, -7.76199770e+00],
       [ 7.19676876e+00,  1.45420494e+01],
       [-8.28833485e+00,  3.26244545e+00],
       [ 1.93086472e+01,  2.02614713e+00],
       [ 8.56536388e+00,  1.08816519e+01],
       [ 1.56364882e+00,  9.02052307e+00],
       [ 1.93720913e+01,  3.13724089e+00],
       [ 1.03784208e+01,  1.45391178e+00],
       [ 1.01358051e+01, -4.34333980e-01],
       [ 7.30056190e+00,  1.39617376e+01],
       [ 7.31627369e+00,  1.48641815e+01],
       [ 2.33456850e+00,  8.97941303e+00],
       [ 2.09031320e+00,  9.15919304e+00],
       [ 1.35915003e+01,  1.69954529e+01],
       [ 2.61211252e+00,  9.67325783e+00],
       [ 5.70830059e+00,  2.07967734e+00],
       [ 2.03164749e+01,  2.60851431e+00],
       [ 1.23774891e+01,  1.72216015e+01],
       [ 9.85767186e-01, -8.03058326e-01],
       [ 6.18093252e+00, -2.71137953e-01],
       [ 1.33752537e+01,  1.74806652e+01],
       [ 7.87491941e+00,  1.15665522e+01],
       [ 1.19647760e+01,  1.65779037e+01],
       [ 1.58233976e+00,  8.97871685e+00],
       [ 1.11217403e+01, -7.53401709e+00],
       [ 2.77137256e+00,  1.07307339e+01],
       [ 1.98257885e+01,  3.34123826e+00],
       [ 9.88493085e-01, -6.36084318e-01],
       [-5.42631149e-01, -1.49713326e+00],
       [ 6.00486565e+00, -1.04312032e-01],
       [ 5.50934029e+00,  1.54812260e+01],
       [ 6.79059935e+00,  1.43414955e+01],
       [ 8.20319176e+00,  1.14464417e+01],
       [ 1.51997113e+00,  9.93821526e+00],
       [ 9.26871109e+00,  8.75526607e-01],
       [ 1.15349522e+01, -7.81715679e+00],
       [ 2.84447312e+00,  4.09177399e+00],
       [ 3.01040769e+00,  1.07021465e+01],
       [ 5.26517034e-01,  3.56633514e-01],
       [ 2.23956490e+00,  1.05628624e+01],
       [ 7.40757895e+00,  1.05235777e+01],
       [ 7.57580614e+00,  1.39888668e+01],
       [ 1.19394760e+01, -5.87033081e+00],
       [ 1.19141283e+01, -7.70306826e+00],
       [ 1.45862615e+00,  9.67681885e+00],
       [ 5.70191717e+00,  1.50980463e+01],
       [ 1.27075195e+01,  1.71650524e+01],
       [ 1.90146370e+01,  2.91956520e+00],
       [ 1.00382977e+01,  1.05415595e+00],
       [ 1.20603743e+01, -6.73856401e+00],
       [ 1.21463318e+01, -5.93729019e+00],
       [ 2.98728800e+00,  5.01034117e+00],
       [ 4.37886333e+00,  5.13170195e+00],
       [ 5.71549463e+00,  9.21205699e-01],
       [ 1.97396123e+00,  8.89696503e+00],
       [ 1.93121815e+01,  3.62117839e+00],
       [ 1.83073807e+00, -4.12922049e+00],
       [ 1.35204191e+01,  1.69217930e+01],
       [ 3.89947939e+00,  4.44158363e+00],
       [ 2.01038971e+01,  3.17173958e+00],
       [ 1.76283216e+00,  8.74818230e+00],
       [ 1.39133549e+00,  9.86009979e+00],
       [ 4.96045542e+00,  2.09638572e+00],
       [ 5.37798691e+00,  2.55944920e+00],
       [ 1.00153885e+01, -4.30421829e-01],
       [ 2.58003759e+00,  5.65518475e+00],
       [ 3.10385394e+00,  4.31488323e+00],
       [ 8.06058502e+00,  1.08455706e+01],
       [ 5.15572214e+00,  2.80767560e+00],
       [ 7.04855144e-01, -2.10322872e-01],
       [ 1.32493429e+01,  1.70429554e+01],
       [ 1.25905075e+01, -6.49386692e+00],
       [-8.13499737e+00,  3.41613173e+00],
       [ 1.97236271e+01,  3.78322840e+00],
       [ 8.44617176e+00, -4.47045088e+00],
       [ 2.22543931e+00,  8.94437122e+00],
       [ 7.39531803e+00,  9.88773346e+00],
       [ 4.95809615e-01, -1.17228663e+00],
       [ 3.56299803e-02, -2.51918101e+00],
       [ 9.97978687e-01, -9.73300874e-01],
       [ 7.88709497e+00,  1.02189322e+01],
       [ 1.19830122e+01, -6.20376873e+00],
       [ 7.27090883e+00,  1.48665085e+01],
       [ 7.90857124e+00,  1.04754467e+01],
       [ 7.78450203e+00,  1.34945431e+01],
       [ 9.20992315e-01, -3.84849370e-01],
       [ 2.06664467e+00,  8.91980267e+00],
       [ 6.82216120e+00,  1.47176342e+01],
       [ 7.96708155e+00,  9.88164520e+00],
       [ 9.99245048e-01, -1.10285509e+00],
       [ 4.92387438e+00,  3.11497521e+00],
       [ 4.15050173e+00,  5.49935293e+00],
       [ 1.85929432e+01,  2.93218923e+00],
       [ 1.05673771e+01,  1.58918750e+00],
       [ 1.17832613e+01, -6.88497448e+00],
       [ 2.05436015e+00,  8.92279243e+00],
       [-8.32482147e+00,  3.22605968e+00],
       [-6.68644428e-01, -1.44689846e+00],
       [ 1.26672497e+01, -6.95247126e+00],
       [ 4.02511883e+00,  4.68911886e+00],
       [ 1.83233964e+00,  1.02191486e+01],
       [ 1.24769630e+01,  1.83115978e+01],
       [ 6.54460144e+00,  8.17592907e+00],
       [ 4.99710226e+00,  2.14675093e+00],
       [ 8.82683563e+00, -3.46012086e-01],
       [ 5.66530418e+00,  2.03878736e+00],
       [ 1.12690344e+01,  1.65654433e+00],
       [ 1.94616604e+01,  1.83572781e+00],
       [ 4.22863197e+00,  4.24069071e+00],
       [ 1.32883120e+01,  1.72658978e+01],
       [ 2.04569340e+00,  9.79823208e+00],
       [ 1.16519632e+01, -5.80133963e+00],
       [ 2.73238510e-01, -1.97288191e+00],
       [ 1.37230902e+01,  1.69941349e+01],
       [ 2.34973192e+00,  9.78479385e+00],
       [-8.32408810e+00,  3.22686195e+00],
       [ 5.00070572e+00,  2.14611840e+00],
       [ 1.94834633e+01,  3.31213975e+00],
       [ 5.13502932e+00,  2.53799510e+00],
       [ 3.51085663e+00,  4.86806011e+00],
       [ 1.60497224e+00,  1.02030182e+01],
       [ 1.77237749e+00,  9.68281555e+00],
       [ 1.01137390e+01,  6.01305068e-01],
       [ 1.24101944e+01,  1.69083271e+01],
       [ 9.99769878e+00, -4.69175726e-01],
       [ 1.92375374e+01,  2.82835078e+00],
       [ 1.29148035e+01, -6.90968513e+00],
       [ 4.79194498e+00,  1.79446292e+00],
       [ 1.09801130e+01, -7.14352322e+00],
       [ 4.43158436e+00,  4.53871965e+00],
       [ 1.19143171e+01, -5.24801064e+00],
       [ 8.03468132e+00,  1.08030205e+01],
       [ 1.25794535e+01,  1.83805733e+01],
       [ 1.23168669e+01,  1.66269989e+01],
       [ 1.23458223e+01,  1.77778034e+01],
       [ 9.14830303e+00,  2.24295601e-01],
       [ 2.66571760e+00, -4.23472404e+00],
       [ 5.79700947e+00,  2.10118103e+00],
       [ 4.93734884e+00,  2.10275912e+00],
       [ 8.59681225e+00, -6.13303065e-01],
       [ 4.52130413e+00,  4.89938354e+00],
       [ 1.25310907e+01,  1.77465248e+01],
       [ 4.70883727e-01, -2.58479118e-01],
       [ 7.51077795e+00,  1.44778681e+01],
       [ 3.78150916e+00,  4.56379843e+00],
       [ 5.95912027e+00,  3.97240400e-01],
       [ 3.72255659e+00,  5.11259413e+00],
       [ 1.19461737e+01,  1.67762375e+01],
       [ 9.08414245e-01, -7.92203903e-01],
       [ 2.96357393e+00,  1.00844154e+01],
       [ 1.17556305e+01, -6.66913843e+00],
       [ 2.02050533e+01,  3.61629868e+00],
       [ 1.10305328e+01, -7.52728462e+00],
       [ 1.96918893e+00,  9.84622478e+00],
       [ 4.19275188e+00,  5.32430649e+00],
       [ 7.87172747e+00,  1.34470758e+01],
       [ 1.98914948e+01,  2.00160146e+00],
       [ 8.35500717e+00,  9.87718010e+00],
       [ 9.96109867e+00,  8.08443546e-01],
       [ 1.18106031e+01, -5.74526215e+00],
       [ 5.16102409e+00,  1.80734324e+00],
       [ 1.06605225e+01,  5.83091080e-01],
       [ 5.54406452e+00,  1.55050116e+01],
       [-8.23605418e-01, -1.30636895e+00],
       [ 1.74808240e+00, -4.07517624e+00],
       [ 9.26349831e+00,  8.88854027e-01],
       [ 1.09849749e+01, -7.48004770e+00],
       [ 1.20971031e+01,  1.70955334e+01],
       [ 7.80687809e+00,  1.46189804e+01],
       [ 7.74820900e+00,  1.09906073e+01],
       [ 2.86658764e+00,  8.10734367e+00],
       [ 5.48915911e+00,  1.53481274e+01],
       [ 3.66877079e+00,  4.72051382e+00],
       [ 9.71720600e+00,  1.88182616e+00],
       [ 1.29751072e+01, -6.48790073e+00],
       [ 4.74673939e+00,  2.45048618e+00],
       [ 6.65666580e+00,  1.45971031e+01],
       [ 8.40965176e+00,  1.14738111e+01],
       [-8.10725212e+00,  3.44368553e+00],
       [ 7.50969601e+00,  1.05435114e+01],
       [ 2.85458922e+00,  1.05950384e+01],
       [ 9.97610331e-01, -4.11940002e+00],
       [ 1.61350918e+00,  9.61839390e+00],
       [ 7.60637164e-01, -2.08404779e+00],
       [ 1.08878446e+00, -4.20332289e+00],
       [ 1.71200943e+00,  1.01663733e+01],
       [ 1.68586135e+00,  9.51459694e+00],
       [ 9.96205997e+00, -4.65066135e-01],
       [ 2.30960464e+00,  9.90717316e+00],
       [ 7.35355377e-01, -1.99536717e+00],
       [ 6.53025198e+00,  8.15707302e+00],
       [ 2.84418404e-01, -4.09361899e-01],
       [ 1.47742963e+00,  8.79598904e+00],
       [ 1.94371700e+01,  2.68893600e+00],
       [ 6.51380682e+00,  1.46814518e+01],
       [ 1.20655746e+01, -6.61174297e+00],
       [ 2.61204028e+00, -4.18903923e+00],
       [ 1.27581778e+01,  1.74870110e+01],
       [ 7.28155994e+00,  1.42150888e+01],
       [ 7.64708996e+00,  1.37616825e+01],
       [ 1.20456152e+01, -5.99717808e+00],
       [ 5.90163994e+00, -5.59923708e-01],
       [ 9.67985809e-01, -1.10858858e+00],
       [ 1.89800892e+01,  3.22926378e+00],
       [ 1.28227119e+01, -6.45035076e+00],
       [ 2.41951394e+00,  1.07949047e+01],
       [ 1.95769138e+01,  3.33323169e+00],
       [ 1.95406742e+01,  3.64278507e+00],
       [ 4.94027615e+00,  3.08518648e+00],
       [ 1.16152763e+01, -7.42098475e+00],
       [ 1.89538881e-01, -2.01126289e+00],
       [ 3.81815052e+00,  4.59767532e+00],
       [ 2.12944388e+00,  1.01413727e+01],
       [ 5.31503677e+00,  1.56595840e+01],
       [ 7.29801846e+00,  1.01420183e+01],
       [ 2.09905934e+00,  5.28698969e+00],
       [ 2.07446499e+01,  3.95429325e+00],
       [ 8.20926762e+00,  1.09102173e+01],
       [ 1.08266563e+01,  7.70246744e-01],
       [ 6.07540846e+00, -7.29724586e-01],
       [ 1.33210297e+01,  1.75505371e+01],
       [ 1.24755239e+01,  1.77963142e+01],
       [ 8.17131042e+00,  9.57447624e+00],
       [ 1.85363064e+01,  2.59018946e+00],
       [ 1.92491379e+01,  1.91278136e+00],
       [ 1.18102551e+01,  1.75860405e+01],
       [ 1.96883640e+01,  2.18472767e+00],
       [ 9.52509582e-01, -1.43717289e+00],
       [ 6.90265989e+00,  1.45218258e+01],
       [ 5.67792988e+00,  1.57095594e+01],
       [ 4.19719028e+00,  4.65386629e+00],
       [ 1.18064594e+01,  1.68005753e+01],
       [ 4.59421349e+00,  4.83855247e+00],
       [ 1.28239794e+01, -6.72075176e+00],
       [-1.79536175e-02, -1.28720593e+00],
       [ 1.02263308e+01,  8.62763345e-01],
       [ 7.40937901e+00,  1.00602980e+01],
       [ 6.83069372e+00,  1.49400043e+01],
       [-1.60397947e-01, -1.87085092e+00],
       [ 1.31290855e+01,  1.73606892e+01],
       [-8.06395912e+00,  3.48659539e+00],
       [ 3.60813916e-01, -2.49946070e+00],
       [ 3.95752883e+00,  5.46306419e+00],
       [ 3.21658778e+00,  5.64122772e+00],
       [ 1.89867115e+01,  2.76880908e+00],
       [ 1.43908429e+00,  9.82541084e+00],
       [ 8.73421192e+00, -4.49178368e-01],
       [ 4.20121336e+00,  4.74164057e+00]], dtype=float32)</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:6208,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902285804,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="00bc449b-cc75-46b7-9660-032c64ce3267" data-execution_count="82">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1"></a>svc.score(trans.transform(X_test), y_test), knn.score(trans.transform(X_test), y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="82">
<pre><code>(0.98, 0.98)</code></pre>
</div>
</div>
<p>The results are pretty good. While the accuracy of the KNN classifier did not improve there was not a lot of scope for improvement given the data. On the other hand the SVC has improved to have equal accuracy to the KNN classifier!</p>
<p>For more interesting datasets the larger dimensional embedding might have been a significant gain – it is certainly worth exploring as one of the parameters in a grid search across a pipeline that includes UMAP.</p>
</section>
</section>
<section id="clustering" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="clustering"><span class="header-section-number">6.5</span> Clustering</h2>
<p>When used for feature engineering, we could attempt to discover groups of customers representing a market segment, for instance, or geographic areas that share similar weather patterns. Adding a feature of cluster labels can help machine learning models untangle complicated relationships of space or proximity.</p>
<section id="cluster-labels-as-a-feature" class="level3" data-number="6.5.1">
<h3 data-number="6.5.1" class="anchored" data-anchor-id="cluster-labels-as-a-feature"><span class="header-section-number">6.5.1</span> Cluster Labels as a feature</h3>
<p>Applied to a single real-valued feature, clustering acts like a traditional “binning” or “discretization” transform. On multiple features, it’s like “multi-dimensional binning” (sometimes called <em>vector quantization</em>).</p>
<p>It’s important to remember that this Cluster feature is categorical. Here, it’s shown with a label encoding (that is, as a sequence of integers) as a typical clustering algorithm would produce; depending on your model, a one-hot encoding may be more appropriate. The motivating idea <strong>for adding cluster labels is that the clusters will break up complicated relationships across features into simpler chunks</strong>. Our model can then just learn the simpler chunks one-by-one instead having to learn the complicated whole all at once. It’s a “divide and conquer” strategy.</p>
<p>As spatial features, <a href="https://www.kaggle.com/camnugent/california-housing-prices"><em>California Housing</em></a>’s <code>'Latitude'</code> and <code>'Longitude'</code> make natural candidates for k-means clustering. In this example we’ll cluster these with <code>'MedInc'</code> (median income) to create economic segments in different regions of California. Since k-means clustering is sensitive to scale, it can be a good idea rescale or normalize data with extreme values. Our features are already roughly on the same scale, so we’ll leave them as-is.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:266,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902314854,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="83">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1"></a>df <span class="op">=</span> fetch_california_housing(as_frame<span class="op">=</span><span class="va">True</span>)[<span class="st">'frame'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:3,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902318189,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="b31f9660-aaa2-4664-c3dd-3b910ac8e77d" data-execution_count="84">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1"></a>X <span class="op">=</span> df.loc[:, [<span class="st">"MedInc"</span>, <span class="st">"Latitude"</span>, <span class="st">"Longitude"</span>]]</span>
<span id="cb109-2"><a href="#cb109-2"></a>X.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="84">

  <div id="df-ef8652f2-6eca-4602-a255-c99d28c42f19">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MedInc</th>
<th data-quarto-table-cell-role="th">Latitude</th>
<th data-quarto-table-cell-role="th">Longitude</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>8.3252</td>
<td>37.88</td>
<td>-122.23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>8.3014</td>
<td>37.86</td>
<td>-122.22</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7.2574</td>
<td>37.85</td>
<td>-122.24</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>5.6431</td>
<td>37.85</td>
<td>-122.25</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>3.8462</td>
<td>37.85</td>
<td>-122.25</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-ef8652f2-6eca-4602-a255-c99d28c42f19')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-ef8652f2-6eca-4602-a255-c99d28c42f19 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-ef8652f2-6eca-4602-a255-c99d28c42f19');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1525,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902322760,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="2bd6e369-8f56-460e-eafe-8ec26912a31e" data-execution_count="85">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1"></a><span class="co"># Create cluster feature</span></span>
<span id="cb110-2"><a href="#cb110-2"></a>kmeans <span class="op">=</span> KMeans(n_clusters <span class="op">=</span> <span class="dv">6</span>, n_init <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb110-3"><a href="#cb110-3"></a>X[<span class="st">"Cluster"</span>] <span class="op">=</span> kmeans.fit_predict(X)</span>
<span id="cb110-4"><a href="#cb110-4"></a>X[<span class="st">"Cluster"</span>] <span class="op">=</span> X[<span class="st">"Cluster"</span>].astype(<span class="st">"category"</span>)</span>
<span id="cb110-5"><a href="#cb110-5"></a></span>
<span id="cb110-6"><a href="#cb110-6"></a>X.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="85">

  <div id="df-03f33327-fba6-421a-bce2-0423b2c38f69">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MedInc</th>
<th data-quarto-table-cell-role="th">Latitude</th>
<th data-quarto-table-cell-role="th">Longitude</th>
<th data-quarto-table-cell-role="th">Cluster</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>8.3252</td>
<td>37.88</td>
<td>-122.23</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>8.3014</td>
<td>37.86</td>
<td>-122.22</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7.2574</td>
<td>37.85</td>
<td>-122.24</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>5.6431</td>
<td>37.85</td>
<td>-122.25</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>3.8462</td>
<td>37.85</td>
<td>-122.25</td>
<td>1</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-03f33327-fba6-421a-bce2-0423b2c38f69')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-03f33327-fba6-421a-bce2-0423b2c38f69 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-03f33327-fba6-421a-bce2-0423b2c38f69');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<p>Notice the differnece between <code>predict()</code> and <code>transform()</code> in the KMeans. <code>predict()</code> will predict the closest cluster each sample in <code>X</code> belongs to. <code>transform()</code> will transform data to a cluster-distance space where each dimension is the distance to the cluster centers.</p>
<p>Now let’s look at a couple plots to see how effective this was. First, a scatter plot that shows the geographic distribution of the clusters. It seems like the algorithm has created separate segments for higher-income areas on the coasts.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:3205,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902362656,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="e1f08d00-7b20-45d2-dc9a-70ff65c2ab1a" data-execution_count="86">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1"></a>sns.relplot(</span>
<span id="cb111-2"><a href="#cb111-2"></a>    x<span class="op">=</span><span class="st">"Longitude"</span>, y<span class="op">=</span><span class="st">"Latitude"</span>, hue<span class="op">=</span><span class="st">"Cluster"</span>, data<span class="op">=</span>X, height<span class="op">=</span><span class="dv">6</span>,</span>
<span id="cb111-3"><a href="#cb111-3"></a>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-87-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The target in this dataset is <code>MedHouseVal</code> (median house value). These box-plots show the distribution of the target within each cluster. If the clustering is informative, these distributions should, for the most part, separate across <code>MedHouseVal</code>, which is indeed what we see.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:604,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902381892,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="deaa4932-774b-4946-cf4c-330d76ec4a11" data-execution_count="87">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1"></a>X[<span class="st">"MedHouseVal"</span>] <span class="op">=</span> df[<span class="st">"MedHouseVal"</span>]</span>
<span id="cb112-2"><a href="#cb112-2"></a>sns.catplot(x<span class="op">=</span><span class="st">"MedHouseVal"</span>, y<span class="op">=</span><span class="st">"Cluster"</span>, data<span class="op">=</span>X, kind<span class="op">=</span><span class="st">"boxen"</span>, height<span class="op">=</span><span class="dv">6</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-88-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="cluster-distance-as-a-feature" class="level3" data-number="6.5.2">
<h3 data-number="6.5.2" class="anchored" data-anchor-id="cluster-distance-as-a-feature"><span class="header-section-number">6.5.2</span> Cluster distance as a feature</h3>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:899,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902407085,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="88">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1"></a>X_digits, y_digits <span class="op">=</span> load_digits(return_X_y<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb113-2"><a href="#cb113-2"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X_digits, y_digits, random_state<span class="op">=</span><span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now let’s fit a Logistic Regression model and evaluate it on the test set:</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1861,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902416222,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="4400ca4f-44f6-4f72-89a3-703964ba22d1" data-execution_count="89">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1"></a>log_reg <span class="op">=</span> LogisticRegression(multi_class<span class="op">=</span><span class="st">"ovr"</span>, solver<span class="op">=</span><span class="st">"lbfgs"</span>, max_iter<span class="op">=</span><span class="dv">5000</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb114-2"><a href="#cb114-2"></a>log_reg.fit(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="89">
<style>#sk-container-id-4 {color: black;background-color: white;}#sk-container-id-4 pre{padding: 0;}#sk-container-id-4 div.sk-toggleable {background-color: white;}#sk-container-id-4 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-4 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-4 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-4 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-4 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-4 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-4 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-4 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-4 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-4 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-4 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-4 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-4 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-4 div.sk-item {position: relative;z-index: 1;}#sk-container-id-4 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-4 div.sk-item::before, #sk-container-id-4 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-4 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-4 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-4 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-4 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-4 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-4 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-4 div.sk-label-container {text-align: center;}#sk-container-id-4 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-4 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-4" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LogisticRegression(max_iter=5000, multi_class='ovr', random_state=42)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox" checked=""><label for="sk-estimator-id-10" class="sk-toggleable__label sk-toggleable__label-arrow">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(max_iter=5000, multi_class='ovr', random_state=42)</pre></div></div></div></div></div>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:644,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902419325,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="afccb275-0902-49b9-f142-62111fef4e39" data-execution_count="90">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1"></a>log_reg_score <span class="op">=</span> log_reg.score(X_test, y_test)</span>
<span id="cb115-2"><a href="#cb115-2"></a>log_reg_score</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="90">
<pre><code>0.9688888888888889</code></pre>
</div>
</div>
<p>Okay, that’s our baseline: 96.89% accuracy. Let’s see if we can do better by using K-Means as a preprocessing step. <strong>We will create a pipeline that will first cluster the training set into 30 clusters and replace the images with their distances to the 30 clusters</strong>, then apply a logistic regression model:</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:6962,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902451565,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="868a7f6e-3438-47b2-8f82-c37168b7bdce" data-execution_count="91">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1"></a>pipeline <span class="op">=</span> Pipeline([</span>
<span id="cb117-2"><a href="#cb117-2"></a>    (<span class="st">"kmeans"</span>, KMeans(n_clusters<span class="op">=</span><span class="dv">30</span>, random_state<span class="op">=</span><span class="dv">42</span>, n_init<span class="op">=</span><span class="dv">10</span>)),</span>
<span id="cb117-3"><a href="#cb117-3"></a>    (<span class="st">"log_reg"</span>, LogisticRegression(multi_class<span class="op">=</span><span class="st">"ovr"</span>, solver<span class="op">=</span><span class="st">"lbfgs"</span>, max_iter<span class="op">=</span><span class="dv">5000</span>, random_state<span class="op">=</span><span class="dv">42</span>)),</span>
<span id="cb117-4"><a href="#cb117-4"></a>])</span>
<span id="cb117-5"><a href="#cb117-5"></a>pipeline.fit(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="91">
<style>#sk-container-id-5 {color: black;background-color: white;}#sk-container-id-5 pre{padding: 0;}#sk-container-id-5 div.sk-toggleable {background-color: white;}#sk-container-id-5 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-5 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-5 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-5 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-5 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-5 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-5 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-5 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-5 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-5 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-5 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-5 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-5 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-5 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-5 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-5 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-5 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-5 div.sk-item {position: relative;z-index: 1;}#sk-container-id-5 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-5 div.sk-item::before, #sk-container-id-5 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-5 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-5 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-5 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-5 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-5 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-5 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-5 div.sk-label-container {text-align: center;}#sk-container-id-5 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-5 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-5" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('kmeans', KMeans(n_clusters=30, n_init=10, random_state=42)),
                ('log_reg',
                 LogisticRegression(max_iter=5000, multi_class='ovr',
                                    random_state=42))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox"><label for="sk-estimator-id-11" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('kmeans', KMeans(n_clusters=30, n_init=10, random_state=42)),
                ('log_reg',
                 LogisticRegression(max_iter=5000, multi_class='ovr',
                                    random_state=42))])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-12" type="checkbox"><label for="sk-estimator-id-12" class="sk-toggleable__label sk-toggleable__label-arrow">KMeans</label><div class="sk-toggleable__content"><pre>KMeans(n_clusters=30, n_init=10, random_state=42)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-13" type="checkbox"><label for="sk-estimator-id-13" class="sk-toggleable__label sk-toggleable__label-arrow">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(max_iter=5000, multi_class='ovr', random_state=42)</pre></div></div></div></div></div></div></div>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:931,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902474921,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="faaf3615-a918-46c8-a702-92a449624e08" data-execution_count="93">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1"></a>X_train.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="93">
<pre><code>(1347, 64)</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:284,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902507818,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="bc6ad0d0-cac1-4c49-9e92-bd8938f27e9d" data-execution_count="94">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1"></a>pipeline_score <span class="op">=</span> pipeline.score(X_test, y_test)</span>
<span id="cb120-2"><a href="#cb120-2"></a>pipeline_score</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="94">
<pre><code>0.9733333333333334</code></pre>
</div>
</div>
<p>How much did the error rate drop?</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:492,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902529965,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="95640e7c-4e75-436a-f71c-cf3284254775" data-execution_count="95">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1"></a><span class="dv">1</span> <span class="op">-</span> (<span class="dv">1</span> <span class="op">-</span> pipeline_score) <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> log_reg_score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="95">
<pre><code>0.1428571428571439</code></pre>
</div>
</div>
<p>We reduced the error rate by over 14%!</p>
</section>
</section>
<section id="guideline-to-determine-the-optimal-number-of-features-or-threshold" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="guideline-to-determine-the-optimal-number-of-features-or-threshold"><span class="header-section-number">6.6</span> Guideline to determine the optimal number of features or threshold?</h2>
<p>To determine the optimal hyperparameter, we can use cross validation. For instance, in the above example, we chose the number of clusters <code>k</code> completely arbitrarily. However, we can surely do better. Since K-Means is just a preprocessing step in a classification pipeline, finding a good value for <code>k</code> is the best value of <code>k</code> is simply the one that results in the best classification performance.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1"></a><span class="co"># The following cell may take close to 20 minutes to run, or more depending on your hardware!</span></span>
<span id="cb124-2"><a href="#cb124-2"></a>param_grid <span class="op">=</span> <span class="bu">dict</span>(kmeans__n_clusters<span class="op">=</span><span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">60</span>))</span>
<span id="cb124-3"><a href="#cb124-3"></a>grid_clf <span class="op">=</span> GridSearchCV(pipeline, param_grid, cv<span class="op">=</span><span class="dv">3</span>, verbose<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb124-4"><a href="#cb124-4"></a>grid_clf.fit(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1"></a>grid_clf.best_params_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1"></a>grid_clf.score(X_test, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In the same way, you can also use cross-validation to evaluate model performance with different numbers of top-ranked features or different numbers of features and choose the optimal number based on the performance metric (e.g., highest accuracy or lowest error).</p>
<section id="using-clustering-for-semi-supervised-learning" class="level3" data-number="6.6.1">
<h3 data-number="6.6.1" class="anchored" data-anchor-id="using-clustering-for-semi-supervised-learning"><span class="header-section-number">6.6.1</span> Using Clustering for Semi-Supervised Learning</h3>
<p>Another use case for clustering is in semi-supervised learning, when we have plenty of unlabeled instances and very few labeled instances.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:261,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902620320,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="96">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1"></a>X_digits, y_digits <span class="op">=</span> load_digits(return_X_y<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb127-2"><a href="#cb127-2"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X_digits, y_digits, random_state<span class="op">=</span><span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s look at the performance of a logistic regression model when we only have 50 labeled instances:</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:282,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902623888,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="97">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1"></a>n_labeled <span class="op">=</span> <span class="dv">50</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:553,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902624812,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="f9c22929-8d17-447e-ed3f-0cb3f1e90166" data-execution_count="98">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1"></a>log_reg <span class="op">=</span> LogisticRegression(multi_class<span class="op">=</span><span class="st">"ovr"</span>, solver<span class="op">=</span><span class="st">"lbfgs"</span>, max_iter<span class="op">=</span><span class="dv">5000</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb129-2"><a href="#cb129-2"></a>log_reg.fit(X_train[:n_labeled], y_train[:n_labeled])</span>
<span id="cb129-3"><a href="#cb129-3"></a>log_reg.score(X_test, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="98">
<pre><code>0.8333333333333334</code></pre>
</div>
</div>
<p>The model’s accuracy is just 83.33%. It’s much less than earlier of course. Let’s see how we can do better. First, let’s cluster the training set into 50 clusters, then for each cluster let’s <strong>find the image closest to the centroid. We will call these images the representative images:</strong></p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1169,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902636265,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="99">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1"></a>k <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb131-2"><a href="#cb131-2"></a>kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span>k, random_state<span class="op">=</span><span class="dv">42</span>, n_init<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb131-3"><a href="#cb131-3"></a>X_digits_dist <span class="op">=</span> kmeans.fit_transform(X_train)</span>
<span id="cb131-4"><a href="#cb131-4"></a>representative_digit_idx <span class="op">=</span> np.argmin(X_digits_dist, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb131-5"><a href="#cb131-5"></a>X_representative_digits <span class="op">=</span> X_train[representative_digit_idx]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now let’s plot these representative images and label them manually:</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:2128,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902641108,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="42027dc5-97e0-4ab9-8a2b-8843b854ef38" data-execution_count="100">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">2</span>))</span>
<span id="cb132-2"><a href="#cb132-2"></a><span class="cf">for</span> index, X_representative_digit <span class="kw">in</span> <span class="bu">enumerate</span>(X_representative_digits):</span>
<span id="cb132-3"><a href="#cb132-3"></a>    plt.subplot(k <span class="op">//</span> <span class="dv">10</span>, <span class="dv">10</span>, index <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb132-4"><a href="#cb132-4"></a>    plt.imshow(X_representative_digit.reshape(<span class="dv">8</span>, <span class="dv">8</span>), cmap<span class="op">=</span><span class="st">"binary"</span>, interpolation<span class="op">=</span><span class="st">"bilinear"</span>)</span>
<span id="cb132-5"><a href="#cb132-5"></a>    plt.axis(<span class="st">'off'</span>)</span>
<span id="cb132-6"><a href="#cb132-6"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-103-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:828,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902653247,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="6370568a-c77d-4508-ca2a-a344ec650d0a" data-execution_count="101">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1"></a><span class="co"># Assuming we manually label these digits</span></span>
<span id="cb133-2"><a href="#cb133-2"></a>y_train[representative_digit_idx]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="101">
<pre><code>array([4, 8, 0, 6, 8, 3, 7, 7, 9, 2, 5, 5, 8, 5, 2, 1, 2, 9, 6, 1, 1, 6,
       9, 0, 8, 3, 0, 7, 4, 1, 6, 5, 2, 4, 1, 8, 6, 3, 9, 2, 4, 2, 9, 4,
       7, 6, 2, 3, 1, 1])</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902653543,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="102">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1"></a>y_representative_digits <span class="op">=</span> y_train[representative_digit_idx]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now we have a dataset with just 50 labeled instances, but instead of being completely random instances, each of them is a representative image of its cluster. Let’s see if the performance is any better:</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:265,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902656298,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="c5bbd594-4853-4021-a5af-822a69640604" data-execution_count="103">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1"></a>log_reg <span class="op">=</span> LogisticRegression(multi_class<span class="op">=</span><span class="st">"ovr"</span>, solver<span class="op">=</span><span class="st">"lbfgs"</span>, max_iter<span class="op">=</span><span class="dv">5000</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb136-2"><a href="#cb136-2"></a>log_reg.fit(X_representative_digits, y_representative_digits)</span>
<span id="cb136-3"><a href="#cb136-3"></a>log_reg.score(X_test, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="103">
<pre><code>0.9222222222222223</code></pre>
</div>
</div>
<p>We jumped from 83.3% accuracy to 92.2%, although we are still only training the model on 50 instances. Since it’s often costly and painful to label instances, especially when it has to be done manually by experts, it’s a good idea to make them label representative instances rather than just random instances.</p>
<p>But perhaps we can go one step further: <strong>what if we propagated the labels to all the other instances in the same cluster?</strong></p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:669,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902674761,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="104">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1"></a>y_train_propagated <span class="op">=</span> np.empty(<span class="bu">len</span>(X_train), dtype<span class="op">=</span>np.int32)</span>
<span id="cb138-2"><a href="#cb138-2"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(k):</span>
<span id="cb138-3"><a href="#cb138-3"></a>    y_train_propagated[kmeans.labels_<span class="op">==</span>i] <span class="op">=</span> y_representative_digits[i]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1512,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902679323,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="b81c8369-44a3-4a00-ee81-b2cdfa19df5a" data-execution_count="105">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1"></a>log_reg <span class="op">=</span> LogisticRegression(multi_class<span class="op">=</span><span class="st">"ovr"</span>, solver<span class="op">=</span><span class="st">"lbfgs"</span>, max_iter<span class="op">=</span><span class="dv">5000</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb139-2"><a href="#cb139-2"></a>log_reg.fit(X_train, y_train_propagated)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="105">
<style>#sk-container-id-6 {color: black;background-color: white;}#sk-container-id-6 pre{padding: 0;}#sk-container-id-6 div.sk-toggleable {background-color: white;}#sk-container-id-6 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-6 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-6 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-6 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-6 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-6 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-6 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-6 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-6 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-6 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-6 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-6 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-6 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-6 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-6 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-6 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-6 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-6 div.sk-item {position: relative;z-index: 1;}#sk-container-id-6 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-6 div.sk-item::before, #sk-container-id-6 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-6 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-6 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-6 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-6 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-6 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-6 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-6 div.sk-label-container {text-align: center;}#sk-container-id-6 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-6 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-6" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LogisticRegression(max_iter=5000, multi_class='ovr', random_state=42)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-14" type="checkbox" checked=""><label for="sk-estimator-id-14" class="sk-toggleable__label sk-toggleable__label-arrow">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(max_iter=5000, multi_class='ovr', random_state=42)</pre></div></div></div></div></div>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:8,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902679324,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="dd7b1e48-327c-4d3c-f3e7-8410828743b6" data-execution_count="106">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1"></a>log_reg.score(X_test, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="106">
<pre><code>0.9333333333333333</code></pre>
</div>
</div>
<p>We got a tiny little accuracy boost. Better than nothing, <strong>but we should probably have propagated the labels only to the instances closest to the centroid, because by propagating to the full cluster, we have certainly included some outliers.</strong> Let’s only propagate the labels to the 75th percentile closest to the centroid:</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:3,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902692464,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="107">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1"></a>percentile_closest <span class="op">=</span> <span class="dv">75</span></span>
<span id="cb142-2"><a href="#cb142-2"></a></span>
<span id="cb142-3"><a href="#cb142-3"></a>X_cluster_dist <span class="op">=</span> X_digits_dist[np.arange(<span class="bu">len</span>(X_train)), kmeans.labels_]</span>
<span id="cb142-4"><a href="#cb142-4"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(k):</span>
<span id="cb142-5"><a href="#cb142-5"></a>    in_cluster <span class="op">=</span> (kmeans.labels_ <span class="op">==</span> i)</span>
<span id="cb142-6"><a href="#cb142-6"></a>    cluster_dist <span class="op">=</span> X_cluster_dist[in_cluster]</span>
<span id="cb142-7"><a href="#cb142-7"></a>    cutoff_distance <span class="op">=</span> np.percentile(cluster_dist, percentile_closest)</span>
<span id="cb142-8"><a href="#cb142-8"></a>    above_cutoff <span class="op">=</span> (X_cluster_dist <span class="op">&gt;</span> cutoff_distance)</span>
<span id="cb142-9"><a href="#cb142-9"></a>    X_cluster_dist[in_cluster <span class="op">&amp;</span> above_cutoff] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:2,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902692464,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="108">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1"></a>partially_propagated <span class="op">=</span> (X_cluster_dist <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb143-2"><a href="#cb143-2"></a>X_train_partially_propagated <span class="op">=</span> X_train[partially_propagated]</span>
<span id="cb143-3"><a href="#cb143-3"></a>y_train_partially_propagated <span class="op">=</span> y_train_propagated[partially_propagated]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:3,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902694584,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="d8edb43e-e57f-4549-85c6-edb0a7c183ef" data-execution_count="109">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1"></a>X_train.shape, X_train_partially_propagated.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="109">
<pre><code>((1347, 64), (1003, 64))</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:2085,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902696668,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="59f5efef-fbd2-40b3-c33c-d5f148543894" data-execution_count="110">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1"></a>log_reg <span class="op">=</span> LogisticRegression(multi_class<span class="op">=</span><span class="st">"ovr"</span>, solver<span class="op">=</span><span class="st">"lbfgs"</span>, max_iter<span class="op">=</span><span class="dv">5000</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb146-2"><a href="#cb146-2"></a>log_reg.fit(X_train_partially_propagated, y_train_partially_propagated)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="110">
<style>#sk-container-id-7 {color: black;background-color: white;}#sk-container-id-7 pre{padding: 0;}#sk-container-id-7 div.sk-toggleable {background-color: white;}#sk-container-id-7 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-7 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-7 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-7 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-7 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-7 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-7 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-7 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-7 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-7 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-7 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-7 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-7 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-7 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-7 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-7 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-7 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-7 div.sk-item {position: relative;z-index: 1;}#sk-container-id-7 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-7 div.sk-item::before, #sk-container-id-7 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-7 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-7 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-7 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-7 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-7 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-7 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-7 div.sk-label-container {text-align: center;}#sk-container-id-7 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-7 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-7" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LogisticRegression(max_iter=5000, multi_class='ovr', random_state=42)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-15" type="checkbox" checked=""><label for="sk-estimator-id-15" class="sk-toggleable__label sk-toggleable__label-arrow">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(max_iter=5000, multi_class='ovr', random_state=42)</pre></div></div></div></div></div>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:269,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902703747,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="ebe7920b-5b02-4800-b6b2-98c8c3d14d1f" data-execution_count="111">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1"></a>log_reg.score(X_test, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="111">
<pre><code>0.9355555555555556</code></pre>
</div>
</div>
<p>A bit better. With just 50 labeled instances (just 5 examples per class on average!), we got 93.5% performance, which is getting closer to the performance of logistic regression on the fully labeled digits dataset.</p>
<p>Our propagated labels are actually pretty good: their accuracy is about 97.5%:</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:326,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902710156,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="17a8adfb-fd6c-4a7a-f900-e5d845d606b9" data-execution_count="112">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1"></a>np.mean(y_train_partially_propagated <span class="op">==</span> y_train[partially_propagated])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="112">
<pre><code>0.9750747756729811</code></pre>
</div>
</div>
<p>You could also do a few iterations of active learning:</p>
<ol type="1">
<li>Manually label the instances that the classifier is least sure about, if possible by picking them in distinct clusters.</li>
<li>Train a new model with these additional labels.</li>
</ol>
</section>
<section id="feature-agglomeration" class="level3" data-number="6.6.2">
<h3 data-number="6.6.2" class="anchored" data-anchor-id="feature-agglomeration"><span class="header-section-number">6.6.2</span> Feature agglomeration</h3>
<p><code>cluster.FeatureAgglomeration</code> applies Hierarchical clustering to group together features that behave similarly.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:893,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902725844,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="113">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1"></a>X, y <span class="op">=</span> load_iris(return_X_y<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:278,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902741093,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-execution_count="114">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1"></a><span class="co">#set n_clusters to 2, the output will be two columns of agglomerated features (iris has 4 features)</span></span>
<span id="cb152-2"><a href="#cb152-2"></a>agglo <span class="op">=</span> FeatureAgglomeration(n_clusters<span class="op">=</span><span class="dv">2</span>).fit_transform(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:364,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679902746083,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="c49ac8d7-038b-48da-8e2f-15dbc7c0a91b" data-execution_count="115">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1"></a>plt.scatter(agglo[:,<span class="dv">0</span>], agglo[:,<span class="dv">1</span>],c<span class="op">=</span>y)</span>
<span id="cb153-2"><a href="#cb153-2"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="05_Feature_selection_extraction_files/figure-html/cell-118-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="references" class="level2" data-number="6.7">
<h2 data-number="6.7" class="anchored" data-anchor-id="references"><span class="header-section-number">6.7</span> References</h2>
<ol type="1">
<li><a href="https://www.kaggle.com/learn/feature-engineering">https://www.kaggle.com/learn/feature-engineering</a></li>
<li><a href="https://inria.github.io/scikit-learn-mooc/python_scripts/dev_features_importance.html#">https://inria.github.io/scikit-learn-mooc/python_scripts/dev_features_importance.html#</a></li>
<li><a href="https://scikit-learn.org/stable/modules/feature_selection.html">https://scikit-learn.org/stable/modules/feature_selection.html</a></li>
<li><a href="https://scikit-learn.org/stable/modules/preprocessing.html#">https://scikit-learn.org/stable/modules/preprocessing.html#</a></li>
<li><a href="https://scikit-learn.org/stable/modules/unsupervised_reduction.html">https://scikit-learn.org/stable/modules/unsupervised_reduction.html</a></li>
<li><a href="https://github.com/ageron/handson-ml3/blob/main/09_unsupervised_learning.ipynb">https://github.com/ageron/handson-ml3/blob/main/09_unsupervised_learning.ipynb</a></li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./04_Clean_feature_engineering.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data cleaning and feature engineering</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./06_XAI.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Explainable AI</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>