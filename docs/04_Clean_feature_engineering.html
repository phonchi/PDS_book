<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.306">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="phonchi">
<meta name="dcterms.date" content="2023-03-13">

<title>Practical and Innovative Analytics in Data Science - 4&nbsp; Data cleaning and feature engineering</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./05_Feature_selection_extraction.html" rel="next">
<link href="./03_Relational_Database_and_data_wrangling.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./04_Clean_feature_engineering.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data cleaning and feature engineering</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Practical and Innovative Analytics in Data Science</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_end_to_end_machine_learning_project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">End-to-end Machine Learning project</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_Dataset.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Framing the problem and constructing the dataset</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_Relational_Database_and_data_wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Relational Database and data wrangling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_Clean_feature_engineering.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data cleaning and feature engineering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_Feature_selection_extraction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Feature selection and extraction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_XAI.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Explainable AI</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_Deploy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Deploy and monitoring</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./NumPy_tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Numpy - multidimensional data arrays for python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Colab_tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Introduction to Colab</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./kaggle-explore.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Introduction to Kaggle</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup"><span class="header-section-number">4.1</span> Setup</a></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis"><span class="header-section-number">4.2</span> Exploratory Data Analysis</a></li>
  <li><a href="#handling-missing-value" id="toc-handling-missing-value" class="nav-link" data-scroll-target="#handling-missing-value"><span class="header-section-number">4.3</span> Handling missing value</a>
  <ul class="collapse">
  <li><a href="#take-a-first-look-at-the-data" id="toc-take-a-first-look-at-the-data" class="nav-link" data-scroll-target="#take-a-first-look-at-the-data"><span class="header-section-number">4.3.1</span> Take a first look at the data</a></li>
  <li><a href="#how-many-missing-data-points-do-we-have" id="toc-how-many-missing-data-points-do-we-have" class="nav-link" data-scroll-target="#how-many-missing-data-points-do-we-have"><span class="header-section-number">4.3.2</span> How many missing data points do we have?</a></li>
  <li><a href="#drop-missing-values" id="toc-drop-missing-values" class="nav-link" data-scroll-target="#drop-missing-values"><span class="header-section-number">4.3.3</span> Drop missing values</a></li>
  <li><a href="#filling-in-missing-values-automatically" id="toc-filling-in-missing-values-automatically" class="nav-link" data-scroll-target="#filling-in-missing-values-automatically"><span class="header-section-number">4.3.4</span> Filling in missing values automatically</a></li>
  <li><a href="#imputation-of-missing-value" id="toc-imputation-of-missing-value" class="nav-link" data-scroll-target="#imputation-of-missing-value"><span class="header-section-number">4.3.5</span> Imputation of missing value</a></li>
  </ul></li>
  <li><a href="#other-data-cleaning-problem" id="toc-other-data-cleaning-problem" class="nav-link" data-scroll-target="#other-data-cleaning-problem"><span class="header-section-number">4.4</span> Other data cleaning problem</a>
  <ul class="collapse">
  <li><a href="#duplicate-data-entry" id="toc-duplicate-data-entry" class="nav-link" data-scroll-target="#duplicate-data-entry"><span class="header-section-number">4.4.1</span> Duplicate data entry</a></li>
  <li><a href="#inconsistent-data-entry" id="toc-inconsistent-data-entry" class="nav-link" data-scroll-target="#inconsistent-data-entry"><span class="header-section-number">4.4.2</span> Inconsistent data entry</a></li>
  <li><a href="#character-encoding" id="toc-character-encoding" class="nav-link" data-scroll-target="#character-encoding"><span class="header-section-number">4.4.3</span> Character encoding</a></li>
  <li><a href="#reading-in-files-with-encoding-problems" id="toc-reading-in-files-with-encoding-problems" class="nav-link" data-scroll-target="#reading-in-files-with-encoding-problems"><span class="header-section-number">4.4.4</span> Reading in files with encoding problems</a></li>
  <li><a href="#saving-your-files-with-utf-8-encoding" id="toc-saving-your-files-with-utf-8-encoding" class="nav-link" data-scroll-target="#saving-your-files-with-utf-8-encoding"><span class="header-section-number">4.4.5</span> Saving your files with UTF-8 encoding</a></li>
  </ul></li>
  <li><a href="#scaling-and-normalization" id="toc-scaling-and-normalization" class="nav-link" data-scroll-target="#scaling-and-normalization"><span class="header-section-number">4.5</span> Scaling and normalization</a>
  <ul class="collapse">
  <li><a href="#standardization" id="toc-standardization" class="nav-link" data-scroll-target="#standardization"><span class="header-section-number">4.5.1</span> Standardization</a></li>
  <li><a href="#scaling" id="toc-scaling" class="nav-link" data-scroll-target="#scaling"><span class="header-section-number">4.5.2</span> Scaling</a></li>
  <li><a href="#logarithm-transform-and-binning" id="toc-logarithm-transform-and-binning" class="nav-link" data-scroll-target="#logarithm-transform-and-binning"><span class="header-section-number">4.5.3</span> Logarithm transform and binning</a></li>
  <li><a href="#power-transfrom" id="toc-power-transfrom" class="nav-link" data-scroll-target="#power-transfrom"><span class="header-section-number">4.5.4</span> Power transfrom</a></li>
  <li><a href="#quantile-transfrom" id="toc-quantile-transfrom" class="nav-link" data-scroll-target="#quantile-transfrom"><span class="header-section-number">4.5.5</span> Quantile transfrom</a></li>
  </ul></li>
  <li><a href="#encoding" id="toc-encoding" class="nav-link" data-scroll-target="#encoding"><span class="header-section-number">4.6</span> Encoding</a>
  <ul class="collapse">
  <li><a href="#one-hot-encoding" id="toc-one-hot-encoding" class="nav-link" data-scroll-target="#one-hot-encoding"><span class="header-section-number">4.6.1</span> One-hot encoding</a></li>
  <li><a href="#ordinal-encoding" id="toc-ordinal-encoding" class="nav-link" data-scroll-target="#ordinal-encoding"><span class="header-section-number">4.6.2</span> Ordinal encoding</a></li>
  <li><a href="#target-encoding" id="toc-target-encoding" class="nav-link" data-scroll-target="#target-encoding"><span class="header-section-number">4.6.3</span> Target encoding</a></li>
  </ul></li>
  <li><a href="#feature-engineering" id="toc-feature-engineering" class="nav-link" data-scroll-target="#feature-engineering"><span class="header-section-number">4.7</span> Feature Engineering</a>
  <ul class="collapse">
  <li><a href="#mathematical-transforms" id="toc-mathematical-transforms" class="nav-link" data-scroll-target="#mathematical-transforms"><span class="header-section-number">4.7.1</span> Mathematical Transforms</a></li>
  <li><a href="#counts" id="toc-counts" class="nav-link" data-scroll-target="#counts"><span class="header-section-number">4.7.2</span> Counts</a></li>
  <li><a href="#group-transforms" id="toc-group-transforms" class="nav-link" data-scroll-target="#group-transforms"><span class="header-section-number">4.7.3</span> Group Transforms</a></li>
  </ul></li>
  <li><a href="#data-centric-ai-with-cleanlab" id="toc-data-centric-ai-with-cleanlab" class="nav-link" data-scroll-target="#data-centric-ai-with-cleanlab"><span class="header-section-number">4.8</span> Data-centric AI with CleanLab</a>
  <ul class="collapse">
  <li><a href="#use-cleanlearning-for-everything" id="toc-use-cleanlearning-for-everything" class="nav-link" data-scroll-target="#use-cleanlearning-for-everything"><span class="header-section-number">4.8.1</span> Use <code>CleanLearning()</code> for everything</a></li>
  <li><a href="#use-cleanlearning-to-find_label_issues-in-one-line-of-code" id="toc-use-cleanlearning-to-find_label_issues-in-one-line-of-code" class="nav-link" data-scroll-target="#use-cleanlearning-to-find_label_issues-in-one-line-of-code"><span class="header-section-number">4.8.2</span> Use <code>CleanLearning()</code> to <code>find_label_issues()</code> in one line of code</a></li>
  <li><a href="#use-cleanlab-to-find-dataset-level-and-class-level-issues" id="toc-use-cleanlab-to-find-dataset-level-and-class-level-issues" class="nav-link" data-scroll-target="#use-cleanlab-to-find-dataset-level-and-class-level-issues"><span class="header-section-number">4.8.3</span> Use <code>cleanlab</code> to find dataset-level and class-level issues</a></li>
  <li><a href="#clean-your-test-set-too-if-youre-doing-ml-with-noisy-labels" id="toc-clean-your-test-set-too-if-youre-doing-ml-with-noisy-labels" class="nav-link" data-scroll-target="#clean-your-test-set-too-if-youre-doing-ml-with-noisy-labels"><span class="header-section-number">4.8.4</span> Clean your test set too if you’re doing ML with noisy labels!</a></li>
  <li><a href="#one-score-to-rule-them-all-use-cleanlabs-overall-dataset-health-score" id="toc-one-score-to-rule-them-all-use-cleanlabs-overall-dataset-health-score" class="nav-link" data-scroll-target="#one-score-to-rule-them-all-use-cleanlabs-overall-dataset-health-score"><span class="header-section-number">4.8.5</span> One score to rule them all – use cleanlab’s overall dataset health score</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">5</span> References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data cleaning and feature engineering</span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>phonchi </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 13, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>


<table align="left">
<tbody><tr><td>
<a href="https://colab.research.google.com/github/phonchi/nsysu-math608/blob/master/static_files/presentations/04_Clean_feature_engineering.ipynb" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a>
</td>
<td>
<a target="_blank" href="https://kaggle.com/kernels/welcome?src=https://github.com/phonchi/nsysu-math608/blob/master/static_files/presentations/04_Clean_feature_engineering.ipynb"><img src="https://kaggle.com/static/images/open-in-kaggle.svg"></a>
</td>

</tr></tbody></table>
<p><br></p>
<section id="setup" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="setup"><span class="header-section-number">4.1</span> Setup</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="op">!</span>pip install fancyimpute <span class="op">-</span>q</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="op">!</span>pip install thefuzz <span class="op">-</span>q</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="op">!</span>pip install <span class="op">--</span>upgrade xlrd <span class="op">-</span>q</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="op">!</span>pip install category_encoders <span class="op">-</span>q</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="op">!</span>pip install cleanlab <span class="op">-</span>q</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Scientific computing</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="im">from</span> numpy.random <span class="im">import</span> multivariate_normal</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb2-9"><a href="#cb2-9"></a></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co"># Modeling</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> ExtraTreesRegressor</span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb2-16"><a href="#cb2-16"></a></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="co"># Imputing</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> KNNImputer</span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="im">from</span> sklearn.experimental <span class="im">import</span> enable_iterative_imputer <span class="co"># To use IterativeImputer, you need to explicitly import enable_iterative_imputer.</span></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> IterativeImputer</span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="im">from</span> fancyimpute <span class="im">import</span> SoftImpute</span>
<span id="cb2-23"><a href="#cb2-23"></a></span>
<span id="cb2-24"><a href="#cb2-24"></a><span class="co"># helpful character encoding module</span></span>
<span id="cb2-25"><a href="#cb2-25"></a><span class="im">import</span> chardet</span>
<span id="cb2-26"><a href="#cb2-26"></a><span class="im">from</span> thefuzz <span class="im">import</span> fuzz</span>
<span id="cb2-27"><a href="#cb2-27"></a><span class="im">from</span> thefuzz <span class="im">import</span> process</span>
<span id="cb2-28"><a href="#cb2-28"></a></span>
<span id="cb2-29"><a href="#cb2-29"></a><span class="co"># Normalization</span></span>
<span id="cb2-30"><a href="#cb2-30"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb2-31"><a href="#cb2-31"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MinMaxScaler</span>
<span id="cb2-32"><a href="#cb2-32"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> PowerTransformer</span>
<span id="cb2-33"><a href="#cb2-33"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> QuantileTransformer</span>
<span id="cb2-34"><a href="#cb2-34"></a></span>
<span id="cb2-35"><a href="#cb2-35"></a><span class="co"># Encoding</span></span>
<span id="cb2-36"><a href="#cb2-36"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder</span>
<span id="cb2-37"><a href="#cb2-37"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OrdinalEncoder</span>
<span id="cb2-38"><a href="#cb2-38"></a><span class="im">from</span> category_encoders <span class="im">import</span> MEstimateEncoder</span>
<span id="cb2-39"><a href="#cb2-39"></a></span>
<span id="cb2-40"><a href="#cb2-40"></a><span class="co"># Fix labels</span></span>
<span id="cb2-41"><a href="#cb2-41"></a><span class="im">import</span> cleanlab</span>
<span id="cb2-42"><a href="#cb2-42"></a><span class="im">from</span> cleanlab.classification <span class="im">import</span> CleanLearning</span>
<span id="cb2-43"><a href="#cb2-43"></a><span class="im">from</span> cleanlab.benchmarking <span class="im">import</span> noise_generation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">## Make synthetic dataset for cleanlab</span></span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a>SEED <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="kw">def</span> make_data(</span>
<span id="cb3-6"><a href="#cb3-6"></a>    means<span class="op">=</span>[[<span class="dv">3</span>, <span class="dv">2</span>], [<span class="dv">7</span>, <span class="dv">7</span>], [<span class="dv">0</span>, <span class="dv">8</span>], [<span class="dv">0</span>, <span class="dv">10</span>]],</span>
<span id="cb3-7"><a href="#cb3-7"></a>    covs<span class="op">=</span>[</span>
<span id="cb3-8"><a href="#cb3-8"></a>        [[<span class="dv">5</span>, <span class="op">-</span><span class="fl">1.5</span>], [<span class="op">-</span><span class="fl">1.5</span>, <span class="dv">1</span>]],</span>
<span id="cb3-9"><a href="#cb3-9"></a>        [[<span class="dv">1</span>, <span class="fl">0.5</span>], [<span class="fl">0.5</span>, <span class="dv">4</span>]],</span>
<span id="cb3-10"><a href="#cb3-10"></a>        [[<span class="dv">5</span>, <span class="dv">1</span>], [<span class="dv">1</span>, <span class="dv">5</span>]],</span>
<span id="cb3-11"><a href="#cb3-11"></a>        [[<span class="dv">3</span>, <span class="dv">1</span>], [<span class="dv">1</span>, <span class="dv">1</span>]],</span>
<span id="cb3-12"><a href="#cb3-12"></a>    ],</span>
<span id="cb3-13"><a href="#cb3-13"></a>    sizes<span class="op">=</span>[<span class="dv">100</span>, <span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">50</span>],</span>
<span id="cb3-14"><a href="#cb3-14"></a>    avg_trace<span class="op">=</span><span class="fl">0.8</span>,</span>
<span id="cb3-15"><a href="#cb3-15"></a>    seed<span class="op">=</span>SEED,  <span class="co"># set to None for non-reproducible randomness</span></span>
<span id="cb3-16"><a href="#cb3-16"></a>):</span>
<span id="cb3-17"><a href="#cb3-17"></a>    np.random.seed(seed<span class="op">=</span>SEED)</span>
<span id="cb3-18"><a href="#cb3-18"></a></span>
<span id="cb3-19"><a href="#cb3-19"></a>    K <span class="op">=</span> <span class="bu">len</span>(means)  <span class="co"># number of classes</span></span>
<span id="cb3-20"><a href="#cb3-20"></a>    data <span class="op">=</span> []</span>
<span id="cb3-21"><a href="#cb3-21"></a>    labels <span class="op">=</span> []</span>
<span id="cb3-22"><a href="#cb3-22"></a>    test_data <span class="op">=</span> []</span>
<span id="cb3-23"><a href="#cb3-23"></a>    test_labels <span class="op">=</span> []</span>
<span id="cb3-24"><a href="#cb3-24"></a></span>
<span id="cb3-25"><a href="#cb3-25"></a>    <span class="cf">for</span> idx <span class="kw">in</span> <span class="bu">range</span>(K):</span>
<span id="cb3-26"><a href="#cb3-26"></a>        data.append(</span>
<span id="cb3-27"><a href="#cb3-27"></a>            np.random.multivariate_normal(</span>
<span id="cb3-28"><a href="#cb3-28"></a>                mean<span class="op">=</span>means[idx], cov<span class="op">=</span>covs[idx], size<span class="op">=</span>sizes[idx]</span>
<span id="cb3-29"><a href="#cb3-29"></a>            )</span>
<span id="cb3-30"><a href="#cb3-30"></a>        )</span>
<span id="cb3-31"><a href="#cb3-31"></a>        test_data.append(</span>
<span id="cb3-32"><a href="#cb3-32"></a>            np.random.multivariate_normal(</span>
<span id="cb3-33"><a href="#cb3-33"></a>                mean<span class="op">=</span>means[idx], cov<span class="op">=</span>covs[idx], size<span class="op">=</span>sizes[idx]</span>
<span id="cb3-34"><a href="#cb3-34"></a>            )</span>
<span id="cb3-35"><a href="#cb3-35"></a>        )</span>
<span id="cb3-36"><a href="#cb3-36"></a>        labels.append(np.array([idx <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(sizes[idx])]))</span>
<span id="cb3-37"><a href="#cb3-37"></a>        test_labels.append(np.array([idx <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(sizes[idx])]))</span>
<span id="cb3-38"><a href="#cb3-38"></a>    X_train <span class="op">=</span> np.vstack(data)</span>
<span id="cb3-39"><a href="#cb3-39"></a>    y_train <span class="op">=</span> np.hstack(labels)</span>
<span id="cb3-40"><a href="#cb3-40"></a>    X_test <span class="op">=</span> np.vstack(test_data)</span>
<span id="cb3-41"><a href="#cb3-41"></a>    y_test <span class="op">=</span> np.hstack(test_labels)</span>
<span id="cb3-42"><a href="#cb3-42"></a></span>
<span id="cb3-43"><a href="#cb3-43"></a>    <span class="co"># Compute p(y=k) the prior distribution over true labels.</span></span>
<span id="cb3-44"><a href="#cb3-44"></a>    py_true <span class="op">=</span> np.bincount(y_train) <span class="op">/</span> <span class="bu">float</span>(<span class="bu">len</span>(y_train))</span>
<span id="cb3-45"><a href="#cb3-45"></a></span>
<span id="cb3-46"><a href="#cb3-46"></a>    noise_matrix_true <span class="op">=</span> noise_generation.generate_noise_matrix_from_trace(</span>
<span id="cb3-47"><a href="#cb3-47"></a>        K,</span>
<span id="cb3-48"><a href="#cb3-48"></a>        trace<span class="op">=</span>avg_trace <span class="op">*</span> K,</span>
<span id="cb3-49"><a href="#cb3-49"></a>        py<span class="op">=</span>py_true,</span>
<span id="cb3-50"><a href="#cb3-50"></a>        valid_noise_matrix<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb3-51"><a href="#cb3-51"></a>        seed<span class="op">=</span>SEED,</span>
<span id="cb3-52"><a href="#cb3-52"></a>    )</span>
<span id="cb3-53"><a href="#cb3-53"></a></span>
<span id="cb3-54"><a href="#cb3-54"></a>    <span class="co"># Generate our noisy labels using the noise_marix.</span></span>
<span id="cb3-55"><a href="#cb3-55"></a>    s <span class="op">=</span> noise_generation.generate_noisy_labels(y_train, noise_matrix_true)</span>
<span id="cb3-56"><a href="#cb3-56"></a>    s_test <span class="op">=</span> noise_generation.generate_noisy_labels(y_test, noise_matrix_true)</span>
<span id="cb3-57"><a href="#cb3-57"></a>    ps <span class="op">=</span> np.bincount(s) <span class="op">/</span> <span class="bu">float</span>(<span class="bu">len</span>(s))  <span class="co"># Prior distribution over noisy labels</span></span>
<span id="cb3-58"><a href="#cb3-58"></a></span>
<span id="cb3-59"><a href="#cb3-59"></a>    <span class="cf">return</span> {</span>
<span id="cb3-60"><a href="#cb3-60"></a>        <span class="st">"data"</span>: X_train,</span>
<span id="cb3-61"><a href="#cb3-61"></a>        <span class="st">"true_labels"</span>: y_train,  <span class="co"># You never get to see these perfect labels.</span></span>
<span id="cb3-62"><a href="#cb3-62"></a>        <span class="st">"labels"</span>: s,  <span class="co"># Instead, you have these labels, which have some errors.</span></span>
<span id="cb3-63"><a href="#cb3-63"></a>        <span class="st">"test_data"</span>: X_test,</span>
<span id="cb3-64"><a href="#cb3-64"></a>        <span class="st">"test_labels"</span>: y_test,  <span class="co"># Perfect labels used for "true" measure of model's performance during deployment.</span></span>
<span id="cb3-65"><a href="#cb3-65"></a>        <span class="st">"noisy_test_labels"</span>: s_test,  <span class="co"># With IID train/test split, you'd have these labels, which also have some errors.</span></span>
<span id="cb3-66"><a href="#cb3-66"></a>        <span class="st">"ps"</span>: ps,</span>
<span id="cb3-67"><a href="#cb3-67"></a>        <span class="st">"py_true"</span>: py_true,</span>
<span id="cb3-68"><a href="#cb3-68"></a>        <span class="st">"noise_matrix_true"</span>: noise_matrix_true,</span>
<span id="cb3-69"><a href="#cb3-69"></a>        <span class="st">"class_names"</span>: [<span class="st">"purple"</span>, <span class="st">"blue"</span>, <span class="st">"seafoam green"</span>, <span class="st">"yellow"</span>],</span>
<span id="cb3-70"><a href="#cb3-70"></a>    }</span>
<span id="cb3-71"><a href="#cb3-71"></a></span>
<span id="cb3-72"><a href="#cb3-72"></a></span>
<span id="cb3-73"><a href="#cb3-73"></a><span class="co"># Display dataset visually using matplotlib</span></span>
<span id="cb3-74"><a href="#cb3-74"></a><span class="kw">def</span> plot_data(data, circles, title, alpha<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb3-75"><a href="#cb3-75"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb3-76"><a href="#cb3-76"></a>    plt.scatter(data[:, <span class="dv">0</span>], data[:, <span class="dv">1</span>], c<span class="op">=</span>labels, s<span class="op">=</span><span class="dv">60</span>)</span>
<span id="cb3-77"><a href="#cb3-77"></a>    <span class="cf">for</span> i <span class="kw">in</span> circles:</span>
<span id="cb3-78"><a href="#cb3-78"></a>        plt.plot(</span>
<span id="cb3-79"><a href="#cb3-79"></a>            data[i][<span class="dv">0</span>],</span>
<span id="cb3-80"><a href="#cb3-80"></a>            data[i][<span class="dv">1</span>],</span>
<span id="cb3-81"><a href="#cb3-81"></a>            <span class="st">"o"</span>,</span>
<span id="cb3-82"><a href="#cb3-82"></a>            markerfacecolor<span class="op">=</span><span class="st">"none"</span>,</span>
<span id="cb3-83"><a href="#cb3-83"></a>            markeredgecolor<span class="op">=</span><span class="st">"red"</span>,</span>
<span id="cb3-84"><a href="#cb3-84"></a>            markersize<span class="op">=</span><span class="dv">14</span>,</span>
<span id="cb3-85"><a href="#cb3-85"></a>            markeredgewidth<span class="op">=</span><span class="fl">2.5</span>,</span>
<span id="cb3-86"><a href="#cb3-86"></a>            alpha<span class="op">=</span>alpha</span>
<span id="cb3-87"><a href="#cb3-87"></a>        )</span>
<span id="cb3-88"><a href="#cb3-88"></a>    _ <span class="op">=</span> plt.title(title, fontsize<span class="op">=</span><span class="dv">25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exploratory-data-analysis" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="exploratory-data-analysis"><span class="header-section-number">4.2</span> Exploratory Data Analysis</h2>
<p>You can checkout some of useful EDA tools <a href="https://github.com/ydataai/ydata-profiling">pandas-profiling</a>, <a href="https://github.com/sfu-db/dataprep">dataprep</a>, <a href="https://github.com/lux-org/lux">lux</a> or <a href="https://github.com/man-group/dtale">dtale</a></p>
</section>
<section id="handling-missing-value" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="handling-missing-value"><span class="header-section-number">4.3</span> Handling missing value</h2>
<p>In this section, you’ll learn why you’ve run into the data cleaning problems and, more importantly, how to fix them! Specifically, you’ll learn how to tackle some of the most common data cleaning problems so you can get to actually analyzing your data faster.</p>
<section id="take-a-first-look-at-the-data" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="take-a-first-look-at-the-data"><span class="header-section-number">4.3.1</span> Take a first look at the data</h3>
<p>For demonstration, we’ll use a dataset of events that occured in American Football games. You’ll apply your new skills to a dataset of building permits issued in San Francisco. The dataset that we will use was made available by Kaggle. You can download the original dataset from https://www.kaggle.com/datasets/maxhorowitz/nflplaybyplay2009to2016.</p>
<p>But you can also use Kaggle API. First, you need to create a Kaggle API key and download it to your local machine. Just navigate to the Kaggle website in a web browser, log in, and go to the My Account page. In your account settings, you’ll find an API section. Clicking the Create New API Token button will generate a kaggle.json key file and will download it to your machine.</p>
<p align="center">
<img src="https://drive.google.com/uc?id=1Yo0bW4A59Se1EbE50JZMiWNueErB2eJa" alt="drawing" width="600">
</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Upload the API’s key JSON file to your Colab</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co"># session by running the following code in a notebook cell:</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="im">from</span> google.colab <span class="im">import</span> files</span>
<span id="cb4-4"><a href="#cb4-4"></a>files.upload()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="op">!</span>mkdir <span class="op">~/</span>.kaggle</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="op">!</span>cp kaggle.json <span class="op">~/</span>.kaggle<span class="op">/</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="op">!</span>chmod <span class="dv">600</span> <span class="op">~/</span>.kaggle<span class="op">/</span>kaggle.json</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p>In some dataset, when the first time you try to download the data, you may get a “403 Forbidden” error. That’s because you need to accept the terms associated with the dataset before you download it and click the “I Understand and Accept button”. You only need to do this once.</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="op">!</span>kaggle datasets download <span class="op">-</span>d maxhorowitz<span class="op">/</span>nflplaybyplay2009to2016</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="op">!</span>unzip <span class="op">-</span>qq nflplaybyplay2009to2016</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># read in all our data</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>nfl_data <span class="op">=</span> pd.read_csv(<span class="st">"NFL Play by Play 2009-2017 (v4).csv"</span>)</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co"># set seed for reproducibility</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>np.random.seed(<span class="dv">0</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The first thing to do when you get a new dataset is take a look at some of it. This lets you see that it all read in correctly and gives an idea of what’s going on with the data. In this case, let’s see if there are any missing values, which will be reprsented with <code>NaN</code> or <code>None</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># look at the first five rows of the nfl_data file. </span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="co"># I can see a handful of missing data already!</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>nfl_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:289,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678677975079,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="35a6d595-254f-4275-efbe-13a5dbfebf48">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a>nfl_data.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>(407688, 102)</code></pre>
</div>
</div>
</section>
<section id="how-many-missing-data-points-do-we-have" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="how-many-missing-data-points-do-we-have"><span class="header-section-number">4.3.2</span> How many missing data points do we have?</h3>
<p>Ok, now we know that we do have some missing values. Let’s see how many we have in each column.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:722,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678005413,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="3f95f721-c2c5-4734-b129-c04bbc44b1e6">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># get the number of missing data points per column</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>missing_values_count <span class="op">=</span> nfl_data.isnull().<span class="bu">sum</span>()</span>
<span id="cb12-3"><a href="#cb12-3"></a></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="co"># look at the # of missing points in the first ten columns</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>missing_values_count[<span class="dv">0</span>:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>Date                0
GameID              0
Drive               0
qtr                 0
down            61154
time              224
TimeUnder           0
TimeSecs          224
PlayTimeDiff      444
SideofField       528
dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:318,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678045091,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="a4669f40-6176-4940-fa6f-0d2efc6647c1">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># how many total missing values do we have?</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>total_cells <span class="op">=</span> np.product(nfl_data.shape)</span>
<span id="cb14-3"><a href="#cb14-3"></a>total_missing <span class="op">=</span> missing_values_count.<span class="bu">sum</span>()</span>
<span id="cb14-4"><a href="#cb14-4"></a></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="co"># percent of data that is missing</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>percent_missing <span class="op">=</span> (total_missing<span class="op">/</span>total_cells) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="bu">print</span>(percent_missing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>24.87214126835169</code></pre>
</div>
</div>
<p>Almost a quarter of the cells in this dataset are empty! In the next step, we’re going to take a closer look at some of the columns with missing values and try to figure out what might be going on with them.</p>
<p>Looking at the number of missing values in the <code>nfl_data</code> dataframe, we notice that the column <code>TimesSecs</code> has missing values in it. By looking at <a href="https://www.kaggle.com/maxhorowitz/nflplaybyplay2009to2016">the documentation</a>, we can see that this column has information on the number of seconds left in the game when the play was made. This means that these values are probably missing because <strong>they were not recorded</strong>, rather than because they don’t exist. So, it would make sense for us to try and guess what they should be rather than just leaving them as NA’s.</p>
<p>On the other hand, there are other fields, like <code>PenalizedTeam</code> that also have lot of missing fields. In this case, though, the field is missing because if there was no penalty then it doesn’t make sense to say <em>which</em> team was penalized. For this column, it would make more sense to either leave it empty or to add a third value like “neither” and use that to replace the NA’s.</p>
<p>We’ll cover some “quick and dirty” techniques that can help you with missing values but will probably also end up removing some useful information or adding some noise to your data.</p>
</section>
<section id="drop-missing-values" class="level3" data-number="4.3.3">
<h3 data-number="4.3.3" class="anchored" data-anchor-id="drop-missing-values"><span class="header-section-number">4.3.3</span> Drop missing values</h3>
<p>If you’re sure you want to drop rows with missing values, pandas does have a handy function, <code>dropna()</code> to help you do this. Let’s try it out on our NFL dataset!</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:998,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678158064,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="e2667ff6-98b9-49b2-d54c-aa172f21dbb4">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># remove all the rows that contain a missing value results in empty dataset</span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="co"># This is because every row in our dataset had at least one missing value. </span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="co"># We might have better luck removing all the columns that have at least one missing value instead.</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>nfl_data.dropna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">

  <div id="df-ecb2b572-7ea1-4bd6-8893-ce6eeebbd016">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">GameID</th>
<th data-quarto-table-cell-role="th">Drive</th>
<th data-quarto-table-cell-role="th">qtr</th>
<th data-quarto-table-cell-role="th">down</th>
<th data-quarto-table-cell-role="th">time</th>
<th data-quarto-table-cell-role="th">TimeUnder</th>
<th data-quarto-table-cell-role="th">TimeSecs</th>
<th data-quarto-table-cell-role="th">PlayTimeDiff</th>
<th data-quarto-table-cell-role="th">SideofField</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">yacEPA</th>
<th data-quarto-table-cell-role="th">Home_WP_pre</th>
<th data-quarto-table-cell-role="th">Away_WP_pre</th>
<th data-quarto-table-cell-role="th">Home_WP_post</th>
<th data-quarto-table-cell-role="th">Away_WP_post</th>
<th data-quarto-table-cell-role="th">Win_Prob</th>
<th data-quarto-table-cell-role="th">WPA</th>
<th data-quarto-table-cell-role="th">airWPA</th>
<th data-quarto-table-cell-role="th">yacWPA</th>
<th data-quarto-table-cell-role="th">Season</th>
</tr>
</thead>
<tbody>
</tbody>
</table>


<p>0 rows × 102 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-ecb2b572-7ea1-4bd6-8893-ce6eeebbd016')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-ecb2b572-7ea1-4bd6-8893-ce6eeebbd016 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-ecb2b572-7ea1-4bd6-8893-ce6eeebbd016');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1442,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678178636,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="0a4709d7-058b-4638-9063-5bf0fcd382cf">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># remove all columns with at least one missing value</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>columns_with_na_dropped <span class="op">=</span> nfl_data.dropna(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb17-3"><a href="#cb17-3"></a>columns_with_na_dropped.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">

  <div id="df-8170c25d-4cb2-45b0-994f-138b9152cd18">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">GameID</th>
<th data-quarto-table-cell-role="th">Drive</th>
<th data-quarto-table-cell-role="th">qtr</th>
<th data-quarto-table-cell-role="th">TimeUnder</th>
<th data-quarto-table-cell-role="th">ydstogo</th>
<th data-quarto-table-cell-role="th">ydsnet</th>
<th data-quarto-table-cell-role="th">PlayAttempted</th>
<th data-quarto-table-cell-role="th">Yards.Gained</th>
<th data-quarto-table-cell-role="th">sp</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Timeout_Indicator</th>
<th data-quarto-table-cell-role="th">Timeout_Team</th>
<th data-quarto-table-cell-role="th">posteam_timeouts_pre</th>
<th data-quarto-table-cell-role="th">HomeTimeouts_Remaining_Pre</th>
<th data-quarto-table-cell-role="th">AwayTimeouts_Remaining_Pre</th>
<th data-quarto-table-cell-role="th">HomeTimeouts_Remaining_Post</th>
<th data-quarto-table-cell-role="th">AwayTimeouts_Remaining_Post</th>
<th data-quarto-table-cell-role="th">ExPoint_Prob</th>
<th data-quarto-table-cell-role="th">TwoPoint_Prob</th>
<th data-quarto-table-cell-role="th">Season</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2009-09-10</td>
<td>2009091000</td>
<td>1</td>
<td>1</td>
<td>15</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>39</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>None</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>0.0</td>
<td>0.0</td>
<td>2009</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2009-09-10</td>
<td>2009091000</td>
<td>1</td>
<td>1</td>
<td>15</td>
<td>10</td>
<td>5</td>
<td>1</td>
<td>5</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>None</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>0.0</td>
<td>0.0</td>
<td>2009</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2009-09-10</td>
<td>2009091000</td>
<td>1</td>
<td>1</td>
<td>15</td>
<td>5</td>
<td>2</td>
<td>1</td>
<td>-3</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>None</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>0.0</td>
<td>0.0</td>
<td>2009</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2009-09-10</td>
<td>2009091000</td>
<td>1</td>
<td>1</td>
<td>14</td>
<td>8</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>None</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>0.0</td>
<td>0.0</td>
<td>2009</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2009-09-10</td>
<td>2009091000</td>
<td>1</td>
<td>1</td>
<td>14</td>
<td>8</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>None</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>0.0</td>
<td>0.0</td>
<td>2009</td>
</tr>
</tbody>
</table>


<p>5 rows × 41 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-8170c25d-4cb2-45b0-994f-138b9152cd18')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-8170c25d-4cb2-45b0-994f-138b9152cd18 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-8170c25d-4cb2-45b0-994f-138b9152cd18');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:261,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678185820,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="2973aec0-a86e-4f83-d3d6-2203bd9724b1">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># just how much data did we lose?</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="bu">print</span>(<span class="st">"Columns in original dataset: </span><span class="sc">%d</span><span class="st"> </span><span class="ch">\n</span><span class="st">"</span> <span class="op">%</span> nfl_data.shape[<span class="dv">1</span>])</span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="bu">print</span>(<span class="st">"Columns with na's dropped: </span><span class="sc">%d</span><span class="st">"</span> <span class="op">%</span> columns_with_na_dropped.shape[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Columns in original dataset: 102 

Columns with na's dropped: 41</code></pre>
</div>
</div>
<p>Notice that this can drop a lot of data that you might want to keep, particularly in smaller datasets. What if you just want to drop rows or columns that contain several or even just all null values? You specify those setting in dropna with the <code>how</code> and <code>thresh</code> parameters.</p>
<p>By default, <code>how='any'</code>. You could alternatively specify <code>how='all'</code> so as to <strong>drop only rows or columns that contain all null values</strong>. The <code>thresh</code>parameter gives you finer-grained control: you set the number of non-null values that a row or column needs to have in order to be kept.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:286,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678214325,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="6c68f4b6-cd98-49e4-9603-dccdba761c4a">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a>df1 <span class="op">=</span> pd.DataFrame([[ <span class="dv">1</span>, np.nan, <span class="dv">7</span>], </span>
<span id="cb20-2"><a href="#cb20-2"></a>                    [ <span class="dv">2</span>,  <span class="dv">5</span>,  <span class="dv">8</span>], </span>
<span id="cb20-3"><a href="#cb20-3"></a>                    [ np.nan, <span class="dv">6</span>, <span class="dv">9</span>]])</span>
<span id="cb20-4"><a href="#cb20-4"></a>df1[<span class="dv">3</span>] <span class="op">=</span> np.nan</span>
<span id="cb20-5"><a href="#cb20-5"></a>df1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">

  <div id="df-24608920-e3e7-41fb-8381-0363ec81ccae">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>NaN</td>
<td>7</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2.0</td>
<td>5.0</td>
<td>8</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
<td>6.0</td>
<td>9</td>
<td>NaN</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-24608920-e3e7-41fb-8381-0363ec81ccae')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-24608920-e3e7-41fb-8381-0363ec81ccae button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-24608920-e3e7-41fb-8381-0363ec81ccae');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:343,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678228178,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="f1fd53c0-c94b-4e69-dc20-6369d756390f">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># the `thresh` parameter specifies the minimum number of non-null values required in a row or column for it to be retained.</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>df1.dropna(thresh<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">

  <div id="df-f2f2eed0-e331-47ff-948c-1b084b4272e9">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2.0</td>
<td>5.0</td>
<td>8</td>
<td>NaN</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-f2f2eed0-e331-47ff-948c-1b084b4272e9')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-f2f2eed0-e331-47ff-948c-1b084b4272e9 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-f2f2eed0-e331-47ff-948c-1b084b4272e9');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<p>Here, the first and last row have been dropped, because they contain only two non-null values.</p>
</section>
<section id="filling-in-missing-values-automatically" class="level3" data-number="4.3.4">
<h3 data-number="4.3.4" class="anchored" data-anchor-id="filling-in-missing-values-automatically"><span class="header-section-number">4.3.4</span> Filling in missing values automatically</h3>
<p>Depending on your dataset, it can sometimes make more sense to fill null values with valid ones rather than drop them. Pandas provides <code>fillna()</code>, which returns a copy of the <code>Series</code> or <code>DataFrame</code> with the missing values replaced with one of your choosing.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:276,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678273121,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="7e98572f-d512-4738-b784-edd8b83cad05">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># You can fill all of the null entries with a single value, such as -9999:</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>df1.fillna(<span class="op">-</span><span class="dv">9999</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">

  <div id="df-91cb42a2-eb5d-4f67-a9b3-5de71c41fac7">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>-9999.0</td>
<td>7</td>
<td>-9999.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2.0</td>
<td>5.0</td>
<td>8</td>
<td>-9999.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>-9999.0</td>
<td>6.0</td>
<td>9</td>
<td>-9999.0</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-91cb42a2-eb5d-4f67-a9b3-5de71c41fac7')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-91cb42a2-eb5d-4f67-a9b3-5de71c41fac7 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-91cb42a2-eb5d-4f67-a9b3-5de71c41fac7');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<p>We could also replace missing values with whatever value comes directly after/before it in the same column. (This makes a lot of sense for datasets where the observations have some sort of logical order to them.)</p>
<p>You can forward-fill null values, which is to use the last valid value to fill a null:</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:303,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678298317,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="28dc1d08-fcfb-4144-dda9-e10259b79e1e">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a>df1.fillna(method<span class="op">=</span><span class="st">'ffill'</span>, axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">

  <div id="df-1d02b083-74fc-4a08-b35f-a84453b32486">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>NaN</td>
<td>7</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2.0</td>
<td>5.0</td>
<td>8</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2.0</td>
<td>6.0</td>
<td>9</td>
<td>NaN</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-1d02b083-74fc-4a08-b35f-a84453b32486')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-1d02b083-74fc-4a08-b35f-a84453b32486 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-1d02b083-74fc-4a08-b35f-a84453b32486');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<p>Backward-fill to propagate the next valid value backward to fill a null:</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:260,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678318176,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="42f01a63-fdb3-4986-f29f-4695c5400773">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a>df1.fillna(method<span class="op">=</span><span class="st">'bfill'</span>, axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">

  <div id="df-77027e0d-8cda-433f-a59f-a735b7bdf17c">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>5.0</td>
<td>7</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2.0</td>
<td>5.0</td>
<td>8</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
<td>6.0</td>
<td>9</td>
<td>NaN</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-77027e0d-8cda-433f-a59f-a735b7bdf17c')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-77027e0d-8cda-433f-a59f-a735b7bdf17c button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-77027e0d-8cda-433f-a59f-a735b7bdf17c');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<p>Notice that when a previous/next value is not available for forward/backward-filling, the null value remains.</p>
</section>
<section id="imputation-of-missing-value" class="level3" data-number="4.3.5">
<h3 data-number="4.3.5" class="anchored" data-anchor-id="imputation-of-missing-value"><span class="header-section-number">4.3.5</span> Imputation of missing value</h3>
<section id="univariate-feature-imputation" class="level4" data-number="4.3.5.1">
<h4 data-number="4.3.5.1" class="anchored" data-anchor-id="univariate-feature-imputation"><span class="header-section-number">4.3.5.1</span> Univariate feature imputation</h4>
<p>The <code>SimpleImputer</code> class provides basic strategies for imputing missing values. Missing values can be imputed with a provided constant value, or using the statistics (mean, median or most frequent) of each column in which the missing values are located. This class also allows for different missing values encodings.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:269,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678346080,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="88b94f7a-d6cd-4420-fed1-224ff549da6a">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1"></a>df2 <span class="op">=</span> pd.DataFrame([[<span class="dv">1</span>, <span class="dv">2</span>], [np.nan, <span class="dv">3</span>], [<span class="dv">7</span>, <span class="dv">6</span>]])</span>
<span id="cb25-2"><a href="#cb25-2"></a>df2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">

  <div id="df-9a649978-38dd-4e94-a126-eb375d2f872b">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>NaN</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7.0</td>
<td>6</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-9a649978-38dd-4e94-a126-eb375d2f872b')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-9a649978-38dd-4e94-a126-eb375d2f872b button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-9a649978-38dd-4e94-a126-eb375d2f872b');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<p>The following snippet demonstrates how to replace missing values, encoded as <code>np.nan</code>, using the mean value of the columns that contain the missing values:</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:278,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678375751,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="b09b09d5-db20-4931-ff08-644bb349a87f">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a>imp <span class="op">=</span> SimpleImputer(missing_values<span class="op">=</span>np.nan, strategy<span class="op">=</span><span class="st">'mean'</span>)</span>
<span id="cb26-2"><a href="#cb26-2"></a>imp.fit_transform(df2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>array([[1., 2.],
       [4., 3.],
       [7., 6.]])</code></pre>
</div>
</div>
<p>The <code>SimpleImputer</code> class also supports categorical data represented as string values or pandas categoricals when using the <code>most_frequent</code> or <code>constant</code> strategy:</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:283,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678397661,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="128d746a-96ad-4bf1-8c39-eba91c77b65e">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a>df2 <span class="op">=</span> pd.DataFrame([[<span class="st">"a"</span>, <span class="st">"x"</span>],</span>
<span id="cb28-2"><a href="#cb28-2"></a>                    [np.nan, <span class="st">"y"</span>],</span>
<span id="cb28-3"><a href="#cb28-3"></a>                    [<span class="st">"a"</span>, np.nan],</span>
<span id="cb28-4"><a href="#cb28-4"></a>                    [<span class="st">"b"</span>, <span class="st">"y"</span>]], </span>
<span id="cb28-5"><a href="#cb28-5"></a>                   dtype<span class="op">=</span><span class="st">"category"</span>)</span>
<span id="cb28-6"><a href="#cb28-6"></a>df2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">

  <div id="df-82416723-cd66-4ca5-a5c5-091f6b2ad062">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>a</td>
<td>x</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>NaN</td>
<td>y</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>a</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>b</td>
<td>y</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-82416723-cd66-4ca5-a5c5-091f6b2ad062')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-82416723-cd66-4ca5-a5c5-091f6b2ad062 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-82416723-cd66-4ca5-a5c5-091f6b2ad062');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:266,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678410361,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="9a69815c-5b73-42f9-8d3a-530be94f671c">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a>imp <span class="op">=</span> SimpleImputer(strategy<span class="op">=</span><span class="st">"most_frequent"</span>)</span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="bu">print</span>(imp.fit_transform(df2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[['a' 'x']
 ['a' 'y']
 ['a' 'y']
 ['b' 'y']]</code></pre>
</div>
</div>
</section>
<section id="multivariate-feature-imputation" class="level4" data-number="4.3.5.2">
<h4 data-number="4.3.5.2" class="anchored" data-anchor-id="multivariate-feature-imputation"><span class="header-section-number">4.3.5.2</span> Multivariate feature imputation</h4>
<p>A more sophisticated approach is to use the <code>IterativeImputer</code> class, which models each feature with missing values as a function of other features, and uses that estimate for imputation.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:266,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678452550,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="5110a165-bca6-40eb-a1fe-7689ba032aaa">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a>imp <span class="op">=</span> IterativeImputer(max_iter<span class="op">=</span><span class="dv">10</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="co"># the model learns that the second feature is double of the first</span></span>
<span id="cb31-3"><a href="#cb31-3"></a>imp.fit_transform([[<span class="dv">1</span>, <span class="dv">2</span>], [<span class="dv">3</span>, <span class="dv">6</span>], [<span class="dv">4</span>, <span class="dv">8</span>], [np.nan, <span class="dv">3</span>], [<span class="dv">7</span>, np.nan]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>array([[ 1.        ,  2.        ],
       [ 3.        ,  6.        ],
       [ 4.        ,  8.        ],
       [ 1.50004509,  3.        ],
       [ 7.        , 14.00004135]])</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:264,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678492552,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="565b336b-fb67-4b23-ee29-753ce0de1f03">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a> <span class="co"># You can also use other regressor as well (default is BayesianRidge())</span></span>
<span id="cb33-2"><a href="#cb33-2"></a> est <span class="op">=</span> ExtraTreesRegressor(n_estimators<span class="op">=</span><span class="dv">10</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3"></a> imp <span class="op">=</span> IterativeImputer(max_iter<span class="op">=</span><span class="dv">10</span>, random_state<span class="op">=</span><span class="dv">0</span>, estimator<span class="op">=</span>est)</span>
<span id="cb33-4"><a href="#cb33-4"></a> imp.fit_transform([[<span class="dv">1</span>, <span class="dv">2</span>], [<span class="dv">3</span>, <span class="dv">6</span>], [<span class="dv">4</span>, <span class="dv">8</span>], [np.nan, <span class="dv">3</span>], [<span class="dv">7</span>, np.nan]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>array([[1. , 2. ],
       [3. , 6. ],
       [4. , 8. ],
       [1.6, 3. ],
       [7. , 8. ]])</code></pre>
</div>
</div>
<p>The <code>KNNImputer</code> class provides imputation for filling in missing values using the k-Nearest Neighbors approach. By default, a euclidean distance metric that supports missing values, <code>nan_euclidean_distances</code>, is used to find the nearest neighbors. Each missing feature is imputed using values from <code>n_neighbors</code> nearest neighbors that have a value for the feature. The feature of the neighbors are averaged uniformly or weighted by distance to each neighbor.</p>
<p>The following snippet demonstrates how to replace missing values, encoded as <code>np.nan</code>, using the mean feature value of the two nearest neighbors of samples with missing values:</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:264,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678511053,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="4481eb90-4bdb-4c2f-8781-f7fb2c9db60b">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a>X <span class="op">=</span> [[<span class="dv">1</span>, <span class="dv">2</span>, np.nan], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>], [np.nan, <span class="dv">6</span>, <span class="dv">5</span>], [<span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">7</span>]]</span>
<span id="cb35-2"><a href="#cb35-2"></a>imputer <span class="op">=</span> KNNImputer(n_neighbors<span class="op">=</span><span class="dv">2</span>, weights<span class="op">=</span><span class="st">"uniform"</span>)</span>
<span id="cb35-3"><a href="#cb35-3"></a>imputer.fit_transform(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>array([[1. , 2. , 4. ],
       [3. , 4. , 3. ],
       [5.5, 6. , 5. ],
       [8. , 8. , 7. ]])</code></pre>
</div>
</div>
<p>if you wishes to apply matrix completion to your data, you can use functions from <a href="https://github.com/iskandr/fancyimpute"><code>fancyimpute</code></a></p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:283,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678601117,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="3f94aca0-986f-4144-de69-ad8ec15d2ee8">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1"></a>SoftImpute().fit_transform(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[SoftImpute] Max Singular Value of X_init = 16.044670
[SoftImpute] Iter 1: observed MAE=0.129498 rank=3
[SoftImpute] Iter 2: observed MAE=0.129346 rank=3
[SoftImpute] Iter 3: observed MAE=0.129795 rank=3
[SoftImpute] Iter 4: observed MAE=0.131896 rank=3
[SoftImpute] Iter 5: observed MAE=0.134509 rank=3
[SoftImpute] Iter 6: observed MAE=0.137663 rank=3
[SoftImpute] Iter 7: observed MAE=0.141068 rank=3
[SoftImpute] Iter 8: observed MAE=0.143794 rank=3
[SoftImpute] Iter 9: observed MAE=0.145304 rank=3
[SoftImpute] Iter 10: observed MAE=0.145850 rank=3
[SoftImpute] Iter 11: observed MAE=0.145866 rank=3
[SoftImpute] Iter 12: observed MAE=0.145914 rank=3
[SoftImpute] Iter 13: observed MAE=0.146068 rank=3
[SoftImpute] Iter 14: observed MAE=0.146126 rank=2
[SoftImpute] Iter 15: observed MAE=0.146125 rank=2
[SoftImpute] Iter 16: observed MAE=0.146132 rank=2
[SoftImpute] Iter 17: observed MAE=0.146126 rank=2
[SoftImpute] Iter 18: observed MAE=0.146092 rank=2
[SoftImpute] Iter 19: observed MAE=0.146022 rank=2
[SoftImpute] Iter 20: observed MAE=0.145907 rank=2
[SoftImpute] Iter 21: observed MAE=0.145740 rank=2
[SoftImpute] Iter 22: observed MAE=0.145510 rank=2
[SoftImpute] Iter 23: observed MAE=0.145209 rank=2
[SoftImpute] Iter 24: observed MAE=0.144824 rank=2
[SoftImpute] Iter 25: observed MAE=0.144345 rank=2
[SoftImpute] Iter 26: observed MAE=0.143761 rank=2
[SoftImpute] Iter 27: observed MAE=0.143059 rank=2
[SoftImpute] Iter 28: observed MAE=0.142233 rank=2
[SoftImpute] Iter 29: observed MAE=0.141275 rank=2
[SoftImpute] Iter 30: observed MAE=0.140185 rank=2
[SoftImpute] Iter 31: observed MAE=0.138969 rank=2
[SoftImpute] Iter 32: observed MAE=0.137638 rank=2
[SoftImpute] Iter 33: observed MAE=0.136213 rank=2
[SoftImpute] Iter 34: observed MAE=0.134720 rank=2
[SoftImpute] Iter 35: observed MAE=0.133194 rank=2
[SoftImpute] Iter 36: observed MAE=0.131669 rank=2
[SoftImpute] Iter 37: observed MAE=0.130180 rank=2
[SoftImpute] Iter 38: observed MAE=0.129421 rank=2
[SoftImpute] Iter 39: observed MAE=0.128890 rank=2
[SoftImpute] Iter 40: observed MAE=0.128397 rank=2
[SoftImpute] Iter 41: observed MAE=0.127946 rank=2
[SoftImpute] Iter 42: observed MAE=0.127542 rank=2
[SoftImpute] Iter 43: observed MAE=0.127185 rank=2
[SoftImpute] Iter 44: observed MAE=0.126874 rank=2
[SoftImpute] Iter 45: observed MAE=0.126605 rank=2
[SoftImpute] Iter 46: observed MAE=0.126375 rank=2
[SoftImpute] Iter 47: observed MAE=0.126180 rank=2
[SoftImpute] Iter 48: observed MAE=0.126016 rank=2
[SoftImpute] Iter 49: observed MAE=0.125878 rank=2
[SoftImpute] Iter 50: observed MAE=0.125763 rank=2
[SoftImpute] Iter 51: observed MAE=0.125668 rank=2
[SoftImpute] Stopped after iteration 51 for lambda=0.320893</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>array([[1.        , 2.        , 1.29115131],
       [3.        , 4.        , 3.        ],
       [5.10495139, 6.        , 5.        ],
       [8.        , 8.        , 7.        ]])</code></pre>
</div>
</div>
<p>For more information, please refer to https://github.com/iskandr/fancyimpute or https://scikit-learn.org/stable/modules/classes.html#module-sklearn.impute.</p>
</section>
</section>
</section>
<section id="other-data-cleaning-problem" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="other-data-cleaning-problem"><span class="header-section-number">4.4</span> Other data cleaning problem</h2>
<section id="duplicate-data-entry" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="duplicate-data-entry"><span class="header-section-number">4.4.1</span> Duplicate data entry</h3>
<p>In addition to missing data, you will often encounter duplicated data in real-world datasets. Fortunately, <code>pandas</code> provides an easy means of detecting and removing duplicate entries.</p>
<p>You can easily spot duplicate values using the <code>duplicated()</code> method in <code>pandas</code>, which returns a Boolean mask indicating whether an entry in a DataFrame is a duplicate of an earlier one. Let’s create another example <code>DataFrame</code> to see this in action.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:286,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678642594,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="48db6e0c-02eb-41c9-84b3-c965c67b9b8a">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1"></a>df3 <span class="op">=</span> pd.DataFrame({<span class="st">'letters'</span>: [<span class="st">'A'</span>,<span class="st">'B'</span>] <span class="op">*</span> <span class="dv">2</span> <span class="op">+</span> [<span class="st">'B'</span>],</span>
<span id="cb40-2"><a href="#cb40-2"></a>                    <span class="st">'numbers'</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>]})</span>
<span id="cb40-3"><a href="#cb40-3"></a>df3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">

  <div id="df-d49ee1eb-2a7f-4091-8f76-4a4026e0a44f">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">letters</th>
<th data-quarto-table-cell-role="th">numbers</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>B</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>A</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>B</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>B</td>
<td>3</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-d49ee1eb-2a7f-4091-8f76-4a4026e0a44f')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-d49ee1eb-2a7f-4091-8f76-4a4026e0a44f button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-d49ee1eb-2a7f-4091-8f76-4a4026e0a44f');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:287,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678656573,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="81e94277-dc55-445a-807b-a6b22d010b2d">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1"></a>df3.duplicated()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>0    False
1    False
2     True
3    False
4     True
dtype: bool</code></pre>
</div>
</div>
<p><code>drop_duplicates()</code> will simply returns a copy of the data for which all of the duplicated values are False:</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:280,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678674468,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="eec889ed-5f88-4ab2-a76f-71be356c877c">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1"></a>df3.drop_duplicates()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">

  <div id="df-892d9cec-a640-4172-9427-6e02904c2b85">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">letters</th>
<th data-quarto-table-cell-role="th">numbers</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>B</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>B</td>
<td>3</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-892d9cec-a640-4172-9427-6e02904c2b85')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-892d9cec-a640-4172-9427-6e02904c2b85 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-892d9cec-a640-4172-9427-6e02904c2b85');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<p>Both <code>duplicated()</code> and <code>drop_duplicates()</code> default to consider all columns but you can specify that they examine only a subset of columns in your DataFrame:</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:276,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678695603,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="2cee7caa-6b4a-40f9-ab79-736fc85a207c">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1"></a>df3.drop_duplicates([<span class="st">'letters'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">

  <div id="df-d7f343c5-20e7-4cf8-8b57-6f283d297e60">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">letters</th>
<th data-quarto-table-cell-role="th">numbers</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>B</td>
<td>2</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-d7f343c5-20e7-4cf8-8b57-6f283d297e60')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-d7f343c5-20e7-4cf8-8b57-6f283d297e60 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-d7f343c5-20e7-4cf8-8b57-6f283d297e60');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
</section>
<section id="inconsistent-data-entry" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="inconsistent-data-entry"><span class="header-section-number">4.4.2</span> Inconsistent data entry</h3>
<p>We will use the dataset that is modified from https://www.kaggle.com/datasets/zusmani/pakistanintellectualcapitalcs.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1201,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678704614,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="a4581b7b-9985-46f6-c5e4-7d8e535b0b82">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1"></a><span class="op">!</span>kaggle datasets download <span class="op">-</span>d alexisbcook<span class="op">/</span>pakistan<span class="op">-</span>intellectual<span class="op">-</span>capital</span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="op">!</span>unzip <span class="op">-</span>qq pakistan<span class="op">-</span>intellectual<span class="op">-</span>capital.<span class="bu">zip</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Downloading pakistan-intellectual-capital.zip to /content
  0% 0.00/47.8k [00:00&lt;?, ?B/s]
100% 47.8k/47.8k [00:00&lt;00:00, 25.0MB/s]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1"></a><span class="co"># read in all our data</span></span>
<span id="cb47-2"><a href="#cb47-2"></a>professors <span class="op">=</span> pd.read_csv(<span class="st">"pakistan_intellectual_capital.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:289,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678714659,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="410ce7f9-f5de-4544-eafd-6543038edd3a">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1"></a>professors.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">

  <div id="df-da810ac5-745e-4985-be89-365a8c6f5e0a">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Unnamed: 0</th>
<th data-quarto-table-cell-role="th">S#</th>
<th data-quarto-table-cell-role="th">Teacher Name</th>
<th data-quarto-table-cell-role="th">University Currently Teaching</th>
<th data-quarto-table-cell-role="th">Department</th>
<th data-quarto-table-cell-role="th">Province University Located</th>
<th data-quarto-table-cell-role="th">Designation</th>
<th data-quarto-table-cell-role="th">Terminal Degree</th>
<th data-quarto-table-cell-role="th">Graduated from</th>
<th data-quarto-table-cell-role="th">Country</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Area of Specialization/Research Interests</th>
<th data-quarto-table-cell-role="th">Other Information</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2</td>
<td>3</td>
<td>Dr. Abdul Basit</td>
<td>University of Balochistan</td>
<td>Computer Science &amp; IT</td>
<td>Balochistan</td>
<td>Assistant Professor</td>
<td>PhD</td>
<td>Asian Institute of Technology</td>
<td>Thailand</td>
<td>NaN</td>
<td>Software Engineering &amp; DBMS</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>4</td>
<td>5</td>
<td>Dr. Waheed Noor</td>
<td>University of Balochistan</td>
<td>Computer Science &amp; IT</td>
<td>Balochistan</td>
<td>Assistant Professor</td>
<td>PhD</td>
<td>Asian Institute of Technology</td>
<td>Thailand</td>
<td>NaN</td>
<td>DBMS</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>5</td>
<td>6</td>
<td>Dr. Junaid Baber</td>
<td>University of Balochistan</td>
<td>Computer Science &amp; IT</td>
<td>Balochistan</td>
<td>Assistant Professor</td>
<td>PhD</td>
<td>Asian Institute of Technology</td>
<td>Thailand</td>
<td>NaN</td>
<td>Information processing, Multimedia mining</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>6</td>
<td>7</td>
<td>Dr. Maheen Bakhtyar</td>
<td>University of Balochistan</td>
<td>Computer Science &amp; IT</td>
<td>Balochistan</td>
<td>Assistant Professor</td>
<td>PhD</td>
<td>Asian Institute of Technology</td>
<td>Thailand</td>
<td>NaN</td>
<td>NLP, Information Retrieval, Question Answering...</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>24</td>
<td>25</td>
<td>Samina Azim</td>
<td>Sardar Bahadur Khan Women's University</td>
<td>Computer Science</td>
<td>Balochistan</td>
<td>Lecturer</td>
<td>BS</td>
<td>Balochistan University of Information Technolo...</td>
<td>Pakistan</td>
<td>2005.0</td>
<td>VLSI Electronics DLD Database</td>
<td>NaN</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-da810ac5-745e-4985-be89-365a8c6f5e0a')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-da810ac5-745e-4985-be89-365a8c6f5e0a button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-da810ac5-745e-4985-be89-365a8c6f5e0a');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<p>Say we’re interested in cleaning up the <code>Country</code> column to make sure there’s no data entry inconsistencies in it. We could go through and check each row by hand, of course, and hand-correct inconsistencies when we find them. There’s a more efficient way to do this, though!</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:263,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678737430,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="2a821932-68bc-4854-8a5e-103a9ae74720">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1"></a><span class="co"># get all the unique values in the 'Country' column</span></span>
<span id="cb49-2"><a href="#cb49-2"></a>countries <span class="op">=</span> professors[<span class="st">'Country'</span>].unique()</span>
<span id="cb49-3"><a href="#cb49-3"></a></span>
<span id="cb49-4"><a href="#cb49-4"></a><span class="co"># sort them and then take a closer look</span></span>
<span id="cb49-5"><a href="#cb49-5"></a>countries.sort()</span>
<span id="cb49-6"><a href="#cb49-6"></a>countries</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>array([' Germany', ' New Zealand', ' Sweden', ' USA', 'Australia',
       'Austria', 'Canada', 'China', 'Finland', 'France', 'Greece',
       'HongKong', 'Ireland', 'Italy', 'Japan', 'Macau', 'Malaysia',
       'Mauritius', 'Netherland', 'New Zealand', 'Norway', 'Pakistan',
       'Portugal', 'Russian Federation', 'Saudi Arabia', 'Scotland',
       'Singapore', 'South Korea', 'SouthKorea', 'Spain', 'Sweden',
       'Thailand', 'Turkey', 'UK', 'USA', 'USofA', 'Urbana', 'germany'],
      dtype=object)</code></pre>
</div>
</div>
<p>Just looking at this, we can see some problems due to inconsistent data entry: ’ Germany’, and ‘germany’, for example, or ’ New Zealand’ (start wirh whitespace) and ‘New Zealand’.</p>
<p>The first thing we are going to do is make everything lower case (we can change it back at the end if we like) and remove any white spaces at the beginning and end of cells. <strong>Inconsistencies in capitalizations and trailing white spaces are very common in text data and you can fix a good 80% of your text data entry inconsistencies by doing this.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1"></a><span class="co"># convert to lower case</span></span>
<span id="cb51-2"><a href="#cb51-2"></a>professors[<span class="st">'Country'</span>] <span class="op">=</span> professors[<span class="st">'Country'</span>].<span class="bu">str</span>.lower()</span>
<span id="cb51-3"><a href="#cb51-3"></a><span class="co"># remove trailing white spaces</span></span>
<span id="cb51-4"><a href="#cb51-4"></a>professors[<span class="st">'Country'</span>] <span class="op">=</span> professors[<span class="st">'Country'</span>].<span class="bu">str</span>.strip()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that <code>.str()</code> provide vectorized method for columns. See https://realpython.com/python-data-cleaning-numpy-pandas/#tidying-up-fields-in-the-data for more details.</p>
<section id="use-fuzzy-matching-to-correct-inconsistent-data-entry" class="level4" data-number="4.4.2.1">
<h4 data-number="4.4.2.1" class="anchored" data-anchor-id="use-fuzzy-matching-to-correct-inconsistent-data-entry"><span class="header-section-number">4.4.2.1</span> Use fuzzy matching to correct inconsistent data entry</h4>
<p>Alright, let’s take another look at the <code>Country</code> column and see if there’s any more data cleaning we need to do</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:372,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678826606,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="f2c5fdba-0225-4273-e84c-943507c7eb1b">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1"></a><span class="co"># get all the unique values in the 'Country' column</span></span>
<span id="cb52-2"><a href="#cb52-2"></a>countries <span class="op">=</span> professors[<span class="st">'Country'</span>].unique()</span>
<span id="cb52-3"><a href="#cb52-3"></a></span>
<span id="cb52-4"><a href="#cb52-4"></a><span class="co"># sort them and then take a closer look</span></span>
<span id="cb52-5"><a href="#cb52-5"></a>countries.sort()</span>
<span id="cb52-6"><a href="#cb52-6"></a>countries</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>array(['australia', 'austria', 'canada', 'china', 'finland', 'france',
       'germany', 'greece', 'hongkong', 'ireland', 'italy', 'japan',
       'macau', 'malaysia', 'mauritius', 'netherland', 'new zealand',
       'norway', 'pakistan', 'portugal', 'russian federation',
       'saudi arabia', 'scotland', 'singapore', 'south korea',
       'southkorea', 'spain', 'sweden', 'thailand', 'turkey', 'uk',
       'urbana', 'usa', 'usofa'], dtype=object)</code></pre>
</div>
</div>
<p>It does look like there is another inconsistency: ‘southkorea’ and ‘south korea’ should be the same. We’re going to use the <a href="https://github.com/seatgeek/thefuzz"><code>thefuzz</code></a> package to help identify which strings are closest to each other. This dataset is small enough that we could probably correct errors by hand, but that approach doesn’t scale well. (Would you want to correct a thousand errors by hand? What about ten thousand? Automating things as early as possible is generally a good idea!)</p>
<p><code>thefuzz</code> returns a ratio given two strings. The closer the ratio is to 100, the smaller the edit distance between the two strings. Here, we’re going to get the ten strings from our list of cities that have the closest distance to “south korea”</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:282,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678884471,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="d99b09d6-27f8-4026-8ea2-5e620e5b0802">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1"></a><span class="co"># get the top 10 closest matches to "south korea"</span></span>
<span id="cb54-2"><a href="#cb54-2"></a>matches <span class="op">=</span> process.extract(<span class="st">"south korea"</span>, countries, limit<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb54-3"><a href="#cb54-3"></a></span>
<span id="cb54-4"><a href="#cb54-4"></a><span class="co"># take a look at them</span></span>
<span id="cb54-5"><a href="#cb54-5"></a>matches</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>[('south korea', 100),
 ('southkorea', 95),
 ('ireland', 50),
 ('norway', 50),
 ('uk', 45),
 ('austria', 44),
 ('saudi arabia', 43),
 ('scotland', 42),
 ('australia', 40),
 ('france', 40)]</code></pre>
</div>
</div>
<p>We can see that two of the items in the cities are very close to “south korea”: “south korea” and “southkorea”. Let’s replace all rows in our “Country” column that have a score &gt; 90 with “south korea”.</p>
<p>To do this, we are going to write a function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1"></a><span class="co"># function to replace rows in the provided column of the provided dataframe</span></span>
<span id="cb56-2"><a href="#cb56-2"></a><span class="co"># that match the provided string above the provided ratio with the provided string</span></span>
<span id="cb56-3"><a href="#cb56-3"></a><span class="kw">def</span> replace_matches_in_column(df, column, string_to_match, min_ratio <span class="op">=</span> <span class="dv">90</span>):</span>
<span id="cb56-4"><a href="#cb56-4"></a>    <span class="co"># get a list of unique strings</span></span>
<span id="cb56-5"><a href="#cb56-5"></a>    strings <span class="op">=</span> df[column].unique()</span>
<span id="cb56-6"><a href="#cb56-6"></a>    </span>
<span id="cb56-7"><a href="#cb56-7"></a>    <span class="co"># get the top 10 closest matches to our input string</span></span>
<span id="cb56-8"><a href="#cb56-8"></a>    matches <span class="op">=</span> process.extract(string_to_match, strings, limit<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb56-9"><a href="#cb56-9"></a></span>
<span id="cb56-10"><a href="#cb56-10"></a>    <span class="co"># only get matches with a ratio &gt; 90</span></span>
<span id="cb56-11"><a href="#cb56-11"></a>    close_matches <span class="op">=</span> [matches[<span class="dv">0</span>] <span class="cf">for</span> matches <span class="kw">in</span> matches <span class="cf">if</span> matches[<span class="dv">1</span>] <span class="op">&gt;=</span> min_ratio]</span>
<span id="cb56-12"><a href="#cb56-12"></a></span>
<span id="cb56-13"><a href="#cb56-13"></a>    <span class="co"># get the rows of all the close matches in our dataframe</span></span>
<span id="cb56-14"><a href="#cb56-14"></a>    rows_with_matches <span class="op">=</span> df[column].isin(close_matches)</span>
<span id="cb56-15"><a href="#cb56-15"></a></span>
<span id="cb56-16"><a href="#cb56-16"></a>    <span class="co"># replace all rows with close matches with the input matches </span></span>
<span id="cb56-17"><a href="#cb56-17"></a>    df.loc[rows_with_matches, column] <span class="op">=</span> string_to_match</span>
<span id="cb56-18"><a href="#cb56-18"></a>    </span>
<span id="cb56-19"><a href="#cb56-19"></a>    <span class="co"># let us know the function's done</span></span>
<span id="cb56-20"><a href="#cb56-20"></a>    <span class="bu">print</span>(<span class="st">"All done!"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we have a function, we can put it to the test!</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:414,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678917417,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="c3555811-a4fb-42dd-a36c-2361d56d3cbb">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1"></a><span class="co"># use the function we just wrote to replace close matches to "south korea" with "south korea"</span></span>
<span id="cb57-2"><a href="#cb57-2"></a>replace_matches_in_column(df<span class="op">=</span>professors, column<span class="op">=</span><span class="st">'Country'</span>, string_to_match<span class="op">=</span><span class="st">"south korea"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>All done!</code></pre>
</div>
</div>
<p>And now let’s check the unique values in our “Country” column again and make sure we’ve tidied up “south korea” correctly.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:267,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678922077,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="c4d9eee2-98f5-4ac5-8079-c233744ff932">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1"></a><span class="co"># get all the unique values in the 'Country' column</span></span>
<span id="cb59-2"><a href="#cb59-2"></a>countries <span class="op">=</span> professors[<span class="st">'Country'</span>].unique()</span>
<span id="cb59-3"><a href="#cb59-3"></a></span>
<span id="cb59-4"><a href="#cb59-4"></a><span class="co"># sort them alphabetically and then take a closer look</span></span>
<span id="cb59-5"><a href="#cb59-5"></a>countries.sort()</span>
<span id="cb59-6"><a href="#cb59-6"></a>countries</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>array(['australia', 'austria', 'canada', 'china', 'finland', 'france',
       'germany', 'greece', 'hongkong', 'ireland', 'italy', 'japan',
       'macau', 'malaysia', 'mauritius', 'netherland', 'new zealand',
       'norway', 'pakistan', 'portugal', 'russian federation',
       'saudi arabia', 'scotland', 'singapore', 'south korea', 'spain',
       'sweden', 'thailand', 'turkey', 'uk', 'urbana', 'usa', 'usofa'],
      dtype=object)</code></pre>
</div>
</div>
<p>Now we only have “south korea” in our dataframe and we didn’t have to change anything by hand.</p>
</section>
</section>
<section id="character-encoding" class="level3" data-number="4.4.3">
<h3 data-number="4.4.3" class="anchored" data-anchor-id="character-encoding"><span class="header-section-number">4.4.3</span> Character encoding</h3>
<p>There are two main data types you’ll encounter when working with text in Python 3. One is is the <code>string</code>, which is what text is by default.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:280,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678954167,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="a6e81e3d-9783-41a6-b99a-f80c5f18ea99">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1"></a><span class="co"># start with a string</span></span>
<span id="cb61-2"><a href="#cb61-2"></a>before <span class="op">=</span> <span class="st">"This is the euro symbol: €"</span></span>
<span id="cb61-3"><a href="#cb61-3"></a></span>
<span id="cb61-4"><a href="#cb61-4"></a><span class="co"># check to see what datatype it is</span></span>
<span id="cb61-5"><a href="#cb61-5"></a><span class="bu">type</span>(before)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>str</code></pre>
</div>
</div>
<p>The other data is the <a href="https://docs.python.org/3/library/stdtypes.html#binary-sequence-types-bytes-bytearray-memoryview">bytes</a> data type, which is a sequence of integers. You can convert a <code>string</code> into <code>bytes</code> by specifying which encoding it’s in:</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:258,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678971381,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="5df98627-b96c-4e68-f516-dcf643ffec49">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1"></a><span class="co"># encode it to a different encoding, replacing characters that raise errors</span></span>
<span id="cb63-2"><a href="#cb63-2"></a>after <span class="op">=</span> before.encode(<span class="st">"utf-8"</span>, errors<span class="op">=</span><span class="st">"replace"</span>)</span>
<span id="cb63-3"><a href="#cb63-3"></a></span>
<span id="cb63-4"><a href="#cb63-4"></a><span class="co"># check the type</span></span>
<span id="cb63-5"><a href="#cb63-5"></a><span class="bu">type</span>(after)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>bytes</code></pre>
</div>
</div>
<p>If you look at a <code>bytes</code> object, you’ll see that it has a <code>b</code> in front of it, and then maybe some text after. <strong>That’s because bytes are printed out as if they were characters encoded in UTF-8</strong>. Here you can see that our euro symbol has been replaced with some mojibake that looks like “” when it’s printed as if it were an UTF-8 string</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:296,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678975485,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="9d7d91e2-05ea-4190-ab70-97136ec616d3">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1"></a><span class="co"># take a look at what the bytes look like</span></span>
<span id="cb65-2"><a href="#cb65-2"></a>after</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>b'This is the euro symbol: \xe2\x82\xac'</code></pre>
</div>
</div>
<p>When we convert our <code>bytes</code> back to a <code>string</code> with the correct encoding, we can see that our text is all there correctly, which is great! :)</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:6,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678678991484,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="5ffe7203-662a-4f76-b49e-a8a10e211f7d">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1"></a><span class="co"># convert it back to utf-8</span></span>
<span id="cb67-2"><a href="#cb67-2"></a><span class="bu">print</span>(after.decode(<span class="st">"utf-8"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>This is the euro symbol: €</code></pre>
</div>
</div>
<p>However, when we try to use a different encoding to map our bytes into a string, we get an error. This is because the encoding we’re trying to use doesn’t know what to do with the <code>bytes</code> we’re trying to pass it. You need to tell Python the encoding that the byte string is actually supposed to be in</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:269,&quot;status&quot;:&quot;error&quot;,&quot;timestamp&quot;:1678678998998,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="662396c8-aa16-4279-a821-18a83734ddae">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1"></a><span class="co"># try to decode our bytes with the ascii encoding</span></span>
<span id="cb69-2"><a href="#cb69-2"></a><span class="bu">print</span>(after.decode(<span class="st">"ascii"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>UnicodeDecodeError: ignored</code></pre>
</div>
</div>
<p><strong>The best time to convert non UTF-8 input into UTF-8 is when you read in files</strong>, which we’ll talk about next.</p>
</section>
<section id="reading-in-files-with-encoding-problems" class="level3" data-number="4.4.4">
<h3 data-number="4.4.4" class="anchored" data-anchor-id="reading-in-files-with-encoding-problems"><span class="header-section-number">4.4.4</span> Reading in files with encoding problems</h3>
<p>Most files you’ll encounter will probably be encoded with UTF-8. This is what Python expects by default, so most of the time you won’t run into problems. However, sometimes you’ll get an error like this:</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:2739,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679026492,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="e86a2aef-092b-4039-a363-5363f59ba4ac">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1"></a><span class="op">!</span>kaggle datasets download <span class="op">-</span>d kemical<span class="op">/</span>kickstarter<span class="op">-</span>projects</span>
<span id="cb71-2"><a href="#cb71-2"></a><span class="op">!</span>unzip <span class="op">-</span>qq kickstarter<span class="op">-</span>projects.<span class="bu">zip</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Downloading kickstarter-projects.zip to /content
 68% 25.0M/36.8M [00:00&lt;00:00, 128MB/s] 
100% 36.8M/36.8M [00:00&lt;00:00, 142MB/s]</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:312,&quot;status&quot;:&quot;error&quot;,&quot;timestamp&quot;:1678679033531,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="79d0d063-1818-40be-9373-ead0b2c22f52">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1"></a><span class="co"># try to read in a file not in UTF-8</span></span>
<span id="cb73-2"><a href="#cb73-2"></a>kickstarter_2016 <span class="op">=</span> pd.read_csv(<span class="st">"ks-projects-201612.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>UnicodeDecodeError: ignored</code></pre>
</div>
</div>
<p>Notice that we get the same <code>UnicodeDecodeError</code> we got when we tried to decode UTF-8 bytes! <strong>This tells us that this file isn’t actually UTF-8</strong>. We don’t know what encoding it actually <em>is</em> though. One way to figure it out is to try and test a bunch of different character encodings and see if any of them work. A better way, though, is to use the <a href="https://github.com/chardet/chardet"><code>chardet</code></a> module to try and automatically guess what the right encoding is. It’s not 100% guaranteed to be right, but it’s usually faster than just trying to guess.</p>
<p>We are going to just look at the first ten thousand bytes of this file. This is usually enough for a good guess about what the encoding is and is much faster than trying to look at the whole file. (Especially with a large file this can be very slow.)</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:258,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679076382,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="5abb6a47-2755-488e-9dd0-1738195a2100">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1"></a><span class="co"># look at the first ten thousand bytes to guess the character encoding</span></span>
<span id="cb75-2"><a href="#cb75-2"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"ks-projects-201612.csv"</span>, <span class="st">'rb'</span>) <span class="im">as</span> rawdata:</span>
<span id="cb75-3"><a href="#cb75-3"></a>    result <span class="op">=</span> chardet.detect(rawdata.read(<span class="dv">10000</span>))</span>
<span id="cb75-4"><a href="#cb75-4"></a></span>
<span id="cb75-5"><a href="#cb75-5"></a><span class="co"># check what the character encoding might be</span></span>
<span id="cb75-6"><a href="#cb75-6"></a><span class="bu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'encoding': 'Windows-1252', 'confidence': 0.73, 'language': ''}</code></pre>
</div>
</div>
<p>So chardet is 73% confidence that the right encoding is “Windows-1252”. Let’s see if that’s correct:</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1926,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679094834,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="c9fecaa7-e693-4b1b-b860-20e433922c5a">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1"></a><span class="co"># read in the file with the encoding detected by chardet</span></span>
<span id="cb77-2"><a href="#cb77-2"></a>kickstarter_2016 <span class="op">=</span> pd.read_csv(<span class="st">"ks-projects-201612.csv"</span>, encoding<span class="op">=</span><span class="st">'Windows-1252'</span>)</span>
<span id="cb77-3"><a href="#cb77-3"></a></span>
<span id="cb77-4"><a href="#cb77-4"></a><span class="co"># look at the first few lines</span></span>
<span id="cb77-5"><a href="#cb77-5"></a>kickstarter_2016.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.9/dist-packages/IPython/core/interactiveshell.py:3326: DtypeWarning: Columns (13,14,15) have mixed types.Specify dtype option on import or set low_memory=False.
  exec(code_obj, self.user_global_ns, self.user_ns)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="51">

  <div id="df-e3afed3b-24a0-4dfc-b1c1-62d85e52d0be">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">category</th>
<th data-quarto-table-cell-role="th">main_category</th>
<th data-quarto-table-cell-role="th">currency</th>
<th data-quarto-table-cell-role="th">deadline</th>
<th data-quarto-table-cell-role="th">goal</th>
<th data-quarto-table-cell-role="th">launched</th>
<th data-quarto-table-cell-role="th">pledged</th>
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">backers</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">usd pledged</th>
<th data-quarto-table-cell-role="th">Unnamed: 13</th>
<th data-quarto-table-cell-role="th">Unnamed: 14</th>
<th data-quarto-table-cell-role="th">Unnamed: 15</th>
<th data-quarto-table-cell-role="th">Unnamed: 16</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1000002330</td>
<td>The Songs of Adelaide &amp; Abullah</td>
<td>Poetry</td>
<td>Publishing</td>
<td>GBP</td>
<td>2015-10-09 11:36:00</td>
<td>1000</td>
<td>2015-08-11 12:12:28</td>
<td>0</td>
<td>failed</td>
<td>0</td>
<td>GB</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1000004038</td>
<td>Where is Hank?</td>
<td>Narrative Film</td>
<td>Film &amp; Video</td>
<td>USD</td>
<td>2013-02-26 00:20:50</td>
<td>45000</td>
<td>2013-01-12 00:20:50</td>
<td>220</td>
<td>failed</td>
<td>3</td>
<td>US</td>
<td>220</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1000007540</td>
<td>ToshiCapital Rekordz Needs Help to Complete Album</td>
<td>Music</td>
<td>Music</td>
<td>USD</td>
<td>2012-04-16 04:24:11</td>
<td>5000</td>
<td>2012-03-17 03:24:11</td>
<td>1</td>
<td>failed</td>
<td>1</td>
<td>US</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1000011046</td>
<td>Community Film Project: The Art of Neighborhoo...</td>
<td>Film &amp; Video</td>
<td>Film &amp; Video</td>
<td>USD</td>
<td>2015-08-29 01:00:00</td>
<td>19500</td>
<td>2015-07-04 08:35:03</td>
<td>1283</td>
<td>canceled</td>
<td>14</td>
<td>US</td>
<td>1283</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1000014025</td>
<td>Monarch Espresso Bar</td>
<td>Restaurants</td>
<td>Food</td>
<td>USD</td>
<td>2016-04-01 13:38:27</td>
<td>50000</td>
<td>2016-02-26 13:38:27</td>
<td>52375</td>
<td>successful</td>
<td>224</td>
<td>US</td>
<td>52375</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-e3afed3b-24a0-4dfc-b1c1-62d85e52d0be')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-e3afed3b-24a0-4dfc-b1c1-62d85e52d0be button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-e3afed3b-24a0-4dfc-b1c1-62d85e52d0be');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<p>Yep, looks like <code>chardet</code> was right! The file reads in with no problem (although we do get a warning about datatypes) and when we look at the first few rows it seems to be fine.</p>
<p>What if the encoding <code>chardet</code> guesses isn’t right? Since <code>chardet</code> is basically just a fancy guesser, sometimes it will guess the wrong encoding. <strong>One thing you can try is looking at more or less of the file and seeing if you get a different result and then try that.</strong></p>
</section>
<section id="saving-your-files-with-utf-8-encoding" class="level3" data-number="4.4.5">
<h3 data-number="4.4.5" class="anchored" data-anchor-id="saving-your-files-with-utf-8-encoding"><span class="header-section-number">4.4.5</span> Saving your files with UTF-8 encoding</h3>
<p>Finally, once you’ve gone through all the trouble of getting your file into UTF-8, you’ll probably want to keep it that way. The easiest way to do that is to save your files with UTF-8 encoding. The good news is, since UTF-8 is the standard encoding in Python, when you save a file it will be saved as UTF-8 by default:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1"></a><span class="co"># save our file (will be saved as UTF-8 by default!)</span></span>
<span id="cb79-2"><a href="#cb79-2"></a>kickstarter_2016.to_csv(<span class="st">"ks-projects-201612-utf8.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1888,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679108610,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="7b224936-75ab-4269-b662-7ae8e90f790d">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1"></a><span class="co"># try to read in a file not in UTF-8</span></span>
<span id="cb80-2"><a href="#cb80-2"></a>kickstarter_2016 <span class="op">=</span> pd.read_csv(<span class="st">"ks-projects-201612-utf8.csv"</span>)</span>
<span id="cb80-3"><a href="#cb80-3"></a>kickstarter_2016.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.9/dist-packages/IPython/core/interactiveshell.py:3326: DtypeWarning: Columns (14,15,16) have mixed types.Specify dtype option on import or set low_memory=False.
  exec(code_obj, self.user_global_ns, self.user_ns)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="53">

  <div id="df-0a8aeea4-742d-4cd0-a03a-4a557dad2e79">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Unnamed: 0</th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">category</th>
<th data-quarto-table-cell-role="th">main_category</th>
<th data-quarto-table-cell-role="th">currency</th>
<th data-quarto-table-cell-role="th">deadline</th>
<th data-quarto-table-cell-role="th">goal</th>
<th data-quarto-table-cell-role="th">launched</th>
<th data-quarto-table-cell-role="th">pledged</th>
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">backers</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">usd pledged</th>
<th data-quarto-table-cell-role="th">Unnamed: 13</th>
<th data-quarto-table-cell-role="th">Unnamed: 14</th>
<th data-quarto-table-cell-role="th">Unnamed: 15</th>
<th data-quarto-table-cell-role="th">Unnamed: 16</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>1000002330</td>
<td>The Songs of Adelaide &amp; Abullah</td>
<td>Poetry</td>
<td>Publishing</td>
<td>GBP</td>
<td>2015-10-09 11:36:00</td>
<td>1000</td>
<td>2015-08-11 12:12:28</td>
<td>0</td>
<td>failed</td>
<td>0</td>
<td>GB</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>1000004038</td>
<td>Where is Hank?</td>
<td>Narrative Film</td>
<td>Film &amp; Video</td>
<td>USD</td>
<td>2013-02-26 00:20:50</td>
<td>45000</td>
<td>2013-01-12 00:20:50</td>
<td>220</td>
<td>failed</td>
<td>3</td>
<td>US</td>
<td>220</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2</td>
<td>1000007540</td>
<td>ToshiCapital Rekordz Needs Help to Complete Album</td>
<td>Music</td>
<td>Music</td>
<td>USD</td>
<td>2012-04-16 04:24:11</td>
<td>5000</td>
<td>2012-03-17 03:24:11</td>
<td>1</td>
<td>failed</td>
<td>1</td>
<td>US</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3</td>
<td>1000011046</td>
<td>Community Film Project: The Art of Neighborhoo...</td>
<td>Film &amp; Video</td>
<td>Film &amp; Video</td>
<td>USD</td>
<td>2015-08-29 01:00:00</td>
<td>19500</td>
<td>2015-07-04 08:35:03</td>
<td>1283</td>
<td>canceled</td>
<td>14</td>
<td>US</td>
<td>1283</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4</td>
<td>1000014025</td>
<td>Monarch Espresso Bar</td>
<td>Restaurants</td>
<td>Food</td>
<td>USD</td>
<td>2016-04-01 13:38:27</td>
<td>50000</td>
<td>2016-02-26 13:38:27</td>
<td>52375</td>
<td>successful</td>
<td>224</td>
<td>US</td>
<td>52375</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-0a8aeea4-742d-4cd0-a03a-4a557dad2e79')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-0a8aeea4-742d-4cd0-a03a-4a557dad2e79 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-0a8aeea4-742d-4cd0-a03a-4a557dad2e79');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
</section>
</section>
<section id="scaling-and-normalization" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="scaling-and-normalization"><span class="header-section-number">4.5</span> Scaling and normalization</h2>
<section id="standardization" class="level3" data-number="4.5.1">
<h3 data-number="4.5.1" class="anchored" data-anchor-id="standardization"><span class="header-section-number">4.5.1</span> Standardization</h3>
<p>By scaling your variables, you can help compare different variables on equal footing. The <a href="https://scikit-learn.org/stable/modules/preprocessing.html"><code>preprocessing</code></a> module provides the <code>StandardScaler</code> utility class, which is a quick and easy way to perform the following operation on an array-like dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1"></a><span class="co"># Uncpmment below if you are using Kaggle</span></span>
<span id="cb82-2"><a href="#cb82-2"></a><span class="co">#!pip install gdown</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:3107,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679157201,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="1dbaefb6-1719-4896-dea2-5af1e16ebf7c">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1"></a><span class="op">!</span>gdown <span class="op">--</span>fuzzy https:<span class="op">//</span>drive.google.com<span class="op">/</span><span class="bu">file</span><span class="op">/</span>d<span class="op">/</span><span class="dv">1</span><span class="er">HEcKRMe_bpgmQH3vFlRZVDF_gAzYGETE</span><span class="op">/</span>view?usp<span class="op">=</span>sharing <span class="co"># use --fuzzy so that it directly accept link from google drive </span></span>
<span id="cb83-2"><a href="#cb83-2"></a><span class="op">!</span>gdown <span class="op">--</span>fuzzy https:<span class="op">//</span>drive.google.com<span class="op">/</span><span class="bu">file</span><span class="op">/</span>d<span class="op">/</span><span class="dv">1</span><span class="er">GQ1z0</span><span class="op">-</span>aRPCzMQTcc1ckDgwkiF<span class="op">-</span>GNP_t3<span class="op">/</span>view?usp<span class="op">=</span>sharing</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Downloading...
From: https://drive.google.com/uc?id=1HEcKRMe_bpgmQH3vFlRZVDF_gAzYGETE
To: /content/train_preprocessed.csv
100% 1.14M/1.14M [00:00&lt;00:00, 101MB/s]
Downloading...
From: https://drive.google.com/uc?id=1GQ1z0-aRPCzMQTcc1ckDgwkiF-GNP_t3
To: /content/test_preprocessed.csv
100% 1.12M/1.12M [00:00&lt;00:00, 112MB/s]</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:299,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679172201,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="0ff730d1-2a6e-4a01-deab-2d794b669ace">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1"></a>train <span class="op">=</span> pd.read_csv(<span class="st">'train_preprocessed.csv'</span>)</span>
<span id="cb85-2"><a href="#cb85-2"></a>train_x <span class="op">=</span> train.drop([<span class="st">'target'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb85-3"><a href="#cb85-3"></a>train_y <span class="op">=</span> train[<span class="st">'target'</span>]</span>
<span id="cb85-4"><a href="#cb85-4"></a>test_x <span class="op">=</span> pd.read_csv(<span class="st">'test_preprocessed.csv'</span>)</span>
<span id="cb85-5"><a href="#cb85-5"></a>train_x_saved <span class="op">=</span> train_x.copy()</span>
<span id="cb85-6"><a href="#cb85-6"></a>test_x_saved <span class="op">=</span> test_x.copy()</span>
<span id="cb85-7"><a href="#cb85-7"></a></span>
<span id="cb85-8"><a href="#cb85-8"></a><span class="kw">def</span> load_data():</span>
<span id="cb85-9"><a href="#cb85-9"></a>    train_x, test_x <span class="op">=</span> train_x_saved.copy(), test_x_saved.copy()</span>
<span id="cb85-10"><a href="#cb85-10"></a>    <span class="cf">return</span> train_x, test_x</span>
<span id="cb85-11"><a href="#cb85-11"></a></span>
<span id="cb85-12"><a href="#cb85-12"></a>train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">

  <div id="df-f97b44d2-9b6a-4aa7-9e39-14feb6c2c23a">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">height</th>
<th data-quarto-table-cell-role="th">weight</th>
<th data-quarto-table-cell-role="th">product</th>
<th data-quarto-table-cell-role="th">amount</th>
<th data-quarto-table-cell-role="th">medical_info_a1</th>
<th data-quarto-table-cell-role="th">medical_info_a2</th>
<th data-quarto-table-cell-role="th">medical_info_a3</th>
<th data-quarto-table-cell-role="th">medical_info_b1</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">medical_keyword_6</th>
<th data-quarto-table-cell-role="th">medical_keyword_7</th>
<th data-quarto-table-cell-role="th">medical_keyword_8</th>
<th data-quarto-table-cell-role="th">medical_keyword_9</th>
<th data-quarto-table-cell-role="th">medical_keyword_10</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">day</th>
<th data-quarto-table-cell-role="th">yearmonth</th>
<th data-quarto-table-cell-role="th">target</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>50</td>
<td>1</td>
<td>166.445608</td>
<td>65.016732</td>
<td>9</td>
<td>7000000</td>
<td>134</td>
<td>202</td>
<td>1</td>
<td>11</td>
<td>...</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>2015</td>
<td>2</td>
<td>3</td>
<td>24182</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>68</td>
<td>0</td>
<td>164.334615</td>
<td>56.544217</td>
<td>0</td>
<td>7000000</td>
<td>438</td>
<td>263</td>
<td>3</td>
<td>14</td>
<td>...</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>2015</td>
<td>5</td>
<td>9</td>
<td>24185</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>77</td>
<td>1</td>
<td>167.462917</td>
<td>54.242267</td>
<td>2</td>
<td>6000000</td>
<td>313</td>
<td>325</td>
<td>1</td>
<td>18</td>
<td>...</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>2016</td>
<td>2</td>
<td>13</td>
<td>24194</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>17</td>
<td>1</td>
<td>177.097725</td>
<td>71.147762</td>
<td>3</td>
<td>8000000</td>
<td>342</td>
<td>213</td>
<td>2</td>
<td>11</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>2015</td>
<td>7</td>
<td>6</td>
<td>24187</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>62</td>
<td>0</td>
<td>158.165788</td>
<td>65.240697</td>
<td>1</td>
<td>9000000</td>
<td>327</td>
<td>102</td>
<td>0</td>
<td>14</td>
<td>...</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>2016</td>
<td>9</td>
<td>17</td>
<td>24201</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9995</td>
<td>61</td>
<td>1</td>
<td>182.729800</td>
<td>73.393777</td>
<td>1</td>
<td>2000000</td>
<td>189</td>
<td>232</td>
<td>7</td>
<td>17</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>2015</td>
<td>10</td>
<td>21</td>
<td>24190</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9996</td>
<td>33</td>
<td>0</td>
<td>167.701136</td>
<td>75.006529</td>
<td>8</td>
<td>9000</td>
<td>426</td>
<td>202</td>
<td>3</td>
<td>19</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>2015</td>
<td>5</td>
<td>28</td>
<td>24185</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9997</td>
<td>44</td>
<td>0</td>
<td>145.609998</td>
<td>47.739397</td>
<td>8</td>
<td>1000</td>
<td>370</td>
<td>274</td>
<td>1</td>
<td>11</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>2016</td>
<td>2</td>
<td>29</td>
<td>24194</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9998</td>
<td>34</td>
<td>0</td>
<td>165.796017</td>
<td>57.567695</td>
<td>6</td>
<td>5000</td>
<td>291</td>
<td>105</td>
<td>1</td>
<td>13</td>
<td>...</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>2016</td>
<td>2</td>
<td>27</td>
<td>24194</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9999</td>
<td>31</td>
<td>1</td>
<td>180.301762</td>
<td>71.425135</td>
<td>4</td>
<td>1000000</td>
<td>288</td>
<td>454</td>
<td>4</td>
<td>13</td>
<td>...</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>2015</td>
<td>7</td>
<td>1</td>
<td>24187</td>
<td>0</td>
</tr>
</tbody>
</table>


<p>10000 rows × 29 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-f97b44d2-9b6a-4aa7-9e39-14feb6c2c23a')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-f97b44d2-9b6a-4aa7-9e39-14feb6c2c23a button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-f97b44d2-9b6a-4aa7-9e39-14feb6c2c23a');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1"></a>num_cols <span class="op">=</span> [<span class="st">'age'</span>, <span class="st">'height'</span>, <span class="st">'weight'</span>, <span class="st">'amount'</span>,</span>
<span id="cb86-2"><a href="#cb86-2"></a>            <span class="st">'medical_info_a1'</span>, <span class="st">'medical_info_a2'</span>, <span class="st">'medical_info_a3'</span>, <span class="st">'medical_info_b1'</span>] <span class="co"># some numerical columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:266,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679220941,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="c9e6139d-1169-4bad-f6d3-4a260cd86fd5">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1"></a>train_x, test_x <span class="op">=</span> load_data()</span>
<span id="cb87-2"><a href="#cb87-2"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb87-3"><a href="#cb87-3"></a>scaler.fit(train_x[num_cols])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<style>#sk-container-id-2 {color: black;background-color: white;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>StandardScaler()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked=""><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div>
</div>
</div>
<p>Notice that <strong>you should apply the same transfrom</strong> on both training and testing dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1"></a>train_x[num_cols] <span class="op">=</span> scaler.transform(train_x[num_cols])</span>
<span id="cb88-2"><a href="#cb88-2"></a>test_x[num_cols] <span class="op">=</span> scaler.transform(test_x[num_cols])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:267,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679251034,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="34a25dba-ee94-4821-9ece-0a12cd2f086e">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1"></a>scaler.mean_,  scaler.scale_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>(array([4.20265000e+01, 1.65892951e+02, 6.08570495e+01, 3.84084370e+06,
        2.99101200e+02, 2.49454700e+02, 1.98780000e+00, 1.44192000e+01]),
 array([2.16749209e+01, 9.40817216e+00, 1.07177883e+01, 3.45926743e+06,
        1.04491031e+02, 1.03710381e+02, 1.41733947e+00, 2.87131875e+00]))</code></pre>
</div>
</div>
<p>Scaled data has zero mean and unit variance:</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:297,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679261472,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="7f0072b8-1d02-4da7-f249-a2a529314d88">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1"></a>train_x[num_cols].mean(axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<pre><code>age                6.679102e-17
height            -2.836842e-15
weight            -2.337686e-16
amount            -3.588241e-17
medical_info_a1   -5.684342e-17
medical_info_a2   -2.344791e-17
medical_info_a3    1.563194e-17
medical_info_b1   -3.410605e-17
dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:400,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679262254,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="1036f2a7-b30b-4c1e-d6e6-7de834db5d33">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1"></a>train_x[num_cols].std(axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>age                1.00005
height             1.00005
weight             1.00005
amount             1.00005
medical_info_a1    1.00005
medical_info_a2    1.00005
medical_info_a3    1.00005
medical_info_b1    1.00005
dtype: float64</code></pre>
</div>
</div>
<p>Note that it is possible to disable either centering or scaling by either passing <code>with_mean=False</code> or <code>with_std=False</code> to the constructor of <code>StandardScaler</code>.</p>
</section>
<section id="scaling" class="level3" data-number="4.5.2">
<h3 data-number="4.5.2" class="anchored" data-anchor-id="scaling"><span class="header-section-number">4.5.2</span> Scaling</h3>
<p>An alternative standardization is scaling features to lie between a given minimum and maximum value, often between zero and one.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:365,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679273263,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="31b351b0-8ee1-4f6b-f473-e9aa9c7bffc1">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1"></a>scaler <span class="op">=</span> MinMaxScaler()</span>
<span id="cb95-2"><a href="#cb95-2"></a>scaler.fit(train_x[num_cols])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<style>#sk-container-id-3 {color: black;background-color: white;}#sk-container-id-3 pre{padding: 0;}#sk-container-id-3 div.sk-toggleable {background-color: white;}#sk-container-id-3 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-3 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-3 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-3 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-3 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-3 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-3 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-3 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-3 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-3 div.sk-item {position: relative;z-index: 1;}#sk-container-id-3 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-3 div.sk-item::before, #sk-container-id-3 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-3 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-3 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-3 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-3 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-3 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-3 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-3 div.sk-label-container {text-align: center;}#sk-container-id-3 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-3 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>MinMaxScaler()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" checked=""><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">MinMaxScaler</label><div class="sk-toggleable__content"><pre>MinMaxScaler()</pre></div></div></div></div></div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1"></a>train_x[num_cols] <span class="op">=</span> scaler.transform(train_x[num_cols])</span>
<span id="cb96-2"><a href="#cb96-2"></a>test_x[num_cols] <span class="op">=</span> scaler.transform(test_x[num_cols])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:7,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679282999,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="d7c03eb0-4b86-4735-f04f-ecc32882dd1c">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1"></a>train_x[num_cols].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">

  <div id="df-6cceb57a-1fd2-42fd-8ed9-2be376f22f88">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">height</th>
<th data-quarto-table-cell-role="th">weight</th>
<th data-quarto-table-cell-role="th">amount</th>
<th data-quarto-table-cell-role="th">medical_info_a1</th>
<th data-quarto-table-cell-role="th">medical_info_a2</th>
<th data-quarto-table-cell-role="th">medical_info_a3</th>
<th data-quarto-table-cell-role="th">medical_info_b1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>10000.000000</td>
<td>10000.000000</td>
<td>10000.000000</td>
<td>10000.000000</td>
<td>10000.000000</td>
<td>10000.000000</td>
<td>10000.000000</td>
<td>10000.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>0.500358</td>
<td>0.524152</td>
<td>0.380388</td>
<td>0.384023</td>
<td>0.470184</td>
<td>0.487333</td>
<td>0.220867</td>
<td>0.491022</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>0.292919</td>
<td>0.143889</td>
<td>0.125162</td>
<td>0.345979</td>
<td>0.136063</td>
<td>0.130789</td>
<td>0.157490</td>
<td>0.319051</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>0.243243</td>
<td>0.427145</td>
<td>0.292879</td>
<td>0.000800</td>
<td>0.376302</td>
<td>0.399748</td>
<td>0.111111</td>
<td>0.222222</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>0.513514</td>
<td>0.527079</td>
<td>0.376458</td>
<td>0.299930</td>
<td>0.470703</td>
<td>0.488020</td>
<td>0.222222</td>
<td>0.444444</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>0.756757</td>
<td>0.624006</td>
<td>0.461614</td>
<td>0.699970</td>
<td>0.563802</td>
<td>0.576293</td>
<td>0.333333</td>
<td>0.777778</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-6cceb57a-1fd2-42fd-8ed9-2be376f22f88')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-6cceb57a-1fd2-42fd-8ed9-2be376f22f88 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-6cceb57a-1fd2-42fd-8ed9-2be376f22f88');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<p>Note that you can scale to any range by specifying <code>feature_range=(min, max)</code>.</p>
</section>
<section id="logarithm-transform-and-binning" class="level3" data-number="4.5.3">
<h3 data-number="4.5.3" class="anchored" data-anchor-id="logarithm-transform-and-binning"><span class="header-section-number">4.5.3</span> Logarithm transform and binning</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1"></a>x <span class="op">=</span> np.array([<span class="fl">1.0</span>, <span class="fl">10.0</span>, <span class="fl">100.0</span>, <span class="fl">1000.0</span>, <span class="fl">10000.0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:279,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679311064,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="3d185477-fcbd-4671-dbb6-a362af4a9a7b">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1"></a>np.log(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>array([0.        , 2.30258509, 4.60517019, 6.90775528, 9.21034037])</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:267,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679328342,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="ff977af2-7a23-4add-9ef0-c778e5f57f0b">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1"></a><span class="co"># If your data contains zero value, try to plus one first</span></span>
<span id="cb101-2"><a href="#cb101-2"></a>np.log1p(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="68">
<pre><code>array([0.69314718, 2.39789527, 4.61512052, 6.90875478, 9.21044037])</code></pre>
</div>
</div>
<p>Binning allows you to transform numerical variable to categorical variable</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1"></a>x <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:268,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679350767,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="3f909950-1d27-4952-d6d1-2fd381103e26">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1"></a>bin_edges <span class="op">=</span> [<span class="op">-</span><span class="bu">float</span>(<span class="st">'inf'</span>), <span class="fl">3.0</span>, <span class="fl">5.0</span>, <span class="bu">float</span>(<span class="st">'inf'</span>)]</span>
<span id="cb104-2"><a href="#cb104-2"></a>binned <span class="op">=</span> pd.cut(x, bin_edges, labels<span class="op">=</span><span class="va">False</span>, retbins<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb104-3"><a href="#cb104-3"></a><span class="bu">print</span>(binned)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(array([0, 2, 1, 1, 2, 0]), array([-inf,   3.,   5.,  inf]))</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:250,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679360211,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="d10b87b1-158d-4362-af40-60a33f3ba848">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1"></a>binned </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<pre><code>(array([0, 2, 1, 1, 2, 0]), array([-inf,   3.,   5.,  inf]))</code></pre>
</div>
</div>
</section>
<section id="power-transfrom" class="level3" data-number="4.5.4">
<h3 data-number="4.5.4" class="anchored" data-anchor-id="power-transfrom"><span class="header-section-number">4.5.4</span> Power transfrom</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1"></a>train_x, test_x <span class="op">=</span> load_data()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Box-cox transform only works for postive data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1"></a>pos_cols <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> num_cols <span class="cf">if</span> (train_x[c] <span class="op">&gt;</span> <span class="fl">0.0</span>).<span class="bu">all</span>() <span class="kw">and</span> (test_x[c] <span class="op">&gt;</span> <span class="fl">0.0</span>).<span class="bu">all</span>()] <span class="co"># List comprehension which is similar to set-builder notation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:290,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679391532,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="c67baf6b-f538-43c2-93c4-ca7df21a3142">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1"></a>pt <span class="op">=</span> PowerTransformer(method<span class="op">=</span><span class="st">'box-cox'</span>)</span>
<span id="cb110-2"><a href="#cb110-2"></a>pt.fit(train_x[pos_cols])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">
<style>#sk-container-id-4 {color: black;background-color: white;}#sk-container-id-4 pre{padding: 0;}#sk-container-id-4 div.sk-toggleable {background-color: white;}#sk-container-id-4 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-4 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-4 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-4 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-4 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-4 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-4 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-4 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-4 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-4 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-4 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-4 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-4 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-4 div.sk-item {position: relative;z-index: 1;}#sk-container-id-4 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-4 div.sk-item::before, #sk-container-id-4 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-4 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-4 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-4 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-4 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-4 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-4 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-4 div.sk-label-container {text-align: center;}#sk-container-id-4 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-4 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-4" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>PowerTransformer(method='box-cox')</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" checked=""><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">PowerTransformer</label><div class="sk-toggleable__content"><pre>PowerTransformer(method='box-cox')</pre></div></div></div></div></div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1"></a>train_x[pos_cols] <span class="op">=</span> pt.transform(train_x[pos_cols])</span>
<span id="cb111-2"><a href="#cb111-2"></a>test_x[pos_cols] <span class="op">=</span> pt.transform(test_x[pos_cols])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:903,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679395526,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="e2a0d0c2-a8dc-4feb-b30e-ecbadec1a02d">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1"></a>rng <span class="op">=</span> np.random.RandomState(<span class="dv">304</span>)</span>
<span id="cb112-2"><a href="#cb112-2"></a>original_data <span class="op">=</span> rng.lognormal(size<span class="op">=</span>(<span class="dv">1000</span>,<span class="dv">1</span>))</span>
<span id="cb112-3"><a href="#cb112-3"></a>pt <span class="op">=</span> PowerTransformer(method<span class="op">=</span><span class="st">'box-cox'</span>)</span>
<span id="cb112-4"><a href="#cb112-4"></a>transformed_data <span class="op">=</span> pt.fit_transform(original_data)</span>
<span id="cb112-5"><a href="#cb112-5"></a></span>
<span id="cb112-6"><a href="#cb112-6"></a>fig, ax<span class="op">=</span>plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">3</span>))</span>
<span id="cb112-7"><a href="#cb112-7"></a>sns.histplot(original_data, ax<span class="op">=</span>ax[<span class="dv">0</span>], kde<span class="op">=</span><span class="va">True</span>, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb112-8"><a href="#cb112-8"></a>ax[<span class="dv">0</span>].set_title(<span class="st">"Original Data"</span>)</span>
<span id="cb112-9"><a href="#cb112-9"></a>sns.histplot(transformed_data, ax<span class="op">=</span>ax[<span class="dv">1</span>], kde<span class="op">=</span><span class="va">True</span>, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb112-10"><a href="#cb112-10"></a>ax[<span class="dv">1</span>].set_title(<span class="st">"Transformed data"</span>)</span>
<span id="cb112-11"><a href="#cb112-11"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="04_Clean_feature_engineering_files/figure-html/cell-77-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1"></a>train_x, test_x <span class="op">=</span> load_data()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:3,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679403834,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="c8078d0f-2c72-4c36-fa8a-4f99a4d56236">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1"></a>pt <span class="op">=</span> PowerTransformer(method<span class="op">=</span><span class="st">'yeo-johnson'</span>)</span>
<span id="cb114-2"><a href="#cb114-2"></a>pt.fit(train_x[num_cols])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="78">
<style>#sk-container-id-5 {color: black;background-color: white;}#sk-container-id-5 pre{padding: 0;}#sk-container-id-5 div.sk-toggleable {background-color: white;}#sk-container-id-5 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-5 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-5 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-5 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-5 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-5 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-5 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-5 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-5 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-5 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-5 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-5 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-5 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-5 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-5 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-5 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-5 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-5 div.sk-item {position: relative;z-index: 1;}#sk-container-id-5 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-5 div.sk-item::before, #sk-container-id-5 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-5 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-5 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-5 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-5 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-5 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-5 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-5 div.sk-label-container {text-align: center;}#sk-container-id-5 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-5 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-5" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>PowerTransformer()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" checked=""><label for="sk-estimator-id-5" class="sk-toggleable__label sk-toggleable__label-arrow">PowerTransformer</label><div class="sk-toggleable__content"><pre>PowerTransformer()</pre></div></div></div></div></div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1"></a>train_x[num_cols] <span class="op">=</span> pt.transform(train_x[num_cols])</span>
<span id="cb115-2"><a href="#cb115-2"></a>test_x[num_cols] <span class="op">=</span> pt.transform(test_x[num_cols])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:828,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679408331,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="ee5440d7-2460-43ac-cee5-59605d58d17b">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1"></a>rng <span class="op">=</span> np.random.RandomState(<span class="dv">304</span>)</span>
<span id="cb116-2"><a href="#cb116-2"></a>original_data <span class="op">=</span> rng.lognormal(size<span class="op">=</span>(<span class="dv">1000</span>,<span class="dv">1</span>))</span>
<span id="cb116-3"><a href="#cb116-3"></a>pt <span class="op">=</span> PowerTransformer(method<span class="op">=</span><span class="st">'yeo-johnson'</span>)</span>
<span id="cb116-4"><a href="#cb116-4"></a>transformed_data <span class="op">=</span> pt.fit_transform(original_data)</span>
<span id="cb116-5"><a href="#cb116-5"></a></span>
<span id="cb116-6"><a href="#cb116-6"></a>fig, ax<span class="op">=</span>plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">3</span>))</span>
<span id="cb116-7"><a href="#cb116-7"></a>sns.histplot(original_data, ax<span class="op">=</span>ax[<span class="dv">0</span>], kde<span class="op">=</span><span class="va">True</span>, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb116-8"><a href="#cb116-8"></a>ax[<span class="dv">0</span>].set_title(<span class="st">"Original Data"</span>)</span>
<span id="cb116-9"><a href="#cb116-9"></a>sns.histplot(transformed_data, ax<span class="op">=</span>ax[<span class="dv">1</span>], kde<span class="op">=</span><span class="va">True</span>, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb116-10"><a href="#cb116-10"></a>ax[<span class="dv">1</span>].set_title(<span class="st">"Transformed data"</span>)</span>
<span id="cb116-11"><a href="#cb116-11"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="04_Clean_feature_engineering_files/figure-html/cell-81-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="quantile-transfrom" class="level3" data-number="4.5.5">
<h3 data-number="4.5.5" class="anchored" data-anchor-id="quantile-transfrom"><span class="header-section-number">4.5.5</span> Quantile transfrom</h3>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:284,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679414070,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="d9d9eb05-70b6-417e-8660-eb1057278d9c">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1"></a>transformer <span class="op">=</span> QuantileTransformer(n_quantiles<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">0</span>, output_distribution<span class="op">=</span><span class="st">'normal'</span>)</span>
<span id="cb117-2"><a href="#cb117-2"></a>transformer.fit(train_x[num_cols])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="81">
<style>#sk-container-id-6 {color: black;background-color: white;}#sk-container-id-6 pre{padding: 0;}#sk-container-id-6 div.sk-toggleable {background-color: white;}#sk-container-id-6 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-6 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-6 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-6 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-6 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-6 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-6 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-6 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-6 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-6 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-6 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-6 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-6 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-6 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-6 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-6 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-6 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-6 div.sk-item {position: relative;z-index: 1;}#sk-container-id-6 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-6 div.sk-item::before, #sk-container-id-6 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-6 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-6 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-6 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-6 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-6 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-6 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-6 div.sk-label-container {text-align: center;}#sk-container-id-6 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-6 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-6" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>QuantileTransformer(n_quantiles=100, output_distribution='normal',
                    random_state=0)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox" checked=""><label for="sk-estimator-id-6" class="sk-toggleable__label sk-toggleable__label-arrow">QuantileTransformer</label><div class="sk-toggleable__content"><pre>QuantileTransformer(n_quantiles=100, output_distribution='normal',
                    random_state=0)</pre></div></div></div></div></div>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:981,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679426900,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="ec5782fc-dc36-4638-b1f3-e310a8dcc6e7">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1"></a>rng <span class="op">=</span> np.random.RandomState(<span class="dv">304</span>)</span>
<span id="cb118-2"><a href="#cb118-2"></a>original_data <span class="op">=</span> rng.lognormal(size<span class="op">=</span>(<span class="dv">1000</span>,<span class="dv">1</span>))</span>
<span id="cb118-3"><a href="#cb118-3"></a>transformer <span class="op">=</span> QuantileTransformer(n_quantiles<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">0</span>, output_distribution<span class="op">=</span><span class="st">'normal'</span>)</span>
<span id="cb118-4"><a href="#cb118-4"></a>transformed_data <span class="op">=</span> transformer.fit_transform(original_data)</span>
<span id="cb118-5"><a href="#cb118-5"></a></span>
<span id="cb118-6"><a href="#cb118-6"></a>fig, ax<span class="op">=</span>plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">3</span>))</span>
<span id="cb118-7"><a href="#cb118-7"></a>sns.histplot(original_data, ax<span class="op">=</span>ax[<span class="dv">0</span>], kde<span class="op">=</span><span class="va">True</span>, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb118-8"><a href="#cb118-8"></a>ax[<span class="dv">0</span>].set_title(<span class="st">"Original Data"</span>)</span>
<span id="cb118-9"><a href="#cb118-9"></a>sns.histplot(transformed_data, ax<span class="op">=</span>ax[<span class="dv">1</span>], kde<span class="op">=</span><span class="va">True</span>, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb118-10"><a href="#cb118-10"></a>ax[<span class="dv">1</span>].set_title(<span class="st">"Transformed data"</span>)</span>
<span id="cb118-11"><a href="#cb118-11"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="04_Clean_feature_engineering_files/figure-html/cell-83-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="encoding" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="encoding"><span class="header-section-number">4.6</span> Encoding</h2>
<section id="one-hot-encoding" class="level3" data-number="4.6.1">
<h3 data-number="4.6.1" class="anchored" data-anchor-id="one-hot-encoding"><span class="header-section-number">4.6.1</span> One-hot encoding</h3>
<p>One possibility to convert categorical features to features that can be used with <code>scikit-learn</code> estimators is to use a one-of-K, also known as one-hot or dummy encoding. This type of encoding can be obtained with the <code>OneHotEncoder</code>, which transforms each categorical feature with <code>n_categories</code> possible values into <code>n_categories</code> binary features, with one of them 1, and all others 0.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1"></a>enc <span class="op">=</span> OneHotEncoder(drop<span class="op">=</span><span class="va">None</span>, handle_unknown<span class="op">=</span><span class="st">'ignore'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:293,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679495337,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="92b02e76-d0cb-47d1-cd51-b5013afed4fb">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1"></a>X <span class="op">=</span> pd.DataFrame(np.array([[<span class="st">'male'</span>, <span class="st">'from US'</span>, <span class="st">'uses Safari'</span>], [<span class="st">'female'</span>, <span class="st">'from Europe'</span>, <span class="st">'uses Firefox'</span>], [<span class="st">'female'</span>, <span class="st">'from Europe'</span>, <span class="st">'uses Chrome'</span>]]), columns<span class="op">=</span>[<span class="st">'gender'</span>, <span class="st">'locations'</span>, <span class="st">'browsers'</span>])</span>
<span id="cb120-2"><a href="#cb120-2"></a>X.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="84">

  <div id="df-53ca857c-c51d-4224-bbdf-c7655bbb92b7">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">locations</th>
<th data-quarto-table-cell-role="th">browsers</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>male</td>
<td>from US</td>
<td>uses Safari</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>female</td>
<td>from Europe</td>
<td>uses Firefox</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>female</td>
<td>from Europe</td>
<td>uses Chrome</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-53ca857c-c51d-4224-bbdf-c7655bbb92b7')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-53ca857c-c51d-4224-bbdf-c7655bbb92b7 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-53ca857c-c51d-4224-bbdf-c7655bbb92b7');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:287,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679512673,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="2f386980-0ea7-485f-a833-291fe26e7ffa">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1"></a>onehot_encoded <span class="op">=</span> enc.fit_transform(X).toarray()</span>
<span id="cb121-2"><a href="#cb121-2"></a>pd.DataFrame(onehot_encoded, columns<span class="op">=</span>enc.get_feature_names_out())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="85">

  <div id="df-b645e884-4ec4-415b-a5e8-37ebd3ba3f0f">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">gender_female</th>
<th data-quarto-table-cell-role="th">gender_male</th>
<th data-quarto-table-cell-role="th">locations_from Europe</th>
<th data-quarto-table-cell-role="th">locations_from US</th>
<th data-quarto-table-cell-role="th">browsers_uses Chrome</th>
<th data-quarto-table-cell-role="th">browsers_uses Firefox</th>
<th data-quarto-table-cell-role="th">browsers_uses Safari</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-b645e884-4ec4-415b-a5e8-37ebd3ba3f0f')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-b645e884-4ec4-415b-a5e8-37ebd3ba3f0f button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-b645e884-4ec4-415b-a5e8-37ebd3ba3f0f');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<p>When an unknown category is encountered during <code>transform()</code>, the resulting one-hot encoded columns for this feature will be all zeros:</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:418,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679553523,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="ed8d55b0-4a00-43c1-f368-a79d1753bcf2">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1"></a>X_test <span class="op">=</span> pd.DataFrame(np.array([[<span class="st">'male'</span>, <span class="st">'from US'</span>, <span class="st">'uses Firefox'</span>], [<span class="st">'female'</span>, <span class="st">'from Europe'</span>, <span class="st">'uses IE'</span>]]), columns<span class="op">=</span>[<span class="st">'gender'</span>, <span class="st">'locations'</span>, <span class="st">'browsers'</span>])</span>
<span id="cb122-2"><a href="#cb122-2"></a>onehot_encoded <span class="op">=</span> enc.transform(X_test).toarray()</span>
<span id="cb122-3"><a href="#cb122-3"></a>pd.DataFrame(onehot_encoded, columns<span class="op">=</span>enc.get_feature_names_out())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="86">

  <div id="df-1989c07c-d20c-433d-bca9-8c7e7c203ac2">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">gender_female</th>
<th data-quarto-table-cell-role="th">gender_male</th>
<th data-quarto-table-cell-role="th">locations_from Europe</th>
<th data-quarto-table-cell-role="th">locations_from US</th>
<th data-quarto-table-cell-role="th">browsers_uses Chrome</th>
<th data-quarto-table-cell-role="th">browsers_uses Firefox</th>
<th data-quarto-table-cell-role="th">browsers_uses Safari</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-1989c07c-d20c-433d-bca9-8c7e7c203ac2')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-1989c07c-d20c-433d-bca9-8c7e7c203ac2 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-1989c07c-d20c-433d-bca9-8c7e7c203ac2');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
</section>
<section id="ordinal-encoding" class="level3" data-number="4.6.2">
<h3 data-number="4.6.2" class="anchored" data-anchor-id="ordinal-encoding"><span class="header-section-number">4.6.2</span> Ordinal encoding</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1"></a>enc <span class="op">=</span> OrdinalEncoder(handle_unknown<span class="op">=</span><span class="st">'use_encoded_value'</span>, unknown_value<span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:5,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679582529,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="3ff7c79d-0348-489c-e98f-27483df0b864">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1"></a>X <span class="op">=</span> pd.DataFrame(np.array([[<span class="st">'male'</span>, <span class="st">'from US'</span>, <span class="st">'uses Safari'</span>], [<span class="st">'female'</span>, <span class="st">'from Europe'</span>, <span class="st">'uses Firefox'</span>], [<span class="st">'female'</span>, <span class="st">'from Europe'</span>, <span class="st">'uses Chrome'</span>]]), columns<span class="op">=</span>[<span class="st">'gender'</span>, <span class="st">'locations'</span>, <span class="st">'browsers'</span>])</span>
<span id="cb124-2"><a href="#cb124-2"></a>X.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="88">

  <div id="df-0a3336a7-3617-419c-9189-c6482dc24ea4">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">locations</th>
<th data-quarto-table-cell-role="th">browsers</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>male</td>
<td>from US</td>
<td>uses Safari</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>female</td>
<td>from Europe</td>
<td>uses Firefox</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>female</td>
<td>from Europe</td>
<td>uses Chrome</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-0a3336a7-3617-419c-9189-c6482dc24ea4')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-0a3336a7-3617-419c-9189-c6482dc24ea4 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-0a3336a7-3617-419c-9189-c6482dc24ea4');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:8,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679582971,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="7babac38-7c85-4a26-f970-9ca8e64442da">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1"></a>ordinal_encoded <span class="op">=</span> enc.fit_transform(X)</span>
<span id="cb125-2"><a href="#cb125-2"></a>pd.DataFrame(ordinal_encoded, columns<span class="op">=</span>enc.get_feature_names_out())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="89">

  <div id="df-c16ecc79-df7e-4f06-a546-4bd81767427d">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">locations</th>
<th data-quarto-table-cell-role="th">browsers</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-c16ecc79-df7e-4f06-a546-4bd81767427d')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-c16ecc79-df7e-4f06-a546-4bd81767427d button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-c16ecc79-df7e-4f06-a546-4bd81767427d');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:443,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679584767,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="ccecfc23-6f71-47bb-a60e-928483e1a5a3">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1"></a>X_test <span class="op">=</span> pd.DataFrame(np.array([[<span class="st">'male'</span>, <span class="st">'from US'</span>, <span class="st">'uses Firefox'</span>], [<span class="st">'female'</span>, <span class="st">'from Europe'</span>, <span class="st">'uses IE'</span>]]), columns<span class="op">=</span>[<span class="st">'gender'</span>, <span class="st">'locations'</span>, <span class="st">'browsers'</span>])</span>
<span id="cb126-2"><a href="#cb126-2"></a>ordinal_encoded <span class="op">=</span> enc.transform(X_test)</span>
<span id="cb126-3"><a href="#cb126-3"></a>pd.DataFrame(ordinal_encoded, columns<span class="op">=</span>enc.get_feature_names_out())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="90">

  <div id="df-cdda797d-2e54-4f86-86ff-7ada815e470d">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">locations</th>
<th data-quarto-table-cell-role="th">browsers</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.0</td>
<td>0.0</td>
<td>-1.0</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-cdda797d-2e54-4f86-86ff-7ada815e470d')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-cdda797d-2e54-4f86-86ff-7ada815e470d button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-cdda797d-2e54-4f86-86ff-7ada815e470d');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
</section>
<section id="target-encoding" class="level3" data-number="4.6.3">
<h3 data-number="4.6.3" class="anchored" data-anchor-id="target-encoding"><span class="header-section-number">4.6.3</span> Target encoding</h3>
<p>The <a href="https://www.kaggle.com/datasets/odedgolden/movielens-1m-dataset"><em>MovieLens1M</em></a> dataset contains one-million movie ratings by users of the MovieLens website, with features describing each user and movie. This hidden cell sets everything up:</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1262,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679596640,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="115450f9-68e4-4816-9d28-06519272c8ab">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1"></a><span class="op">!</span>kaggle datasets download <span class="op">-</span>d odedgolden<span class="op">/</span>movielens<span class="op">-</span><span class="dv">1</span><span class="er">m</span><span class="op">-</span>dataset</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Downloading movielens-1m-dataset.zip to /content
  0% 0.00/5.83M [00:00&lt;?, ?B/s] 86% 5.00M/5.83M [00:00&lt;00:00, 46.2MB/s]
100% 5.83M/5.83M [00:00&lt;00:00, 51.8MB/s]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1"></a><span class="op">!</span>unzip <span class="op">-</span>qq movielens<span class="op">-</span><span class="dv">1</span><span class="er">m</span><span class="op">-</span>dataset.<span class="bu">zip</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:7136,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679606469,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="e1805f16-7091-437b-b19e-70d72f086dc4">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1"></a>ratings <span class="op">=</span> pd.read_csv(<span class="st">'ratings.dat'</span>,sep<span class="op">=</span><span class="st">'::'</span>, header<span class="op">=</span><span class="va">None</span>, names<span class="op">=</span>[<span class="st">"UserID"</span>, <span class="st">"MovieID"</span>, <span class="st">"Rating"</span>, <span class="st">"Timestamp"</span>])</span>
<span id="cb130-2"><a href="#cb130-2"></a>users <span class="op">=</span> pd.read_csv(<span class="st">'users.dat'</span>,sep<span class="op">=</span><span class="st">'::'</span>, header<span class="op">=</span><span class="va">None</span>, names<span class="op">=</span>[<span class="st">"UserID"</span>, <span class="st">"Gender"</span>, <span class="st">"Age"</span>, <span class="st">"Occupation"</span>, <span class="st">"Zip-code"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.9/dist-packages/pandas/util/_decorators.py:311: ParserWarning: Falling back to the 'python' engine because the 'c' engine does not support regex separators (separators &gt; 1 char and different from '\s+' are interpreted as regex); you can avoid this warning by specifying engine='python'.
  return func(*args, **kwargs)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1"></a>df <span class="op">=</span> pd.merge(left<span class="op">=</span>ratings, right<span class="op">=</span>users, how<span class="op">=</span><span class="st">'inner'</span>, on<span class="op">=</span><span class="st">'UserID'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:477,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679606919,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="78fa43fd-fea2-422d-c10c-dc4710e9dde7">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1"></a>df <span class="op">=</span> df.astype(np.uint8, errors<span class="op">=</span><span class="st">'ignore'</span>) <span class="co"># reduce memory footprint</span></span>
<span id="cb133-2"><a href="#cb133-2"></a><span class="bu">print</span>(<span class="st">"Number of Unique Zipcodes: </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(df[<span class="st">"Zip-code"</span>].nunique()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of Unique Zipcodes: 3439</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:7,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679606919,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="f265b69d-506c-4db5-b827-c2a33ea93fc5">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="96">

  <div id="df-d78c736c-1386-475f-8f80-48584f7a2708">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">UserID</th>
<th data-quarto-table-cell-role="th">MovieID</th>
<th data-quarto-table-cell-role="th">Rating</th>
<th data-quarto-table-cell-role="th">Timestamp</th>
<th data-quarto-table-cell-role="th">Gender</th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">Occupation</th>
<th data-quarto-table-cell-role="th">Zip-code</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>169</td>
<td>5</td>
<td>88</td>
<td>F</td>
<td>1</td>
<td>10</td>
<td>48067</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>149</td>
<td>3</td>
<td>157</td>
<td>F</td>
<td>1</td>
<td>10</td>
<td>48067</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>146</td>
<td>3</td>
<td>16</td>
<td>F</td>
<td>1</td>
<td>10</td>
<td>48067</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>80</td>
<td>4</td>
<td>115</td>
<td>F</td>
<td>1</td>
<td>10</td>
<td>48067</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>51</td>
<td>5</td>
<td>99</td>
<td>F</td>
<td>1</td>
<td>10</td>
<td>48067</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1000204</td>
<td>152</td>
<td>67</td>
<td>1</td>
<td>253</td>
<td>M</td>
<td>25</td>
<td>6</td>
<td>11106</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1000205</td>
<td>152</td>
<td>70</td>
<td>5</td>
<td>119</td>
<td>M</td>
<td>25</td>
<td>6</td>
<td>11106</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1000206</td>
<td>152</td>
<td>50</td>
<td>5</td>
<td>234</td>
<td>M</td>
<td>25</td>
<td>6</td>
<td>11106</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1000207</td>
<td>152</td>
<td>72</td>
<td>4</td>
<td>128</td>
<td>M</td>
<td>25</td>
<td>6</td>
<td>11106</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1000208</td>
<td>152</td>
<td>73</td>
<td>4</td>
<td>49</td>
<td>M</td>
<td>25</td>
<td>6</td>
<td>11106</td>
</tr>
</tbody>
</table>


<p>1000209 rows × 8 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-d78c736c-1386-475f-8f80-48584f7a2708')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-d78c736c-1386-475f-8f80-48584f7a2708 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-d78c736c-1386-475f-8f80-48584f7a2708');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<p>With over 3000 categories, the <code>Zipcode</code> feature makes a good candidate for target encoding, and the size of this dataset (over one-million rows) means we can spare some data to create the encoding.</p>
<p>We’ll start by creating a 25% split to train the target encoder.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1"></a>X <span class="op">=</span> df.copy()</span>
<span id="cb136-2"><a href="#cb136-2"></a>y <span class="op">=</span> X.pop(<span class="st">'Rating'</span>)</span>
<span id="cb136-3"><a href="#cb136-3"></a></span>
<span id="cb136-4"><a href="#cb136-4"></a>X_encode <span class="op">=</span> X.sample(frac<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb136-5"><a href="#cb136-5"></a>y_encode <span class="op">=</span> y[X_encode.index]</span>
<span id="cb136-6"><a href="#cb136-6"></a>X_pretrain <span class="op">=</span> X.drop(X_encode.index)</span>
<span id="cb136-7"><a href="#cb136-7"></a>y_train <span class="op">=</span> y[X_pretrain.index]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>category_encoders</code> package in <a href="https://github.com/scikit-learn-contrib/category_encoders"><code>scikit-learn-contrib</code></a> implements an <code>MEstimateEncoder</code>, which we’ll use to encode our <code>Zipcode</code> feature.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1"></a><span class="co"># Create the encoder instance. Choose m to control noise.</span></span>
<span id="cb137-2"><a href="#cb137-2"></a>encoder <span class="op">=</span> MEstimateEncoder(cols<span class="op">=</span>[<span class="st">"Zip-code"</span>], m<span class="op">=</span><span class="fl">5.0</span>)</span>
<span id="cb137-3"><a href="#cb137-3"></a></span>
<span id="cb137-4"><a href="#cb137-4"></a><span class="co"># Fit the encoder on the encoding split.</span></span>
<span id="cb137-5"><a href="#cb137-5"></a>encoder.fit(X_encode, y_encode)</span>
<span id="cb137-6"><a href="#cb137-6"></a></span>
<span id="cb137-7"><a href="#cb137-7"></a><span class="co"># Encode the Zipcode column to create the final training data</span></span>
<span id="cb137-8"><a href="#cb137-8"></a>X_train <span class="op">=</span> encoder.transform(X_pretrain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s compare the encoded values to the target to see how informative our encoding might be.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:9059,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679680087,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="97fe60f5-b048-4271-f3cb-2cfa8344a81f">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1"></a>plt.figure(dpi<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb138-2"><a href="#cb138-2"></a>ax <span class="op">=</span> sns.distplot(y, kde<span class="op">=</span><span class="va">False</span>, norm_hist<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb138-3"><a href="#cb138-3"></a>ax <span class="op">=</span> sns.kdeplot(X_train[<span class="st">"Zip-code"</span>], color<span class="op">=</span><span class="st">'r'</span>, ax<span class="op">=</span>ax)</span>
<span id="cb138-4"><a href="#cb138-4"></a>ax.set_xlabel(<span class="st">"Rating"</span>)</span>
<span id="cb138-5"><a href="#cb138-5"></a>ax.legend(labels<span class="op">=</span>[<span class="st">'Zipcode'</span>, <span class="st">'Rating'</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.9/dist-packages/seaborn/distributions.py:2619: FutureWarning: `distplot` is a deprecated function and will be removed in a future version. Please adapt your code to use either `displot` (a figure-level function with similar flexibility) or `histplot` (an axes-level function for histograms).
  warnings.warn(msg, FutureWarning)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="04_Clean_feature_engineering_files/figure-html/cell-100-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>The distribution of the encoded <code>Zipcode</code> feature roughly follows the distribution of the actual ratings, meaning that movie-watchers differed enough in their ratings from zipcode to zipcode that our target encoding was able to capture useful information.</p>
<p>If you would like to use KFold encoding, take a look at http://contrib.scikit-learn.org/category_encoders/wrapper.html#category_encoders.wrapper.NestedCVWrapper</p>
</section>
</section>
<section id="feature-engineering" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="feature-engineering"><span class="header-section-number">4.7</span> Feature Engineering</h2>
<p>We’ll see how adding a few synthetic features to a dataset can improve the predictive performance of a random forest model.</p>
<p>The <a href="https://www.kaggle.com/sinamhd9/concrete-comprehensive-strength"><em>Concrete</em></a> dataset contains a variety of concrete formulations and the resulting product’s <em>compressive strength</em>, which is a measure of how much load that kind of concrete can bear. The task for this dataset is to predict a concrete’s compressive strength given its formulation.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1329,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679703887,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="ef2a37a5-3474-462e-c534-f57500839a42">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1"></a><span class="op">!</span>kaggle datasets download <span class="op">-</span>d sinamhd9<span class="op">/</span>concrete<span class="op">-</span>comprehensive<span class="op">-</span>strength</span>
<span id="cb140-2"><a href="#cb140-2"></a><span class="op">!</span>unzip <span class="op">-</span>qq concrete<span class="op">-</span>comprehensive<span class="op">-</span>strength.<span class="bu">zip</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Downloading concrete-comprehensive-strength.zip to /content
  0% 0.00/32.9k [00:00&lt;?, ?B/s]
100% 32.9k/32.9k [00:00&lt;00:00, 16.2MB/s]</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:9,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679703888,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="704ad8d9-4a52-4b07-d8a3-a68e47414477">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1"></a>df <span class="op">=</span> pd.read_excel(<span class="st">"Concrete_Data.xls"</span>)</span>
<span id="cb142-2"><a href="#cb142-2"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="101">

  <div id="df-c76f36dd-58f2-4c0d-b5fc-52afec03fbd7">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Cement (component 1)(kg in a m^3 mixture)</th>
<th data-quarto-table-cell-role="th">Blast Furnace Slag (component 2)(kg in a m^3 mixture)</th>
<th data-quarto-table-cell-role="th">Fly Ash (component 3)(kg in a m^3 mixture)</th>
<th data-quarto-table-cell-role="th">Water (component 4)(kg in a m^3 mixture)</th>
<th data-quarto-table-cell-role="th">Superplasticizer (component 5)(kg in a m^3 mixture)</th>
<th data-quarto-table-cell-role="th">Coarse Aggregate (component 6)(kg in a m^3 mixture)</th>
<th data-quarto-table-cell-role="th">Fine Aggregate (component 7)(kg in a m^3 mixture)</th>
<th data-quarto-table-cell-role="th">Age (day)</th>
<th data-quarto-table-cell-role="th">Concrete compressive strength(MPa, megapascals)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>540.0</td>
<td>0.0</td>
<td>0.0</td>
<td>162.0</td>
<td>2.5</td>
<td>1040.0</td>
<td>676.0</td>
<td>28</td>
<td>79.986111</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>540.0</td>
<td>0.0</td>
<td>0.0</td>
<td>162.0</td>
<td>2.5</td>
<td>1055.0</td>
<td>676.0</td>
<td>28</td>
<td>61.887366</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>332.5</td>
<td>142.5</td>
<td>0.0</td>
<td>228.0</td>
<td>0.0</td>
<td>932.0</td>
<td>594.0</td>
<td>270</td>
<td>40.269535</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>332.5</td>
<td>142.5</td>
<td>0.0</td>
<td>228.0</td>
<td>0.0</td>
<td>932.0</td>
<td>594.0</td>
<td>365</td>
<td>41.052780</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>198.6</td>
<td>132.4</td>
<td>0.0</td>
<td>192.0</td>
<td>0.0</td>
<td>978.4</td>
<td>825.5</td>
<td>360</td>
<td>44.296075</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-c76f36dd-58f2-4c0d-b5fc-52afec03fbd7')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-c76f36dd-58f2-4c0d-b5fc-52afec03fbd7 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-c76f36dd-58f2-4c0d-b5fc-52afec03fbd7');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<p>You can see here the various ingredients going into each variety of concrete. We’ll see in a moment how adding some additional synthetic features derived from these can help a model to learn important relationships among them. We’ll first establish a baseline by training the model on the un-augmented dataset. This will help us determine whether our new features are actually useful.</p>
<p>Establishing baselines like this is good practice at the start of the feature engineering process. A baseline score can help you decide whether your new features are worth keeping, or whether you should discard them and possibly try something else.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:2,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679704928,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="54c63659-3701-40b6-f5b8-4dc3143b2665">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1"></a>df.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="102">
<pre><code>Index(['Cement (component 1)(kg in a m^3 mixture)',
       'Blast Furnace Slag (component 2)(kg in a m^3 mixture)',
       'Fly Ash (component 3)(kg in a m^3 mixture)',
       'Water  (component 4)(kg in a m^3 mixture)',
       'Superplasticizer (component 5)(kg in a m^3 mixture)',
       'Coarse Aggregate  (component 6)(kg in a m^3 mixture)',
       'Fine Aggregate (component 7)(kg in a m^3 mixture)', 'Age (day)',
       'Concrete compressive strength(MPa, megapascals) '],
      dtype='object')</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:13664,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679719232,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="a9650070-946e-42f5-d8cd-0e5eb467dfbd">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1"></a>X <span class="op">=</span> df.copy()</span>
<span id="cb145-2"><a href="#cb145-2"></a>y <span class="op">=</span> X.pop(df.columns[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb145-3"><a href="#cb145-3"></a></span>
<span id="cb145-4"><a href="#cb145-4"></a><span class="co"># Train and score baseline model</span></span>
<span id="cb145-5"><a href="#cb145-5"></a>baseline <span class="op">=</span> RandomForestRegressor(criterion<span class="op">=</span><span class="st">"absolute_error"</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb145-6"><a href="#cb145-6"></a>baseline_score <span class="op">=</span> cross_val_score(</span>
<span id="cb145-7"><a href="#cb145-7"></a>    baseline, X, y, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">"neg_mean_absolute_error"</span></span>
<span id="cb145-8"><a href="#cb145-8"></a>)</span>
<span id="cb145-9"><a href="#cb145-9"></a>baseline_score <span class="op">=</span> <span class="op">-</span><span class="dv">1</span> <span class="op">*</span> baseline_score.mean()</span>
<span id="cb145-10"><a href="#cb145-10"></a></span>
<span id="cb145-11"><a href="#cb145-11"></a><span class="bu">print</span>(<span class="ss">f"MAE Baseline Score: </span><span class="sc">{</span>baseline_score<span class="sc">:.4}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MAE Baseline Score: 8.397</code></pre>
</div>
</div>
<p>If you ever cook at home, you might know that the <strong><em>ratio</em></strong> of ingredients in a recipe is usually a better predictor of how the recipe turns out than their absolute amounts. We might reason then that ratios of the features above would be a good predictor of <code>CompressiveStrength</code>. The cell below adds three new ratio features to the dataset.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:19531,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679738761,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="5865cdec-e691-405b-c064-ef4d78ac61bb">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1"></a>X <span class="op">=</span> df.copy()</span>
<span id="cb147-2"><a href="#cb147-2"></a>y <span class="op">=</span> X.pop(df.columns[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb147-3"><a href="#cb147-3"></a></span>
<span id="cb147-4"><a href="#cb147-4"></a><span class="co"># Create synthetic features</span></span>
<span id="cb147-5"><a href="#cb147-5"></a>X[<span class="st">"FCRatio"</span>] <span class="op">=</span> X[df.columns[<span class="op">-</span><span class="dv">2</span>]] <span class="op">/</span> X[df.columns[<span class="op">-</span><span class="dv">3</span>]]</span>
<span id="cb147-6"><a href="#cb147-6"></a>X[<span class="st">"AggCmtRatio"</span>] <span class="op">=</span> (X[df.columns[<span class="op">-</span><span class="dv">3</span>]] <span class="op">+</span> X[df.columns[<span class="op">-</span><span class="dv">2</span>]]) <span class="op">/</span> X[df.columns[<span class="dv">0</span>]]</span>
<span id="cb147-7"><a href="#cb147-7"></a>X[<span class="st">"WtrCmtRatio"</span>] <span class="op">=</span> X[df.columns[<span class="dv">3</span>]] <span class="op">/</span> X[df.columns[<span class="dv">0</span>]]</span>
<span id="cb147-8"><a href="#cb147-8"></a></span>
<span id="cb147-9"><a href="#cb147-9"></a><span class="co"># Train and score model on dataset with additional ratio features</span></span>
<span id="cb147-10"><a href="#cb147-10"></a>model <span class="op">=</span> RandomForestRegressor(criterion<span class="op">=</span><span class="st">"absolute_error"</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb147-11"><a href="#cb147-11"></a>score <span class="op">=</span> cross_val_score(</span>
<span id="cb147-12"><a href="#cb147-12"></a>    model, X, y, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">"neg_mean_absolute_error"</span></span>
<span id="cb147-13"><a href="#cb147-13"></a>)</span>
<span id="cb147-14"><a href="#cb147-14"></a>score <span class="op">=</span> <span class="op">-</span><span class="dv">1</span> <span class="op">*</span> score.mean()</span>
<span id="cb147-15"><a href="#cb147-15"></a></span>
<span id="cb147-16"><a href="#cb147-16"></a><span class="bu">print</span>(<span class="ss">f"MAE Score with Ratio Features: </span><span class="sc">{</span>score<span class="sc">:.4}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MAE Score with Ratio Features: 7.732</code></pre>
</div>
</div>
<p>And sure enough, performance improved! This is evidence that these new ratio features exposed important information to the model that it wasn’t detecting before.</p>
<section id="mathematical-transforms" class="level3" data-number="4.7.1">
<h3 data-number="4.7.1" class="anchored" data-anchor-id="mathematical-transforms"><span class="header-section-number">4.7.1</span> Mathematical Transforms</h3>
<p>We’ll use four datasets that having a range of feature types: <a href="https://www.kaggle.com/sobhanmoosavi/us-accidents"><em>US Traffic Accidents</em></a>, <a href="https://www.kaggle.com/toramky/automobile-dataset"><em>1985 Automobiles</em></a>, and <a href="https://www.kaggle.com/pankajjsh06/ibm-watson-marketing-customer-value-data"><em>Customer Lifetime Value</em></a>. The following hidden cell loads them up.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:4160,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679742877,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="517cb519-519e-431c-9c8b-4f8bc423925f">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1"></a><span class="op">!</span>kaggle datasets download <span class="op">-</span>d sobhanmoosavi<span class="op">/</span>us<span class="op">-</span>accidents</span>
<span id="cb149-2"><a href="#cb149-2"></a><span class="op">!</span>kaggle datasets download <span class="op">-</span>d toramky<span class="op">/</span>automobile<span class="op">-</span>dataset</span>
<span id="cb149-3"><a href="#cb149-3"></a><span class="op">!</span>kaggle datasets download <span class="op">-</span>d pankajjsh06<span class="op">/</span>ibm<span class="op">-</span>watson<span class="op">-</span>marketing<span class="op">-</span>customer<span class="op">-</span>value<span class="op">-</span>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Downloading us-accidents.zip to /content
 96% 257M/269M [00:01&lt;00:00, 123MB/s]
100% 269M/269M [00:01&lt;00:00, 147MB/s]
Downloading automobile-dataset.zip to /content
  0% 0.00/4.87k [00:00&lt;?, ?B/s]
100% 4.87k/4.87k [00:00&lt;00:00, 4.82MB/s]
Downloading ibm-watson-marketing-customer-value-data.zip to /content
  0% 0.00/345k [00:00&lt;?, ?B/s]
100% 345k/345k [00:00&lt;00:00, 87.6MB/s]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1"></a><span class="op">!</span>unzip <span class="op">-</span>qq us<span class="op">-</span>accidents.<span class="bu">zip</span></span>
<span id="cb151-2"><a href="#cb151-2"></a><span class="op">!</span>unzip <span class="op">-</span>qq automobile<span class="op">-</span>dataset.<span class="bu">zip</span></span>
<span id="cb151-3"><a href="#cb151-3"></a><span class="op">!</span>unzip <span class="op">-</span>qq ibm<span class="op">-</span>watson<span class="op">-</span>marketing<span class="op">-</span>customer<span class="op">-</span>value<span class="op">-</span>data.<span class="bu">zip</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:3529,&quot;status&quot;:&quot;error&quot;,&quot;timestamp&quot;:1678679759802,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="70fa2914-7c3a-4f14-839c-c427f181c05b">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1"></a>accidents <span class="op">=</span> pd.read_csv(<span class="st">"US_Accidents_Dec21_updated.csv"</span>)</span>
<span id="cb152-2"><a href="#cb152-2"></a>autos <span class="op">=</span> pd.read_csv(<span class="st">"Automobile_data.csv"</span>)</span>
<span id="cb152-3"><a href="#cb152-3"></a>concrete <span class="op">=</span> pd.read_excel(<span class="st">"Concrete_Data.xls"</span>)</span>
<span id="cb152-4"><a href="#cb152-4"></a>customer <span class="op">=</span> pd.read_csv(<span class="st">"WA_Fn-UseC_-Marketing-Customer-Value-Analysis.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>ParserError: ignored</code></pre>
</div>
</div>
<p>Relationships among numerical features are often expressed through mathematical formulas, which you’ll frequently come across as part of your domain research. In <code>Pandas</code>, you can apply arithmetic operations to columns just as if they were ordinary numbers.</p>
<p>In the <em>Automobile</em> dataset are features describing a car’s engine. Research yields a variety of formulas for creating potentially useful new features. The “stroke ratio”, for instance, is a measure of how efficient an engine is versus how performant:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1"></a>autos.replace(<span class="st">"?"</span>, np.nan, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb154-2"><a href="#cb154-2"></a>avg_bore<span class="op">=</span>autos[<span class="st">'bore'</span>].astype(<span class="st">'float'</span>).mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb154-3"><a href="#cb154-3"></a>autos[<span class="st">"bore"</span>].replace(np.nan, avg_bore, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb154-4"><a href="#cb154-4"></a>avg_stroke <span class="op">=</span> autos[<span class="st">"stroke"</span>].astype(<span class="st">"float"</span>).mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb154-5"><a href="#cb154-5"></a>autos[<span class="st">"stroke"</span>].replace(np.nan, avg_stroke, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1"></a>autos[[<span class="st">"bore"</span>, <span class="st">"stroke"</span>]] <span class="op">=</span> autos[[<span class="st">"bore"</span>, <span class="st">"stroke"</span>]].astype(<span class="st">"float"</span>)</span>
<span id="cb155-2"><a href="#cb155-2"></a>autos[<span class="st">"stroke_ratio"</span>] <span class="op">=</span> autos.stroke<span class="op">/</span> autos.bore</span>
<span id="cb155-3"><a href="#cb155-3"></a>autos[[<span class="st">"stroke"</span>, <span class="st">"bore"</span>, <span class="st">"stroke_ratio"</span>]].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Data visualization can suggest transformations, often a “reshaping” of a feature through powers or logarithms. The distribution of <code>WindSpeed</code> in <em>US Accidents</em> is highly skewed, for instance. In this case the logarithm is effective at normalizing it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1"></a>accidents.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1"></a>accidents[<span class="st">"Wind_Speed(mph)"</span>].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1"></a><span class="co"># If the feature has 0.0 values, use np.log1p (log(1+x)) instead of np.log</span></span>
<span id="cb158-2"><a href="#cb158-2"></a>accidents[<span class="st">"LogWindSpeed"</span>] <span class="op">=</span> accidents[<span class="st">"Wind_Speed(mph)"</span>].<span class="bu">apply</span>(np.log1p)</span>
<span id="cb158-3"><a href="#cb158-3"></a></span>
<span id="cb158-4"><a href="#cb158-4"></a><span class="co"># Plot a comparison</span></span>
<span id="cb158-5"><a href="#cb158-5"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb158-6"><a href="#cb158-6"></a>sns.kdeplot(accidents[<span class="st">"Wind_Speed(mph)"</span>], shade<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>])</span>
<span id="cb158-7"><a href="#cb158-7"></a>sns.kdeplot(accidents.LogWindSpeed, shade<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="counts" class="level3" data-number="4.7.2">
<h3 data-number="4.7.2" class="anchored" data-anchor-id="counts"><span class="header-section-number">4.7.2</span> Counts</h3>
<p>Features describing the presence or absence of something often come in sets, the set of risk factors for a disease, say. You can aggregate such features by creating a <strong>count</strong>. These features will be <em>binary</em> (<code>1</code> for Present, <code>0</code> for Absent) or <em>boolean</em> (<code>True</code> or <code>False</code>). In Python, booleans can be added up just as if they were integers.</p>
<p>In <em>Traffic Accidents</em> are several features indicating whether some roadway object was near the accident. This will create a count of the total number of roadway features nearby using the <code>sum()</code> method:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1"></a>roadway_features <span class="op">=</span> [<span class="st">"Amenity"</span>, <span class="st">"Bump"</span>, <span class="st">"Crossing"</span>, <span class="st">"Give_Way"</span>,</span>
<span id="cb159-2"><a href="#cb159-2"></a>    <span class="st">"Junction"</span>, <span class="st">"No_Exit"</span>, <span class="st">"Railway"</span>, <span class="st">"Roundabout"</span>, <span class="st">"Station"</span>, <span class="st">"Stop"</span>,</span>
<span id="cb159-3"><a href="#cb159-3"></a>    <span class="st">"Traffic_Calming"</span>, <span class="st">"Traffic_Signal"</span>]</span>
<span id="cb159-4"><a href="#cb159-4"></a>accidents[<span class="st">"RoadwayFeatures"</span>] <span class="op">=</span> accidents[roadway_features].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb159-5"><a href="#cb159-5"></a></span>
<span id="cb159-6"><a href="#cb159-6"></a>accidents[roadway_features <span class="op">+</span> [<span class="st">"RoadwayFeatures"</span>]].head(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="group-transforms" class="level3" data-number="4.7.3">
<h3 data-number="4.7.3" class="anchored" data-anchor-id="group-transforms"><span class="header-section-number">4.7.3</span> Group Transforms</h3>
<p>Finally we have <strong>Group transforms</strong>, which aggregate information across multiple rows grouped by some category. With a group transform you can create features like: “the average income of a person’s state of residence,” or “the proportion of movies released on a weekday, by genre.” If you had discovered a category interaction, a group transform over that categry could be something good to investigate.</p>
<p>Using an aggregation function, a group transform combines two features: a categorical feature that provides the grouping and another feature whose values you wish to aggregate. For an “average income by state”, you would choose <code>State</code> for the grouping feature, <code>mean()</code> for the aggregation function, and <code>Income</code> for the aggregated feature. To compute this in Pandas, we use the <code>groupby()</code> and <code>transform()</code> methods:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1"></a>customer[<span class="st">"AverageIncome"</span>] <span class="op">=</span> (</span>
<span id="cb160-2"><a href="#cb160-2"></a>    customer.groupby(<span class="st">"State"</span>)  <span class="co"># for each state</span></span>
<span id="cb160-3"><a href="#cb160-3"></a>    [<span class="st">"Income"</span>]                 <span class="co"># select the income</span></span>
<span id="cb160-4"><a href="#cb160-4"></a>    .transform(<span class="st">"mean"</span>)         <span class="co"># and compute its mean</span></span>
<span id="cb160-5"><a href="#cb160-5"></a>)</span>
<span id="cb160-6"><a href="#cb160-6"></a></span>
<span id="cb160-7"><a href="#cb160-7"></a>customer[[<span class="st">"State"</span>, <span class="st">"Income"</span>, <span class="st">"AverageIncome"</span>]].head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>mean()</code> function is a built-in <code>dataframe</code> method, which means we can pass it as a string to <code>transform()</code>. Other handy methods include <code>max()</code>, <code>min()</code>, <code>median()</code>, <code>var()</code>, <code>std()</code>, and <code>count()</code>. Here’s how you could calculate the frequency with which each state occurs in the dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1"></a>customer[<span class="st">"StateFreq"</span>] <span class="op">=</span> (</span>
<span id="cb161-2"><a href="#cb161-2"></a>    customer.groupby(<span class="st">"State"</span>)</span>
<span id="cb161-3"><a href="#cb161-3"></a>    [<span class="st">"State"</span>]</span>
<span id="cb161-4"><a href="#cb161-4"></a>    .transform(<span class="st">"count"</span>)</span>
<span id="cb161-5"><a href="#cb161-5"></a>    <span class="op">/</span> customer.State.count()</span>
<span id="cb161-6"><a href="#cb161-6"></a>)</span>
<span id="cb161-7"><a href="#cb161-7"></a></span>
<span id="cb161-8"><a href="#cb161-8"></a>customer[[<span class="st">"State"</span>, <span class="st">"StateFreq"</span>]].head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="data-centric-ai-with-cleanlab" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="data-centric-ai-with-cleanlab"><span class="header-section-number">4.8</span> Data-centric AI with CleanLab</h2>
<p><code>cleanlab</code> automatically finds and fixes errors in any ML dataset. This data-centric AI package facilitates machine learning with messy, real-world data by providing clean labels during training.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:2,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679765497,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="6d719863-2044-4afa-c783-2466ff8f7cc4">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1"></a>data_dict <span class="op">=</span> make_data()</span>
<span id="cb162-2"><a href="#cb162-2"></a><span class="cf">for</span> key, val <span class="kw">in</span> data_dict.items():  <span class="co"># Map data_dict to variables in namespace</span></span>
<span id="cb162-3"><a href="#cb162-3"></a>    <span class="bu">print</span>(key)</span>
<span id="cb162-4"><a href="#cb162-4"></a>    <span class="bu">exec</span>(key <span class="op">+</span> <span class="st">"=val"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>data
true_labels
labels
test_data
test_labels
noisy_test_labels
ps
py_true
noise_matrix_true
class_names</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1143,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679770924,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="51983e01-f21a-493f-d19c-fa2a9f562925">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1"></a>true_errors <span class="op">=</span> np.where(true_labels <span class="op">!=</span> labels)[<span class="dv">0</span>]</span>
<span id="cb164-2"><a href="#cb164-2"></a>plot_data(data, circles<span class="op">=</span>true_errors, title<span class="op">=</span><span class="st">"A realistic, messy dataset with 4 classes"</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="04_Clean_feature_engineering_files/figure-html/cell-118-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The figure above represents a toy dataset we’ll use to demonstrate various <code>cleanlab</code> functionality. In this data, the features <code>X</code> are 2-dimensional and examples are colored according to their given label above. The given label happens to be incorrect for some of the examples (circled in red) in this dataset!</p>
<section id="use-cleanlearning-for-everything" class="level3" data-number="4.8.1">
<h3 data-number="4.8.1" class="anchored" data-anchor-id="use-cleanlearning-for-everything"><span class="header-section-number">4.8.1</span> Use <code>CleanLearning()</code> for everything</h3>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:301,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679814443,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="2404d122-18dd-465b-8a82-d4a770156f21">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1"></a><span class="co"># For comparison, this is how you would have trained your model normally (without Cleanlab)</span></span>
<span id="cb165-2"><a href="#cb165-2"></a>yourFavoriteModel <span class="op">=</span> LogisticRegression(random_state<span class="op">=</span>SEED)</span>
<span id="cb165-3"><a href="#cb165-3"></a>yourFavoriteModel.fit(data, labels)</span>
<span id="cb165-4"><a href="#cb165-4"></a><span class="bu">print</span>(<span class="ss">f"Accuracy using yourFavoriteModel: </span><span class="sc">{</span>yourFavoriteModel<span class="sc">.</span>score(test_data, test_labels)<span class="sc">:.0%}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy using yourFavoriteModel: 83%</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1"></a>yourFavoriteModel <span class="op">=</span> LogisticRegression(random_state<span class="op">=</span>SEED)</span>
<span id="cb167-2"><a href="#cb167-2"></a></span>
<span id="cb167-3"><a href="#cb167-3"></a><span class="co"># CleanLearning: Machine Learning with cleaned data (given messy, real-world data)</span></span>
<span id="cb167-4"><a href="#cb167-4"></a>cl <span class="op">=</span> cleanlab.classification.CleanLearning(yourFavoriteModel, seed<span class="op">=</span>SEED)</span>
<span id="cb167-5"><a href="#cb167-5"></a></span>
<span id="cb167-6"><a href="#cb167-6"></a><span class="co"># Fit model to messy, real-world data, automatically training on cleaned data.</span></span>
<span id="cb167-7"><a href="#cb167-7"></a>_ <span class="op">=</span> cl.fit(data, labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:4,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679837596,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="a5a1edd5-7c3c-44fc-94de-799ea6868573">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1"></a><span class="co"># But CleanLearning can do anything yourFavoriteModel can do, but enhanced.</span></span>
<span id="cb168-2"><a href="#cb168-2"></a><span class="co"># For example, CleanLearning gives you predictions (just like yourFavoriteModel)</span></span>
<span id="cb168-3"><a href="#cb168-3"></a><span class="co"># but the magic is that CleanLearning was trained as if your data did not have label errors.</span></span>
<span id="cb168-4"><a href="#cb168-4"></a><span class="bu">print</span>(<span class="ss">f"Accuracy using yourFavoriteModel (+ CleanLearning): </span><span class="sc">{</span>cl<span class="sc">.</span>score(test_data, test_labels)<span class="sc">:.0%}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy using yourFavoriteModel (+ CleanLearning): 86%</code></pre>
</div>
</div>
<p>Note! Accuracy refers to the accuracy with respect to the true error-free labels of a test set., i.e.&nbsp;what we actually care about in practice because that’s what real-world model performance is based on!</p>
</section>
<section id="use-cleanlearning-to-find_label_issues-in-one-line-of-code" class="level3" data-number="4.8.2">
<h3 data-number="4.8.2" class="anchored" data-anchor-id="use-cleanlearning-to-find_label_issues-in-one-line-of-code"><span class="header-section-number">4.8.2</span> Use <code>CleanLearning()</code> to <code>find_label_issues()</code> in one line of code</h3>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:784,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679861394,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="a05cf3ba-979a-416d-90a0-2a841a5cc4fa">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1"></a><span class="co"># One line of code. Literally.</span></span>
<span id="cb170-2"><a href="#cb170-2"></a>issues <span class="op">=</span> CleanLearning(yourFavoriteModel, seed<span class="op">=</span>SEED).find_label_issues(data, labels)</span>
<span id="cb170-3"><a href="#cb170-3"></a>issues.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="113">

  <div id="df-74111080-4d76-41a3-935d-88cd8e18dd27">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">is_label_issue</th>
<th data-quarto-table-cell-role="th">label_quality</th>
<th data-quarto-table-cell-role="th">given_label</th>
<th data-quarto-table-cell-role="th">predicted_label</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>False</td>
<td>0.695174</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>False</td>
<td>0.522929</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>True</td>
<td>0.013722</td>
<td>3</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False</td>
<td>0.675606</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>False</td>
<td>0.646438</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-74111080-4d76-41a3-935d-88cd8e18dd27')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-74111080-4d76-41a3-935d-88cd8e18dd27 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-74111080-4d76-41a3-935d-88cd8e18dd27');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<p>Visualize the twenty examples with lowest label quality to see if Cleanlab works.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1001,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679885702,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="148c21d5-5a5c-4091-c7a4-f04e84e00b6f">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1"></a>lowest_quality_labels <span class="op">=</span> issues[<span class="st">"label_quality"</span>].argsort()[:<span class="dv">20</span>]</span>
<span id="cb171-2"><a href="#cb171-2"></a>plot_data(data, circles<span class="op">=</span>lowest_quality_labels, title<span class="op">=</span><span class="st">"The 20 lowest label quality examples"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="04_Clean_feature_engineering_files/figure-html/cell-123-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Above, the top 20 label issues circled in red are found automatically using <code>cleanlab</code> (no true labels given).</p>
</section>
<section id="use-cleanlab-to-find-dataset-level-and-class-level-issues" class="level3" data-number="4.8.3">
<h3 data-number="4.8.3" class="anchored" data-anchor-id="use-cleanlab-to-find-dataset-level-and-class-level-issues"><span class="header-section-number">4.8.3</span> Use <code>cleanlab</code> to find dataset-level and class-level issues</h3>
<ul>
<li>Did you notice that the yellow and seafoam green class above are overlapping?</li>
<li>How can a model ever know (or learn) what’s ground truth inside the yellow distribution?</li>
<li>If these two classes were merged, the model can learn more accurately from 3 classes (versus 4).</li>
</ul>
<p><code>cleanlab</code> automatically finds data-set level issues like this, in one line of code. Check this out!</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:283,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679898148,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="bd8758eb-b991-4ca1-b94b-f607b99368a9">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1"></a>cleanlab.dataset.find_overlapping_classes(</span>
<span id="cb172-2"><a href="#cb172-2"></a>    labels<span class="op">=</span>labels,</span>
<span id="cb172-3"><a href="#cb172-3"></a>    confident_joint<span class="op">=</span>cl.confident_joint,  <span class="co"># cleanlab uses the confident_joint internally to quantify label noise (see cleanlab.count.compute_confident_joint)</span></span>
<span id="cb172-4"><a href="#cb172-4"></a>    class_names<span class="op">=</span>class_names,</span>
<span id="cb172-5"><a href="#cb172-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="115">

  <div id="df-aa30329f-2423-4183-8661-560fc093b2bf">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Class Name A</th>
<th data-quarto-table-cell-role="th">Class Name B</th>
<th data-quarto-table-cell-role="th">Class Index A</th>
<th data-quarto-table-cell-role="th">Class Index B</th>
<th data-quarto-table-cell-role="th">Num Overlapping Examples</th>
<th data-quarto-table-cell-role="th">Joint Probability</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>seafoam green</td>
<td>yellow</td>
<td>2</td>
<td>3</td>
<td>26</td>
<td>0.104</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>purple</td>
<td>seafoam green</td>
<td>0</td>
<td>2</td>
<td>23</td>
<td>0.092</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>purple</td>
<td>yellow</td>
<td>0</td>
<td>3</td>
<td>10</td>
<td>0.040</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>blue</td>
<td>seafoam green</td>
<td>1</td>
<td>2</td>
<td>6</td>
<td>0.024</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>purple</td>
<td>blue</td>
<td>0</td>
<td>1</td>
<td>5</td>
<td>0.020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>blue</td>
<td>yellow</td>
<td>1</td>
<td>3</td>
<td>1</td>
<td>0.004</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-aa30329f-2423-4183-8661-560fc093b2bf')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-aa30329f-2423-4183-8661-560fc093b2bf button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-aa30329f-2423-4183-8661-560fc093b2bf');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<p>There are two things being happening here:</p>
<ul>
<li>Distribution Overlap: The green distribution has huge variance and overlaps with other distributions. <code>Cleanlab</code> handles this for you: read the theory behind cleanlab for overlapping classes <a href="https://arxiv.org/abs/1705.01936">here</a>.</li>
<li>Label Issues: A ton of examples (which actually belong to the purple class) have been mislabeled as “green” in our dataset.</li>
</ul>
<p>Now, let’s see what happens if we merge classes “seafoam green” and “yellow”</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:285,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679935262,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="bbfb8791-b274-43be-852e-3fe33baffbd3">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1"></a>yourFavoriteModel1 <span class="op">=</span> LogisticRegression(random_state<span class="op">=</span>SEED)</span>
<span id="cb173-2"><a href="#cb173-2"></a>yourFavoriteModel1.fit(data, labels)</span>
<span id="cb173-3"><a href="#cb173-3"></a><span class="bu">print</span>(<span class="ss">f"[Original classes] Accuracy of yourFavoriteModel: </span><span class="sc">{</span>yourFavoriteModel1<span class="sc">.</span>score(test_data, test_labels)<span class="sc">:.0%}</span><span class="ss">"</span>)</span>
<span id="cb173-4"><a href="#cb173-4"></a></span>
<span id="cb173-5"><a href="#cb173-5"></a>merged_labels, merged_test_labels <span class="op">=</span> np.array(labels), np.array(test_labels)</span>
<span id="cb173-6"><a href="#cb173-6"></a></span>
<span id="cb173-7"><a href="#cb173-7"></a><span class="co"># Merge classes: map all yellow-labeled examples to seafoam green</span></span>
<span id="cb173-8"><a href="#cb173-8"></a>merged_labels[merged_labels <span class="op">==</span> <span class="dv">3</span>] <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb173-9"><a href="#cb173-9"></a>merged_test_labels[merged_test_labels <span class="op">==</span> <span class="dv">3</span>] <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb173-10"><a href="#cb173-10"></a></span>
<span id="cb173-11"><a href="#cb173-11"></a><span class="co"># Re-run our comparison. Re-run your model on the newly labeled dataset.</span></span>
<span id="cb173-12"><a href="#cb173-12"></a>yourFavoriteModel2 <span class="op">=</span> LogisticRegression(random_state<span class="op">=</span>SEED)</span>
<span id="cb173-13"><a href="#cb173-13"></a>yourFavoriteModel2.fit(data, merged_labels)</span>
<span id="cb173-14"><a href="#cb173-14"></a><span class="bu">print</span>(<span class="ss">f"[Modified classes] Accuracy of yourFavoriteModel: </span><span class="sc">{</span>yourFavoriteModel2<span class="sc">.</span>score(test_data, merged_test_labels)<span class="sc">:.0%}</span><span class="ss">"</span>)</span>
<span id="cb173-15"><a href="#cb173-15"></a></span>
<span id="cb173-16"><a href="#cb173-16"></a><span class="co"># Re-run CleanLearning as well.</span></span>
<span id="cb173-17"><a href="#cb173-17"></a>yourFavoriteModel3 <span class="op">=</span> LogisticRegression(random_state<span class="op">=</span>SEED)</span>
<span id="cb173-18"><a href="#cb173-18"></a>cl3 <span class="op">=</span> cleanlab.classification.CleanLearning(yourFavoriteModel, seed<span class="op">=</span>SEED)</span>
<span id="cb173-19"><a href="#cb173-19"></a>cl3.fit(data, merged_labels)</span>
<span id="cb173-20"><a href="#cb173-20"></a><span class="bu">print</span>(<span class="ss">f"[Modified classes] Accuracy of yourFavoriteModel (+ CleanLearning): </span><span class="sc">{</span>cl3<span class="sc">.</span>score(test_data, merged_test_labels)<span class="sc">:.0%}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[Original classes] Accuracy of yourFavoriteModel: 83%
[Modified classes] Accuracy of yourFavoriteModel: 94%
[Modified classes] Accuracy of yourFavoriteModel (+ CleanLearning): 96%</code></pre>
</div>
</div>
<p>While on one hand that’s a huge improvement, it’s important to remember that choosing among three classes is an easier task than choosing among four classes, so it’s not fair to directly compare these numbers. Instead, the big takeaway is… if you get to choose your classes, combining overlapping classes can make the learning task easier for your model!</p>
</section>
<section id="clean-your-test-set-too-if-youre-doing-ml-with-noisy-labels" class="level3" data-number="4.8.4">
<h3 data-number="4.8.4" class="anchored" data-anchor-id="clean-your-test-set-too-if-youre-doing-ml-with-noisy-labels"><span class="header-section-number">4.8.4</span> Clean your test set too if you’re doing ML with noisy labels!</h3>
<p>If your test and training data were randomly split, then be aware that your test labels are likely noisy too! It is thus important to fix label issues in them before we can trust measures like test accuracy.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:7,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679946036,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="1a29f912-4252-4c97-90d5-225dcb3df21a">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1"></a><span class="co"># Fit your model on noisily labeled train data</span></span>
<span id="cb175-2"><a href="#cb175-2"></a>yourFavoriteModel <span class="op">=</span> LogisticRegression(random_state<span class="op">=</span>SEED)</span>
<span id="cb175-3"><a href="#cb175-3"></a>yourFavoriteModel.fit(data, labels)</span>
<span id="cb175-4"><a href="#cb175-4"></a></span>
<span id="cb175-5"><a href="#cb175-5"></a><span class="co"># Get predicted probabilities for test data (these are out-of-sample)</span></span>
<span id="cb175-6"><a href="#cb175-6"></a>my_test_pred_probs <span class="op">=</span> yourFavoriteModel.predict_proba(test_data)</span>
<span id="cb175-7"><a href="#cb175-7"></a>my_test_preds <span class="op">=</span> my_test_pred_probs.argmax(axis<span class="op">=</span><span class="dv">1</span>)  <span class="co"># predicted labels</span></span>
<span id="cb175-8"><a href="#cb175-8"></a></span>
<span id="cb175-9"><a href="#cb175-9"></a><span class="co"># Find label issues in the test data</span></span>
<span id="cb175-10"><a href="#cb175-10"></a>issues_test <span class="op">=</span> CleanLearning(yourFavoriteModel, seed<span class="op">=</span>SEED).find_label_issues(</span>
<span id="cb175-11"><a href="#cb175-11"></a>    labels<span class="op">=</span>noisy_test_labels, pred_probs<span class="op">=</span>my_test_pred_probs)</span>
<span id="cb175-12"><a href="#cb175-12"></a></span>
<span id="cb175-13"><a href="#cb175-13"></a>issues_test.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="117">

  <div id="df-0c0a968c-5e75-46a7-bcac-77a8a1a08335">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">is_label_issue</th>
<th data-quarto-table-cell-role="th">label_quality</th>
<th data-quarto-table-cell-role="th">given_label</th>
<th data-quarto-table-cell-role="th">predicted_label</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>False</td>
<td>0.702970</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>True</td>
<td>0.009418</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False</td>
<td>0.788533</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>True</td>
<td>0.207881</td>
<td>2</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>False</td>
<td>0.713672</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-0c0a968c-5e75-46a7-bcac-77a8a1a08335')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-0c0a968c-5e75-46a7-bcac-77a8a1a08335 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-0c0a968c-5e75-46a7-bcac-77a8a1a08335');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:266,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679949469,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="8701a1aa-48a0-4077-a3ba-2a32058a85cd">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1"></a><span class="co"># You should inspect issues_test and fix issues to ensure high-quality test data labels.</span></span>
<span id="cb176-2"><a href="#cb176-2"></a>corrected_test_labels <span class="op">=</span> test_labels  <span class="co"># Here we'll pretend you have done this perfectly :)</span></span>
<span id="cb176-3"><a href="#cb176-3"></a></span>
<span id="cb176-4"><a href="#cb176-4"></a><span class="co"># Fit more robust version of model on noisily labeled training data</span></span>
<span id="cb176-5"><a href="#cb176-5"></a>cl <span class="op">=</span> CleanLearning(yourFavoriteModel, seed<span class="op">=</span>SEED).fit(data, labels)</span>
<span id="cb176-6"><a href="#cb176-6"></a>cl_test_preds <span class="op">=</span> cl.predict(test_data)</span>
<span id="cb176-7"><a href="#cb176-7"></a></span>
<span id="cb176-8"><a href="#cb176-8"></a><span class="bu">print</span>(<span class="ss">f" Noisy Test Accuracy (on given test labels) using yourFavoriteModel: </span><span class="sc">{</span>accuracy_score(noisy_test_labels, my_test_preds)<span class="sc">:.0%}</span><span class="ss">"</span>)</span>
<span id="cb176-9"><a href="#cb176-9"></a><span class="bu">print</span>(<span class="ss">f" Noisy Test Accuracy (on given test labels) using yourFavoriteModel (+ CleanLearning): </span><span class="sc">{</span>accuracy_score(noisy_test_labels, cl_test_preds)<span class="sc">:.0%}</span><span class="ss">"</span>)</span>
<span id="cb176-10"><a href="#cb176-10"></a><span class="bu">print</span>(<span class="ss">f"Actual Test Accuracy (on corrected test labels) using yourFavoriteModel: </span><span class="sc">{</span>accuracy_score(corrected_test_labels, my_test_preds)<span class="sc">:.0%}</span><span class="ss">"</span>)</span>
<span id="cb176-11"><a href="#cb176-11"></a><span class="bu">print</span>(<span class="ss">f"Actual Test Accuracy (on corrected test labels) using yourFavoriteModel (+ CleanLearning): </span><span class="sc">{</span>accuracy_score(corrected_test_labels, cl_test_preds)<span class="sc">:.0%}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Noisy Test Accuracy (on given test labels) using yourFavoriteModel: 69%
 Noisy Test Accuracy (on given test labels) using yourFavoriteModel (+ CleanLearning): 71%
Actual Test Accuracy (on corrected test labels) using yourFavoriteModel: 83%
Actual Test Accuracy (on corrected test labels) using yourFavoriteModel (+ CleanLearning): 86%</code></pre>
</div>
</div>
</section>
<section id="one-score-to-rule-them-all-use-cleanlabs-overall-dataset-health-score" class="level3" data-number="4.8.5">
<h3 data-number="4.8.5" class="anchored" data-anchor-id="one-score-to-rule-them-all-use-cleanlabs-overall-dataset-health-score"><span class="header-section-number">4.8.5</span> One score to rule them all – use cleanlab’s overall dataset health score</h3>
<p>This score can be fairly compared across datasets or across versions of a dataset to track overall dataset quality (a.k.a. dataset health) over time.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:275,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679959732,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="d61ad4db-414f-422d-826e-b7e085e1d61d">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1"></a><span class="co"># One line of code.</span></span>
<span id="cb178-2"><a href="#cb178-2"></a>health <span class="op">=</span> cleanlab.dataset.health_summary(</span>
<span id="cb178-3"><a href="#cb178-3"></a>    labels, confident_joint<span class="op">=</span>cl.confident_joint</span>
<span id="cb178-4"><a href="#cb178-4"></a>    <span class="co"># cleanlab uses the confident_joint internally to quantify label noise (see cleanlab.count.compute_confident_joint)</span></span>
<span id="cb178-5"><a href="#cb178-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--------------------------------------------------------
|  Generating a Cleanlab Dataset Health Summary        |
|   for your dataset with 250 examples and 4 classes.  |
|  Note, Cleanlab is not a medical doctor... yet.      |
--------------------------------------------------------

Overall Class Quality and Noise across your dataset (below)
------------------------------------------------------------ 
</code></pre>
</div>
<div class="cell-output cell-output-display">

  <div id="df-a371878a-42d5-4b15-87d2-c3ff662de33b">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Class Index</th>
<th data-quarto-table-cell-role="th">Label Issues</th>
<th data-quarto-table-cell-role="th">Inverse Label Issues</th>
<th data-quarto-table-cell-role="th">Label Noise</th>
<th data-quarto-table-cell-role="th">Inverse Label Noise</th>
<th data-quarto-table-cell-role="th">Label Quality Score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2</td>
<td>32</td>
<td>23</td>
<td>0.507937</td>
<td>0.425926</td>
<td>0.492063</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3</td>
<td>15</td>
<td>22</td>
<td>0.306122</td>
<td>0.392857</td>
<td>0.693878</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>16</td>
<td>22</td>
<td>0.190476</td>
<td>0.244444</td>
<td>0.809524</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>8</td>
<td>4</td>
<td>0.148148</td>
<td>0.080000</td>
<td>0.851852</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-a371878a-42d5-4b15-87d2-c3ff662de33b')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-a371878a-42d5-4b15-87d2-c3ff662de33b button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-a371878a-42d5-4b15-87d2-c3ff662de33b');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Class Overlap. In some cases, you may want to merge classes in the top rows (below)
-----------------------------------------------------------------------------------
</code></pre>
</div>
<div class="cell-output cell-output-display">

  <div id="df-bed47d86-d516-45f5-b2a2-9a7399dde220">
    <div class="colab-df-container">
      <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Class Index A</th>
<th data-quarto-table-cell-role="th">Class Index B</th>
<th data-quarto-table-cell-role="th">Num Overlapping Examples</th>
<th data-quarto-table-cell-role="th">Joint Probability</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2</td>
<td>3</td>
<td>26</td>
<td>0.104</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>2</td>
<td>23</td>
<td>0.092</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>3</td>
<td>10</td>
<td>0.040</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>2</td>
<td>6</td>
<td>0.024</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>1</td>
<td>5</td>
<td>0.020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>1</td>
<td>3</td>
<td>1</td>
<td>0.004</td>
</tr>
</tbody>
</table>


</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-bed47d86-d516-45f5-b2a2-9a7399dde220')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"></path>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-bed47d86-d516-45f5-b2a2-9a7399dde220 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-bed47d86-d516-45f5-b2a2-9a7399dde220');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
 * Overall, about 28% (71 of the 250) labels in your dataset have potential issues.
 ** The overall label health score for this dataset is: 0.72.

Generated with &lt;3 from Cleanlab.
</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:282,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1678679988898,&quot;user&quot;:{&quot;displayName&quot;:&quot;phonchi chung&quot;,&quot;userId&quot;:&quot;13517391734500420886&quot;},&quot;user_tz&quot;:-480}" data-outputid="125f6e83-1fd3-42bf-a9e1-79e7db80c633">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1"></a><span class="co"># One line of code.</span></span>
<span id="cb182-2"><a href="#cb182-2"></a>health <span class="op">=</span> cleanlab.dataset.overall_label_health_score(</span>
<span id="cb182-3"><a href="#cb182-3"></a>    labels, confident_joint<span class="op">=</span>cl.confident_joint</span>
<span id="cb182-4"><a href="#cb182-4"></a>    <span class="co"># cleanlab uses the confident_joint internally to quantify label noise (see cleanlab.count.compute_confident_joint)</span></span>
<span id="cb182-5"><a href="#cb182-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * Overall, about 28% (71 of the 250) labels in your dataset have potential issues.
 ** The overall label health score for this dataset is: 0.72.</code></pre>
</div>
</div>
<p>Because we know the true labels (we created this toy dataset), we can compare with ground truth.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1"></a>label_acc <span class="op">=</span> <span class="bu">sum</span>(labels <span class="op">!=</span> true_labels) <span class="op">/</span> <span class="bu">len</span>(labels)</span>
<span id="cb184-2"><a href="#cb184-2"></a><span class="bu">print</span>(<span class="ss">f"Percentage of label issues guessed by cleanlab </span><span class="sc">{</span><span class="dv">1</span> <span class="op">-</span> health<span class="sc">:.0%}</span><span class="ss">"</span>)</span>
<span id="cb184-3"><a href="#cb184-3"></a><span class="bu">print</span>(<span class="ss">f"Percentage of (ground truth) label errors): </span><span class="sc">{</span>label_acc<span class="sc">:.0%}</span><span class="ss">"</span>)</span>
<span id="cb184-4"><a href="#cb184-4"></a></span>
<span id="cb184-5"><a href="#cb184-5"></a>offset <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> label_acc) <span class="op">-</span> health</span>
<span id="cb184-6"><a href="#cb184-6"></a>offset</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>cleanlab</code> seems to be overestimating. Since data points that fall in between two overlapping distributions are often impossible to label and are counted as issues.</p>
<p>For more details, see <a href="https://docs.cleanlab.ai/stable/tutorials/indepth_overview.html#">https://docs.cleanlab.ai/stable/tutorials/indepth_overview.html#</a></p>
</section>
</section>
<section id="references" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> References</h1>
<ol type="1">
<li><a href="https://www.kaggle.com/learn/feature-engineering">https://www.kaggle.com/learn/feature-engineering</a></li>
<li><a href="https://www.kaggle.com/learn/data-cleaning">https://www.kaggle.com/learn/data-cleaning</a></li>
<li>[https://madewithml.com/courses/mlops/preprocessing/] (https://madewithml.com/courses/mlops/preprocessing/)</li>
<li><a href="https://github.com/microsoft/Data-Science-For-Beginners/blob/main/2-Working-With-Data/08-data-preparation/README.md">https://github.com/microsoft/Data-Science-For-Beginners/blob/main/2-Working-With-Data/08-data-preparation/README.md</a></li>
<li><a href="https://scikit-learn.org/stable/modules/preprocessing.html#">https://scikit-learn.org/stable/modules/preprocessing.html#</a></li>
<li><a href="https://www.books.com.tw/products/0010883417">https://www.books.com.tw/products/0010883417</a></li>
<li><a href="https://docs.cleanlab.ai/stable/tutorials/indepth_overview.html#">https://docs.cleanlab.ai/stable/tutorials/indepth_overview.html#</a></li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./03_Relational_Database_and_data_wrangling.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Relational Database and data wrangling</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./05_Feature_selection_extraction.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Feature selection and extraction</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>